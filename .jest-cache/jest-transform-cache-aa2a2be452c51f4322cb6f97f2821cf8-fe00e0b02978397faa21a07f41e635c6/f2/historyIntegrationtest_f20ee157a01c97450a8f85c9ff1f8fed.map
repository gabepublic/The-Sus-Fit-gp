{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/utils/historyIntegration.test.ts"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\nimport { \n  createHistoryIntegratedCallbacks,\n  createHistoryEntryFromMutation,\n  createShareableHistoryEntry\n} from '../../../src/business-layer/utils/historyIntegration';\nimport type {\n  TryonMutationResponse,\n  TryonMutationVariables,\n  TryonMutationContext,\n  UseTryonMutationConfig\n} from '../../../src/business-layer/types/tryon.types';\nimport type { TryonHistoryService } from '../../../src/business-layer/types/history.types';\n\n// Mock history service\nconst mockHistoryService: TryonHistoryService = {\n  addEntry: jest.fn(),\n  getEntries: jest.fn(),\n  getEntry: jest.fn(),\n  updateEntry: jest.fn(),\n  deleteEntry: jest.fn(),\n  clearAll: jest.fn(),\n  getStorageStats: jest.fn(),\n  exportHistory: jest.fn(),\n  importHistory: jest.fn()\n};\n\n// Test data\nconst mockMutationResponse: TryonMutationResponse = {\n  img_generated: 'data:image/jpeg;base64,generated-image',\n  metadata: {\n    modelVersion: '1.0.0',\n    appliedQuality: 'high',\n    processingTime: 3000\n  }\n};\n\nconst mockMutationVariables: TryonMutationVariables = {\n  modelImage: 'data:image/jpeg;base64,model-image',\n  apparelImages: ['data:image/jpeg;base64,apparel-image'],\n  options: {\n    quality: 'high',\n    timeout: 30000,\n    imageProcessing: {\n      targetWidth: 1024,\n      targetHeight: 1536,\n      compressionQuality: 0.9\n    }\n  }\n};\n\nconst mockMutationContext: TryonMutationContext = {\n  variables: mockMutationVariables,\n  startTime: Date.now() - 5000,\n  retryCount: 0,\n  imageProcessingResults: {\n    totalProcessingTime: 2000,\n    modelImageResult: {\n      originalSize: 2048,\n      finalSize: 1024,\n      processedImage: 'processed-model',\n      originalDimensions: { width: 1920, height: 1080 },\n      finalDimensions: { width: 1024, height: 1536 },\n      metadata: {\n        wasResized: true,\n        wasCompressed: true,\n        compressionRatio: 0.5,\n        processingTime: 1000\n      }\n    },\n    apparelImageResults: [{\n      originalSize: 1536,\n      finalSize: 768,\n      processedImage: 'processed-apparel',\n      originalDimensions: { width: 1920, height: 1080 },\n      finalDimensions: { width: 1024, height: 1536 },\n      metadata: {\n        wasResized: true,\n        wasCompressed: true,\n        compressionRatio: 0.5,\n        processingTime: 1000\n      }\n    }]\n  }\n};\n\nconst mockHistoryEntry = {\n  id: 'test-entry-1',\n  timestamp: '2023-01-01T00:00:00Z',\n  generatedImage: mockMutationResponse.img_generated,\n  modelImage: mockMutationVariables.modelImage,\n  apparelImages: mockMutationVariables.apparelImages,\n  processingTime: 5000,\n  tags: ['test'],\n  notes: 'Test entry',\n  isFavorite: false,\n  metadata: {\n    modelVersion: '1.0.0',\n    appliedQuality: 'high'\n  }\n};\n\ndescribe('createHistoryIntegratedCallbacks', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (mockHistoryService.addEntry as jest.Mock).mockResolvedValue(mockHistoryEntry);\n    \n    // Mock console.log and console.error\n    jest.spyOn(console, 'log').mockImplementation();\n    jest.spyOn(console, 'error').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('onSuccess callback', () => {\n    it('should auto-save to history when enabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith({\n        generatedImage: mockMutationResponse.img_generated,\n        modelImage: mockMutationVariables.modelImage,\n        apparelImages: mockMutationVariables.apparelImages,\n        processingTime: expect.any(Number),\n        metadata: {\n          modelVersion: mockMutationResponse.metadata?.modelVersion,\n          appliedQuality: mockMutationResponse.metadata?.appliedQuality,\n          processingConfig: {\n            imageProcessing: mockMutationVariables.options?.imageProcessing,\n            requestOptions: {\n              timeout: mockMutationVariables.options?.timeout,\n              quality: mockMutationVariables.options?.quality\n            }\n          },\n          imageProcessingResults: mockMutationContext.imageProcessingResults\n        },\n        tags: [],\n        isFavorite: false\n      });\n\n      expect(console.log).toHaveBeenCalledWith('Successfully saved try-on result to history');\n    });\n\n    it('should not save to history when autoSave is disabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: false\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).not.toHaveBeenCalled();\n    });\n\n    it('should apply default tags', async () => {\n      const defaultTags = ['auto-saved', 'production'];\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true,\n        defaultTags\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          tags: defaultTags\n        })\n      );\n    });\n\n    it('should apply custom transformations', async () => {\n      const transformHistoryEntry = jest.fn().mockReturnValue({\n        tags: ['custom-tag'],\n        notes: 'Custom notes',\n        isFavorite: true\n      });\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true,\n        transformHistoryEntry\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(transformHistoryEntry).toHaveBeenCalledWith(\n        mockMutationResponse,\n        mockMutationVariables,\n        mockMutationContext\n      );\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          tags: ['custom-tag'],\n          notes: 'Custom notes',\n          isFavorite: true\n        })\n      );\n    });\n\n    it('should call user-provided onSuccess callback', async () => {\n      const userOnSuccess = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onSuccess: userOnSuccess\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      }, userConfig);\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(userOnSuccess).toHaveBeenCalledWith(\n        mockMutationResponse,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n\n    it('should handle history save errors gracefully', async () => {\n      const saveError = new Error('History save failed');\n      (mockHistoryService.addEntry as jest.Mock).mockRejectedValue(saveError);\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      });\n\n      // Should not throw error\n      await expect(\n        callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext)\n      ).resolves.not.toThrow();\n\n      expect(console.error).toHaveBeenCalledWith(\n        'Failed to save try-on result to history:',\n        saveError\n      );\n    });\n  });\n\n  describe('onError callback', () => {\n    const mockError = {\n      error: 'Network error',\n      code: 'NETWORK_ERROR',\n      retryable: true\n    };\n\n    it('should track errors when enabled', async () => {\n      const contextWithError = {\n        ...mockMutationContext,\n        retryCount: 1,\n        previousError: new Error('Previous error')\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        trackErrors: true\n      });\n\n      await callbacks.onError!(mockError, mockMutationVariables, contextWithError);\n\n      expect(console.log).toHaveBeenCalledWith(\n        'Error tracked for history integration:',\n        expect.objectContaining({\n          error: 'Network error',\n          timestamp: expect.any(String),\n          retryAttempt: 1\n        })\n      );\n    });\n\n    it('should not track errors when disabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        trackErrors: false\n      });\n\n      await callbacks.onError!(mockError, mockMutationVariables, mockMutationContext);\n\n      expect(console.log).not.toHaveBeenCalled();\n    });\n\n    it('should call user-provided onError callback', async () => {\n      const userOnError = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onError: userOnError\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService\n      }, userConfig);\n\n      await callbacks.onError!(mockError, mockMutationVariables, mockMutationContext);\n\n      expect(userOnError).toHaveBeenCalledWith(\n        mockError,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n  });\n\n  describe('onSettled callback', () => {\n    it('should call user-provided onSettled callback', async () => {\n      const userOnSettled = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onSettled: userOnSettled\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService\n      }, userConfig);\n\n      await callbacks.onSettled!(\n        mockMutationResponse,\n        null,\n        mockMutationVariables,\n        mockMutationContext\n      );\n\n      expect(userOnSettled).toHaveBeenCalledWith(\n        mockMutationResponse,\n        null,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n  });\n});\n\ndescribe('createHistoryEntryFromMutation', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (mockHistoryService.addEntry as jest.Mock).mockResolvedValue(mockHistoryEntry);\n  });\n\n  it('should create history entry with correct data', async () => {\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      mockMutationContext,\n      { historyService: mockHistoryService }\n    );\n\n    expect(mockHistoryService.addEntry).toHaveBeenCalledWith({\n      generatedImage: mockMutationResponse.img_generated,\n      modelImage: mockMutationVariables.modelImage,\n      apparelImages: mockMutationVariables.apparelImages,\n      processingTime: expect.any(Number),\n      metadata: {\n        modelVersion: mockMutationResponse.metadata?.modelVersion,\n        appliedQuality: mockMutationResponse.metadata?.appliedQuality,\n        processingConfig: {\n          imageProcessing: mockMutationVariables.options?.imageProcessing,\n          requestOptions: {\n            timeout: mockMutationVariables.options?.timeout,\n            quality: mockMutationVariables.options?.quality\n          }\n        },\n        imageProcessingResults: mockMutationContext.imageProcessingResults\n      },\n      tags: [],\n      notes: undefined,\n      isFavorite: false\n    });\n  });\n\n  it('should apply additional options', async () => {\n    const options = {\n      historyService: mockHistoryService,\n      additionalTags: ['manual', 'test'],\n      notes: 'Manual entry',\n      isFavorite: true\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      mockMutationContext,\n      options\n    );\n\n    expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n      expect.objectContaining({\n        tags: ['manual', 'test'],\n        notes: 'Manual entry',\n        isFavorite: true\n      })\n    );\n  });\n\n  it('should calculate processing time correctly', async () => {\n    const contextWithStartTime = {\n      ...mockMutationContext,\n      startTime: Date.now() - 3000 // 3 seconds ago\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      contextWithStartTime,\n      { historyService: mockHistoryService }\n    );\n\n    const addEntryCall = (mockHistoryService.addEntry as jest.Mock).mock.calls[0][0];\n    expect(addEntryCall.processingTime).toBeGreaterThan(2000);\n    expect(addEntryCall.processingTime).toBeLessThan(4000);\n  });\n\n  it('should handle missing startTime', async () => {\n    const contextWithoutStartTime = {\n      ...mockMutationContext,\n      startTime: undefined as any\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      contextWithoutStartTime,\n      { historyService: mockHistoryService }\n    );\n\n    const addEntryCall = (mockHistoryService.addEntry as jest.Mock).mock.calls[0][0];\n    expect(addEntryCall.processingTime).toBeUndefined();\n  });\n});\n\ndescribe('createShareableHistoryEntry', () => {\n  it('should create shareable entry with limited data', () => {\n    const shareableEntry = createShareableHistoryEntry(mockHistoryEntry);\n\n    expect(shareableEntry).toEqual({\n      id: mockHistoryEntry.id,\n      timestamp: mockHistoryEntry.timestamp,\n      generatedImage: mockHistoryEntry.generatedImage,\n      processingTime: mockHistoryEntry.processingTime,\n      tags: mockHistoryEntry.tags,\n      isFavorite: mockHistoryEntry.isFavorite,\n      notes: mockHistoryEntry.notes,\n      metadata: {\n        modelVersion: mockHistoryEntry.metadata?.modelVersion,\n        appliedQuality: mockHistoryEntry.metadata?.appliedQuality,\n        processingTime: mockHistoryEntry.processingTime\n      }\n    });\n\n    // Should not include original images\n    expect(shareableEntry).not.toHaveProperty('modelImage');\n    expect(shareableEntry).not.toHaveProperty('apparelImages');\n  });\n\n  it('should handle missing metadata gracefully', () => {\n    const entryWithoutMetadata = {\n      ...mockHistoryEntry,\n      metadata: undefined\n    };\n\n    const shareableEntry = createShareableHistoryEntry(entryWithoutMetadata);\n\n    expect(shareableEntry.metadata).toEqual({\n      modelVersion: undefined,\n      appliedQuality: undefined,\n      processingTime: entryWithoutMetadata.processingTime\n    });\n  });\n});"],"names":["mockHistoryService","addEntry","jest","fn","getEntries","getEntry","updateEntry","deleteEntry","clearAll","getStorageStats","exportHistory","importHistory","mockMutationResponse","img_generated","metadata","modelVersion","appliedQuality","processingTime","mockMutationVariables","modelImage","apparelImages","options","quality","timeout","imageProcessing","targetWidth","targetHeight","compressionQuality","mockMutationContext","variables","startTime","Date","now","retryCount","imageProcessingResults","totalProcessingTime","modelImageResult","originalSize","finalSize","processedImage","originalDimensions","width","height","finalDimensions","wasResized","wasCompressed","compressionRatio","apparelImageResults","mockHistoryEntry","id","timestamp","generatedImage","tags","notes","isFavorite","describe","beforeEach","clearAllMocks","mockResolvedValue","spyOn","console","mockImplementation","afterEach","restoreAllMocks","it","callbacks","createHistoryIntegratedCallbacks","historyService","autoSave","onSuccess","expect","toHaveBeenCalledWith","any","Number","processingConfig","requestOptions","log","not","toHaveBeenCalled","defaultTags","objectContaining","transformHistoryEntry","mockReturnValue","userOnSuccess","userConfig","saveError","Error","mockRejectedValue","resolves","toThrow","error","mockError","code","retryable","contextWithError","previousError","trackErrors","onError","String","retryAttempt","userOnError","userOnSettled","onSettled","createHistoryEntryFromMutation","undefined","additionalTags","contextWithStartTime","addEntryCall","mock","calls","toBeGreaterThan","toBeLessThan","contextWithoutStartTime","toBeUndefined","shareableEntry","createShareableHistoryEntry","toEqual","toHaveProperty","entryWithoutMetadata"],"mappings":"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"}