{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/utils/historyIntegration.test.ts"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\nimport { \n  createHistoryIntegratedCallbacks,\n  createHistoryEntryFromMutation,\n  createShareableHistoryEntry\n} from '../../../src/business-layer/utils/historyIntegration';\nimport type {\n  TryonMutationResponse,\n  TryonMutationVariables,\n  TryonMutationContext,\n  UseTryonMutationConfig\n} from '../../../src/business-layer/types/tryon.types';\nimport type { TryonHistoryService } from '../../../src/business-layer/types/history.types';\n\n// Mock history service\nconst mockHistoryService: TryonHistoryService = {\n  addEntry: jest.fn(),\n  getEntries: jest.fn(),\n  getEntry: jest.fn(),\n  updateEntry: jest.fn(),\n  deleteEntry: jest.fn(),\n  clearAll: jest.fn(),\n  getStorageStats: jest.fn(),\n  exportHistory: jest.fn(),\n  importHistory: jest.fn()\n};\n\n// Test data\nconst mockMutationResponse: TryonMutationResponse = {\n  img_generated: 'data:image/jpeg;base64,generated-image',\n  metadata: {\n    modelVersion: '1.0.0',\n    appliedQuality: 'high',\n    processingTime: 3000\n  }\n};\n\nconst mockMutationVariables: TryonMutationVariables = {\n  modelImage: 'data:image/jpeg;base64,model-image',\n  apparelImages: ['data:image/jpeg;base64,apparel-image'],\n  options: {\n    quality: 'high',\n    timeout: 30000,\n    imageProcessing: {\n      targetWidth: 1024,\n      targetHeight: 1536,\n      compressionQuality: 0.9\n    }\n  }\n};\n\nconst mockMutationContext: TryonMutationContext = {\n  variables: mockMutationVariables,\n  startTime: Date.now() - 5000,\n  retryCount: 0,\n  imageProcessingResults: {\n    totalProcessingTime: 2000,\n    modelImageResult: {\n      originalSize: 2048,\n      processedSize: 1024,\n      processedImage: 'processed-model',\n      compressionRatio: 0.5,\n      processingTime: 1000\n    },\n    apparelImageResults: [{\n      originalSize: 1536,\n      processedSize: 768,\n      processedImage: 'processed-apparel',\n      compressionRatio: 0.5,\n      processingTime: 1000\n    }]\n  }\n};\n\nconst mockHistoryEntry = {\n  id: 'test-entry-1',\n  timestamp: '2023-01-01T00:00:00Z',\n  generatedImage: mockMutationResponse.img_generated,\n  modelImage: mockMutationVariables.modelImage,\n  apparelImages: mockMutationVariables.apparelImages,\n  processingTime: 5000,\n  tags: ['test'],\n  notes: 'Test entry',\n  isFavorite: false,\n  metadata: {\n    modelVersion: '1.0.0',\n    appliedQuality: 'high'\n  }\n};\n\ndescribe('createHistoryIntegratedCallbacks', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (mockHistoryService.addEntry as jest.Mock).mockResolvedValue(mockHistoryEntry);\n    \n    // Mock console.log and console.error\n    jest.spyOn(console, 'log').mockImplementation();\n    jest.spyOn(console, 'error').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('onSuccess callback', () => {\n    it('should auto-save to history when enabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith({\n        generatedImage: mockMutationResponse.img_generated,\n        modelImage: mockMutationVariables.modelImage,\n        apparelImages: mockMutationVariables.apparelImages,\n        processingTime: expect.any(Number),\n        metadata: {\n          modelVersion: mockMutationResponse.metadata?.modelVersion,\n          appliedQuality: mockMutationResponse.metadata?.appliedQuality,\n          processingConfig: {\n            imageProcessing: mockMutationVariables.options?.imageProcessing,\n            requestOptions: {\n              timeout: mockMutationVariables.options?.timeout,\n              quality: mockMutationVariables.options?.quality\n            }\n          },\n          imageProcessingResults: mockMutationContext.imageProcessingResults\n        },\n        tags: [],\n        isFavorite: false\n      });\n\n      expect(console.log).toHaveBeenCalledWith('Successfully saved try-on result to history');\n    });\n\n    it('should not save to history when autoSave is disabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: false\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).not.toHaveBeenCalled();\n    });\n\n    it('should apply default tags', async () => {\n      const defaultTags = ['auto-saved', 'production'];\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true,\n        defaultTags\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          tags: defaultTags\n        })\n      );\n    });\n\n    it('should apply custom transformations', async () => {\n      const transformHistoryEntry = jest.fn().mockReturnValue({\n        tags: ['custom-tag'],\n        notes: 'Custom notes',\n        isFavorite: true\n      });\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true,\n        transformHistoryEntry\n      });\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(transformHistoryEntry).toHaveBeenCalledWith(\n        mockMutationResponse,\n        mockMutationVariables,\n        mockMutationContext\n      );\n\n      expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          tags: ['custom-tag'],\n          notes: 'Custom notes',\n          isFavorite: true\n        })\n      );\n    });\n\n    it('should call user-provided onSuccess callback', async () => {\n      const userOnSuccess = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onSuccess: userOnSuccess\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      }, userConfig);\n\n      await callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext);\n\n      expect(userOnSuccess).toHaveBeenCalledWith(\n        mockMutationResponse,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n\n    it('should handle history save errors gracefully', async () => {\n      const saveError = new Error('History save failed');\n      (mockHistoryService.addEntry as jest.Mock).mockRejectedValue(saveError);\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        autoSave: true\n      });\n\n      // Should not throw error\n      await expect(\n        callbacks.onSuccess!(mockMutationResponse, mockMutationVariables, mockMutationContext)\n      ).resolves.not.toThrow();\n\n      expect(console.error).toHaveBeenCalledWith(\n        'Failed to save try-on result to history:',\n        saveError\n      );\n    });\n  });\n\n  describe('onError callback', () => {\n    const mockError = {\n      error: 'Network error',\n      code: 'NETWORK_ERROR',\n      retryable: true\n    };\n\n    it('should track errors when enabled', async () => {\n      const contextWithError = {\n        ...mockMutationContext,\n        retryCount: 1,\n        previousError: new Error('Previous error')\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        trackErrors: true\n      });\n\n      await callbacks.onError!(mockError, mockMutationVariables, contextWithError);\n\n      expect(console.log).toHaveBeenCalledWith(\n        'Error tracked for history integration:',\n        expect.objectContaining({\n          error: 'Network error',\n          timestamp: expect.any(String),\n          retryAttempt: 1\n        })\n      );\n    });\n\n    it('should not track errors when disabled', async () => {\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService,\n        trackErrors: false\n      });\n\n      await callbacks.onError!(mockError, mockMutationVariables, mockMutationContext);\n\n      expect(console.log).not.toHaveBeenCalled();\n    });\n\n    it('should call user-provided onError callback', async () => {\n      const userOnError = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onError: userOnError\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService\n      }, userConfig);\n\n      await callbacks.onError!(mockError, mockMutationVariables, mockMutationContext);\n\n      expect(userOnError).toHaveBeenCalledWith(\n        mockError,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n  });\n\n  describe('onSettled callback', () => {\n    it('should call user-provided onSettled callback', async () => {\n      const userOnSettled = jest.fn();\n      const userConfig: UseTryonMutationConfig = {\n        onSettled: userOnSettled\n      };\n\n      const callbacks = createHistoryIntegratedCallbacks({\n        historyService: mockHistoryService\n      }, userConfig);\n\n      await callbacks.onSettled!(\n        mockMutationResponse,\n        null,\n        mockMutationVariables,\n        mockMutationContext\n      );\n\n      expect(userOnSettled).toHaveBeenCalledWith(\n        mockMutationResponse,\n        null,\n        mockMutationVariables,\n        mockMutationContext\n      );\n    });\n  });\n});\n\ndescribe('createHistoryEntryFromMutation', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (mockHistoryService.addEntry as jest.Mock).mockResolvedValue(mockHistoryEntry);\n  });\n\n  it('should create history entry with correct data', async () => {\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      mockMutationContext,\n      { historyService: mockHistoryService }\n    );\n\n    expect(mockHistoryService.addEntry).toHaveBeenCalledWith({\n      generatedImage: mockMutationResponse.img_generated,\n      modelImage: mockMutationVariables.modelImage,\n      apparelImages: mockMutationVariables.apparelImages,\n      processingTime: expect.any(Number),\n      metadata: {\n        modelVersion: mockMutationResponse.metadata?.modelVersion,\n        appliedQuality: mockMutationResponse.metadata?.appliedQuality,\n        processingConfig: {\n          imageProcessing: mockMutationVariables.options?.imageProcessing,\n          requestOptions: {\n            timeout: mockMutationVariables.options?.timeout,\n            quality: mockMutationVariables.options?.quality\n          }\n        },\n        imageProcessingResults: mockMutationContext.imageProcessingResults\n      },\n      tags: [],\n      notes: undefined,\n      isFavorite: false\n    });\n  });\n\n  it('should apply additional options', async () => {\n    const options = {\n      historyService: mockHistoryService,\n      additionalTags: ['manual', 'test'],\n      notes: 'Manual entry',\n      isFavorite: true\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      mockMutationContext,\n      options\n    );\n\n    expect(mockHistoryService.addEntry).toHaveBeenCalledWith(\n      expect.objectContaining({\n        tags: ['manual', 'test'],\n        notes: 'Manual entry',\n        isFavorite: true\n      })\n    );\n  });\n\n  it('should calculate processing time correctly', async () => {\n    const contextWithStartTime = {\n      ...mockMutationContext,\n      startTime: Date.now() - 3000 // 3 seconds ago\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      contextWithStartTime,\n      { historyService: mockHistoryService }\n    );\n\n    const addEntryCall = (mockHistoryService.addEntry as jest.Mock).mock.calls[0][0];\n    expect(addEntryCall.processingTime).toBeGreaterThan(2000);\n    expect(addEntryCall.processingTime).toBeLessThan(4000);\n  });\n\n  it('should handle missing startTime', async () => {\n    const contextWithoutStartTime = {\n      ...mockMutationContext,\n      startTime: undefined as any\n    };\n\n    await createHistoryEntryFromMutation(\n      mockMutationResponse,\n      mockMutationVariables,\n      contextWithoutStartTime,\n      { historyService: mockHistoryService }\n    );\n\n    const addEntryCall = (mockHistoryService.addEntry as jest.Mock).mock.calls[0][0];\n    expect(addEntryCall.processingTime).toBeUndefined();\n  });\n});\n\ndescribe('createShareableHistoryEntry', () => {\n  it('should create shareable entry with limited data', () => {\n    const shareableEntry = createShareableHistoryEntry(mockHistoryEntry);\n\n    expect(shareableEntry).toEqual({\n      id: mockHistoryEntry.id,\n      timestamp: mockHistoryEntry.timestamp,\n      generatedImage: mockHistoryEntry.generatedImage,\n      processingTime: mockHistoryEntry.processingTime,\n      tags: mockHistoryEntry.tags,\n      isFavorite: mockHistoryEntry.isFavorite,\n      notes: mockHistoryEntry.notes,\n      metadata: {\n        modelVersion: mockHistoryEntry.metadata?.modelVersion,\n        appliedQuality: mockHistoryEntry.metadata?.appliedQuality,\n        processingTime: mockHistoryEntry.processingTime\n      }\n    });\n\n    // Should not include original images\n    expect(shareableEntry).not.toHaveProperty('modelImage');\n    expect(shareableEntry).not.toHaveProperty('apparelImages');\n  });\n\n  it('should handle missing metadata gracefully', () => {\n    const entryWithoutMetadata = {\n      ...mockHistoryEntry,\n      metadata: undefined\n    };\n\n    const shareableEntry = createShareableHistoryEntry(entryWithoutMetadata);\n\n    expect(shareableEntry.metadata).toEqual({\n      modelVersion: undefined,\n      appliedQuality: undefined,\n      processingTime: entryWithoutMetadata.processingTime\n    });\n  });\n});"],"names":["mockHistoryService","addEntry","jest","fn","getEntries","getEntry","updateEntry","deleteEntry","clearAll","getStorageStats","exportHistory","importHistory","mockMutationResponse","img_generated","metadata","modelVersion","appliedQuality","processingTime","mockMutationVariables","modelImage","apparelImages","options","quality","timeout","imageProcessing","targetWidth","targetHeight","compressionQuality","mockMutationContext","variables","startTime","Date","now","retryCount","imageProcessingResults","totalProcessingTime","modelImageResult","originalSize","processedSize","processedImage","compressionRatio","apparelImageResults","mockHistoryEntry","id","timestamp","generatedImage","tags","notes","isFavorite","describe","beforeEach","clearAllMocks","mockResolvedValue","spyOn","console","mockImplementation","afterEach","restoreAllMocks","it","callbacks","createHistoryIntegratedCallbacks","historyService","autoSave","onSuccess","expect","toHaveBeenCalledWith","any","Number","processingConfig","requestOptions","log","not","toHaveBeenCalled","defaultTags","objectContaining","transformHistoryEntry","mockReturnValue","userOnSuccess","userConfig","saveError","Error","mockRejectedValue","resolves","toThrow","error","mockError","code","retryable","contextWithError","previousError","trackErrors","onError","String","retryAttempt","userOnError","userOnSettled","onSettled","createHistoryEntryFromMutation","undefined","additionalTags","contextWithStartTime","addEntryCall","mock","calls","toBeGreaterThan","toBeLessThan","contextWithoutStartTime","toBeUndefined","shareableEntry","createShareableHistoryEntry","toEqual","toHaveProperty","entryWithoutMetadata"],"mappings":"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"}