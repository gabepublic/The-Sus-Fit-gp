{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/utils/image.test.ts"],"sourcesContent":["import {\n  fileToBase64,\n  compressBase64,\n  isImageFile,\n  IMG_SIZE_LIMIT_BYTES,\n  FileTypeNotSupportedError,\n  FileTooLargeError,\n  CompressionFailedError,\n} from '@/utils/image';\n\n// Helper function to create mock File objects\nfunction createMockFile(size: number, type: string, name: string = 'test.png'): File {\n  const content = new Uint8Array(size);\n  return new File([content], name, { type });\n}\n\n// Helper function to create mock base64 data\nfunction createMockBase64(size: number, format: 'png' | 'jpeg' = 'png'): string {\n  const data = 'A'.repeat(size);\n  const base64 = btoa(data);\n  return `data:image/${format};base64,${base64}`;\n}\n\n// Helper function to create a realistic base64 image string\nfunction createRealisticBase64Image(format: 'png' | 'jpeg' = 'png'): string {\n  // Create a minimal valid PNG or JPEG base64 string\n  const pngData = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n  const jpegData = '/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A';\n  \n  const data = format === 'png' ? pngData : jpegData;\n  return `data:image/${format};base64,${data}`;\n}\n\n// Mock canvas and related objects\nconst mockCanvas = {\n  width: 0,\n  height: 0,\n  getContext: jest.fn(() => ({\n    drawImage: jest.fn(),\n  })),\n  toBlob: jest.fn(),\n};\n\nconst mockImage = {\n  width: 800,\n  height: 600,\n  crossOrigin: '',\n  onload: null as (() => void) | null,\n  onerror: null as (() => void) | null,\n  src: '',\n};\n\ndescribe('Image Utilities', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockImage.onload = null;\n    mockImage.onerror = null;\n    mockImage.src = '';\n    mockCanvas.width = 0;\n    mockCanvas.height = 0;\n  });\n\n  describe('isImageFile', () => {\n    it('should return true for image files', () => {\n      const pngFile = createMockFile(1000, 'image/png');\n      const jpegFile = createMockFile(1000, 'image/jpeg');\n      const webpFile = createMockFile(1000, 'image/webp');\n\n      expect(isImageFile(pngFile)).toBe(true);\n      expect(isImageFile(jpegFile)).toBe(true);\n      expect(isImageFile(webpFile)).toBe(true);\n    });\n\n    it('should return false for non-image files', () => {\n      const textFile = createMockFile(1000, 'text/plain');\n      const pdfFile = createMockFile(1000, 'application/pdf');\n      const jsonFile = createMockFile(1000, 'application/json');\n\n      expect(isImageFile(textFile)).toBe(false);\n      expect(isImageFile(pdfFile)).toBe(false);\n      expect(isImageFile(jsonFile)).toBe(false);\n    });\n  });\n\n  describe('fileToBase64', () => {\n    it('should convert valid image file to base64', async () => {\n      const mockFile = createMockFile(1000, 'image/png');\n      \n      // Mock FileReader\n      const mockResult = 'data:image/png;base64,test123';\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: mockResult,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      const promise = fileToBase64(mockFile);\n      \n      // Simulate successful read\n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 0);\n\n      const result = await promise;\n      expect(result).toBe(mockResult);\n      expect(mockFileReader.readAsDataURL).toHaveBeenCalledWith(mockFile);\n    });\n\n    it('should throw FileTypeNotSupportedError for non-image files', async () => {\n      const textFile = createMockFile(1000, 'text/plain');\n\n      await expect(fileToBase64(textFile)).rejects.toThrow(FileTypeNotSupportedError);\n      await expect(fileToBase64(textFile)).rejects.toThrow('Only image files are allowed.');\n    });\n\n    it('should throw FileTooLargeError for files exceeding size limit', async () => {\n      const largeFile = createMockFile(IMG_SIZE_LIMIT_BYTES + 1000, 'image/png');\n\n      await expect(fileToBase64(largeFile)).rejects.toThrow(FileTooLargeError);\n      await expect(fileToBase64(largeFile)).rejects.toThrow('Image exceeds 5 MB limit.');\n    });\n\n    it('should handle FileReader errors', async () => {\n      const mockFile = createMockFile(1000, 'image/png');\n      const mockError = new Error('FileReader error');\n      \n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        error: mockError,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      const promise = fileToBase64(mockFile);\n      \n      // Simulate error\n      setTimeout(() => {\n        mockFileReader.onerror?.();\n      }, 0);\n\n      await expect(promise).rejects.toThrow('FileReader error');\n    });\n  });\n\n  describe('compressBase64', () => {\n    let originalFileReader: any;\n    let originalCanvas: any;\n    let originalImage: any;\n    let originalCreateElement: any;\n\n    beforeEach(() => {\n      // Store original globals\n      originalFileReader = global.FileReader;\n      originalCanvas = global.HTMLCanvasElement;\n      originalImage = global.Image;\n      originalCreateElement = document.createElement;\n    });\n\n    afterEach(() => {\n      // Restore original globals\n      global.FileReader = originalFileReader;\n      global.HTMLCanvasElement = originalCanvas;\n      global.Image = originalImage;\n      document.createElement = originalCreateElement;\n      \n      // Reset mocks\n      jest.clearAllMocks();\n    });\n\n    it('should return original string if already under limit', async () => {\n      const smallBase64 = createMockBase64(100); // 100 bytes\n      const result = await compressBase64(smallBase64, 1024); // 1MB limit\n\n      expect(result).toBe(smallBase64);\n    });\n\n    it('should compress large base64 string successfully', async () => {\n      const largeBase64 = createMockBase64(2000000); // 2MB\n      const compressedBase64 = 'data:image/jpeg;base64,compressedData';\n      \n      // Mock FileReader for blobToBase64\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: compressedBase64,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with successful toBlob\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          const mockBlob = new Blob(['compressed'], { type: format });\n          callback(mockBlob);\n        }),\n      };\n\n      // Mock document.createElement\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image to trigger onload\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        // Trigger onload after a short delay\n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 1024);\n      \n      // Simulate FileReader success\n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      const result = await promise;\n      expect(result).toBe(compressedBase64);\n      expect(mockCanvas.getContext).toHaveBeenCalledWith('2d');\n      expect(mockCanvas.toBlob).toHaveBeenCalled();\n    });\n\n    it('should preserve PNG format for transparency', async () => {\n      const pngBase64 = createMockBase64(2000000); // Make it large enough to trigger compression\n      const compressedBase64 = 'data:image/png;base64,compressedData';\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: compressedBase64,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          const mockBlob = new Blob(['compressed'], { type: format });\n          callback(mockBlob);\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(pngBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      await promise;\n      // Verify that toBlob was called with PNG format\n      expect(mockCanvas.toBlob).toHaveBeenCalled();\n      const toBlobCall = mockCanvas.toBlob.mock.calls[0];\n      expect(toBlobCall[1]).toBe('image/png'); // format parameter\n    });\n\n    it('should use JPEG format for non-PNG images', async () => {\n      // Create a base64 string that doesn't contain 'image/png' to trigger JPEG format\n      const jpegBase64 = 'data:image/jpeg;base64,' + 'A'.repeat(2000000); // Large JPEG data\n      const compressedBase64 = 'data:image/jpeg;base64,compressedData';\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: compressedBase64,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          const mockBlob = new Blob(['compressed'], { type: format });\n          callback(mockBlob);\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(jpegBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      await promise;\n      // Verify that toBlob was called with JPEG format\n      expect(mockCanvas.toBlob).toHaveBeenCalled();\n      const toBlobCall = mockCanvas.toBlob.mock.calls[0];\n      // The format should be JPEG since the base64 doesn't contain 'image/png'\n      expect(toBlobCall[1]).toBe('image/jpeg'); // format parameter\n    });\n\n    it('should throw CompressionFailedError when canvas context fails', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      \n      // Mock document.createElement to return a canvas without context\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return {\n            getContext: jest.fn(() => null),\n          } as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      await expect(compressBase64(largeBase64, 1024)).rejects.toThrow(CompressionFailedError);\n      await expect(compressBase64(largeBase64, 1024)).rejects.toThrow('Failed to get canvas context');\n    });\n\n    it('should throw CompressionFailedError when image fails to load', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      \n      // Mock canvas\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn(),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image to trigger onerror\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onerror) img.onerror();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      await expect(compressBase64(largeBase64, 1024)).rejects.toThrow(CompressionFailedError);\n      await expect(compressBase64(largeBase64, 1024)).rejects.toThrow('Failed to load image for compression');\n    });\n\n    it('should handle compression quality reduction', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      const compressedBase64 = 'data:image/jpeg;base64,compressedData';\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: compressedBase64,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with quality tracking\n      let qualityValues: number[] = [];\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          qualityValues.push(quality);\n          const mockBlob = new Blob(['compressed'], { type: format });\n          callback(mockBlob);\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      await promise;\n      \n      // Should have called toBlob with decreasing quality values\n      expect(qualityValues.length).toBeGreaterThan(0);\n      expect(qualityValues[0]).toBe(0.9); // Initial quality\n    });\n\n    it('should handle toBlob returning null blob', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      const compressedBase64 = 'data:image/jpeg;base64,compressedData';\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: compressedBase64,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that returns null\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          callback(null); // Return null blob\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      // Should handle the null blob gracefully and continue with quality reduction\n      // Since the compression will fail due to null blob, it should eventually throw\n      await expect(promise).rejects.toThrow(CompressionFailedError);\n    });\n\n    it('should handle FileReader error in blobToBase64', async () => {\n      // Test the blobToBase64 function directly by testing the FileReader error handling\n      const mockBlob = new Blob(['test'], { type: 'image/jpeg' });\n      \n      // Mock FileReader that fails\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        error: new Error('FileReader error'),\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Create a promise that simulates the blobToBase64 function\n      const blobToBase64Promise = new Promise<string>((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n          const result = reader.result as string;\n          resolve(result);\n        };\n        reader.onerror = () => reject(reader.error);\n        reader.readAsDataURL(mockBlob);\n      });\n\n      // Simulate FileReader error immediately\n      setTimeout(() => {\n        mockFileReader.onerror?.();\n      }, 5);\n\n      await expect(blobToBase64Promise).rejects.toThrow('FileReader error');\n    });\n\n    it('should handle toBlob rejection when blob creation fails', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,compressedData',\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that rejects\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          // Simulate blob creation failure by calling callback with null\n          callback(null);\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      // Should handle the blob creation failure gracefully\n      // Since the compression will fail due to null blob, it should eventually throw\n      await expect(promise).rejects.toThrow(CompressionFailedError);\n    });\n\n    it('should handle toBlob rejection with explicit error', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,compressedData',\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that explicitly rejects\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          // This will trigger the rejectBlob(new Error('Failed to create blob')) line\n          callback(null);\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      // Should handle the blob creation failure gracefully and continue with quality reduction\n      // Since the compression will fail due to null blob, it should eventually throw\n      await expect(promise).rejects.toThrow(CompressionFailedError);\n    });\n\n    it('should handle blob creation failure in compression loop catch block', async () => {\n      const largeBase64 = createMockBase64(2000000);\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,compressedData',\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that throws an error\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          // Simulate an error during blob creation\n          throw new Error('Canvas error');\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force compression\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      // Should handle the canvas error gracefully and continue with quality reduction\n      // Since the compression will fail due to canvas error, it should eventually throw\n      await expect(promise).rejects.toThrow(CompressionFailedError);\n    });\n\n    it('should handle image resizing when compression alone is insufficient', async () => {\n      // Create a base64 string that will trigger the resizing logic\n      const largeBase64 = 'data:image/jpeg;base64,' + 'A'.repeat(2000000); // Large enough to trigger resizing\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,compressedData',\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that returns large blobs initially, then smaller ones after resize\n      let resizeAttempted = false;\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          if (!resizeAttempted) {\n            // Before resize, return large blob\n            const largeBlob = new Blob(['A'.repeat(200000)], { type: format });\n            callback(largeBlob);\n            resizeAttempted = true;\n          } else {\n            // After resize, return smaller blob\n            const smallBlob = new Blob(['A'.repeat(50000)], { type: format });\n            callback(smallBlob);\n          }\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit to force resizing\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      const result = await promise;\n      expect(result).toBe('data:image/jpeg;base64,compressedData');\n      expect(mockCanvas.getContext).toHaveBeenCalledWith('2d');\n    });\n\n\n\n    it('should handle resized blob creation failure', async () => {\n      // Mock atob to return large sizes\n      const originalAtob = global.atob;\n      global.atob = jest.fn((str) => {\n        return 'A'.repeat(200000); // Always return large size\n      });\n\n      const largeBase64 = 'data:image/jpeg;base64,' + 'A'.repeat(2000000);\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,compressedData',\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas with toBlob that fails during resize\n      let resizeAttempted = false;\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          if (!resizeAttempted) {\n            const largeBlob = new Blob(['A'.repeat(200000)], { type: format });\n            callback(largeBlob);\n            resizeAttempted = true;\n          } else {\n            callback(null); // Fail during resize\n          }\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100);\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      // Should throw the specific error from the resized blob creation\n      await expect(promise).rejects.toThrow('Failed to create resized blob');\n\n      // Restore original atob\n      global.atob = originalAtob;\n    });\n\n\n\n    it('should successfully compress and resolve when resizing works', async () => {\n      // Mock atob to return small sizes after resizing\n      const originalAtob = global.atob;\n      global.atob = jest.fn((str) => {\n        if (str === 'A'.repeat(2000000)) {\n          return 'A'.repeat(2000000); // Original size\n        }\n        return 'A'.repeat(50000); // Small size after resizing\n      });\n\n      const largeBase64 = 'data:image/jpeg;base64,' + 'A'.repeat(2000000);\n      \n      // Mock FileReader\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: 'data:image/jpeg;base64,' + 'A'.repeat(50000),\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      // Mock canvas\n      let resizeAttempted = false;\n      const mockCanvasContext = {\n        drawImage: jest.fn(),\n      };\n\n      const mockCanvas = {\n        width: 0,\n        height: 0,\n        getContext: jest.fn(() => mockCanvasContext),\n        toBlob: jest.fn((callback, format, quality) => {\n          if (!resizeAttempted) {\n            const largeBlob = new Blob(['A'.repeat(200000)], { type: format });\n            callback(largeBlob);\n            resizeAttempted = true;\n          } else {\n            const smallBlob = new Blob(['A'.repeat(50000)], { type: format });\n            callback(smallBlob);\n          }\n        }),\n      };\n\n      document.createElement = jest.fn((tag) => {\n        if (tag === 'canvas') {\n          return mockCanvas as any;\n        }\n        return originalCreateElement.call(document, tag);\n      });\n\n      // Mock Image\n      global.Image = jest.fn(() => {\n        const img = {\n          width: 800,\n          height: 600,\n          src: '',\n          onload: null as any,\n          onerror: null as any,\n        };\n        \n        setTimeout(() => {\n          if (img.onload) img.onload();\n        }, 0);\n        \n        return img as any;\n      }) as any;\n\n      const promise = compressBase64(largeBase64, 100); // Small limit\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 10);\n\n      const result = await promise;\n      expect(result).toBe('data:image/jpeg;base64,' + 'A'.repeat(50000));\n\n      // Restore original atob\n      global.atob = originalAtob;\n    });\n\n\n  });\n\n  describe('Constants', () => {\n    it('should have correct IMG_SIZE_LIMIT_BYTES value', () => {\n      expect(IMG_SIZE_LIMIT_BYTES).toBe(5 * 1024 * 1024); // 5 MB\n    });\n  });\n\n  describe('Error Classes', () => {\n    it('should have correct error names', () => {\n      const fileTypeError = new FileTypeNotSupportedError('test');\n      const fileSizeError = new FileTooLargeError('test');\n      const compressionError = new CompressionFailedError('test');\n\n      expect(fileTypeError.name).toBe('FileTypeNotSupportedError');\n      expect(fileSizeError.name).toBe('FileTooLargeError');\n      expect(compressionError.name).toBe('CompressionFailedError');\n    });\n\n    it('should be instanceof Error', () => {\n      const fileTypeError = new FileTypeNotSupportedError('test');\n      const fileSizeError = new FileTooLargeError('test');\n      const compressionError = new CompressionFailedError('test');\n\n      expect(fileTypeError).toBeInstanceOf(Error);\n      expect(fileSizeError).toBeInstanceOf(Error);\n      expect(compressionError).toBeInstanceOf(Error);\n    });\n\n    it('should preserve error messages', () => {\n      const testMessage = 'Custom error message';\n      const fileTypeError = new FileTypeNotSupportedError(testMessage);\n      const fileSizeError = new FileTooLargeError(testMessage);\n      const compressionError = new CompressionFailedError(testMessage);\n\n      expect(fileTypeError.message).toBe(testMessage);\n      expect(fileSizeError.message).toBe(testMessage);\n      expect(compressionError.message).toBe(testMessage);\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle empty file type', () => {\n      const emptyTypeFile = createMockFile(1000, '');\n      expect(isImageFile(emptyTypeFile)).toBe(false);\n    });\n\n    it('should handle null file type', () => {\n      const nullTypeFile = createMockFile(1000, null as any);\n      expect(isImageFile(nullTypeFile)).toBe(false);\n    });\n\n    it('should handle exact size limit file', async () => {\n      const exactSizeFile = createMockFile(IMG_SIZE_LIMIT_BYTES, 'image/png');\n      \n      // Mock FileReader\n      const mockResult = 'data:image/png;base64,test123';\n      const mockFileReader = {\n        readAsDataURL: jest.fn(),\n        onload: null as any,\n        onerror: null as any,\n        result: mockResult,\n      };\n\n      global.FileReader = jest.fn(() => mockFileReader) as any;\n\n      const promise = fileToBase64(exactSizeFile);\n      \n      setTimeout(() => {\n        mockFileReader.onload?.();\n      }, 0);\n\n      const result = await promise;\n      expect(result).toBe(mockResult);\n    });\n\n    it('should handle base64 string without comma separator', async () => {\n      const invalidBase64 = 'invalid-base64-string';\n      \n      // This should throw an error when trying to split by comma\n      expect(() => {\n        const parts = invalidBase64.split(',');\n        if (parts.length < 2) {\n          throw new Error('Invalid base64 format');\n        }\n      }).toThrow('Invalid base64 format');\n    });\n  });\n}); "],"names":["createMockFile","size","type","name","content","Uint8Array","File","createMockBase64","format","data","repeat","base64","btoa","createRealisticBase64Image","pngData","jpegData","mockCanvas","width","height","getContext","jest","fn","drawImage","toBlob","mockImage","crossOrigin","onload","onerror","src","describe","beforeEach","clearAllMocks","it","pngFile","jpegFile","webpFile","expect","isImageFile","toBe","textFile","pdfFile","jsonFile","mockFile","mockResult","mockFileReader","readAsDataURL","result","global","FileReader","promise","fileToBase64","setTimeout","toHaveBeenCalledWith","rejects","toThrow","FileTypeNotSupportedError","largeFile","IMG_SIZE_LIMIT_BYTES","FileTooLargeError","mockError","Error","error","originalFileReader","originalCanvas","originalImage","originalCreateElement","HTMLCanvasElement","Image","document","createElement","afterEach","smallBase64","compressBase64","largeBase64","compressedBase64","mockCanvasContext","callback","quality","mockBlob","Blob","tag","call","img","toHaveBeenCalled","pngBase64","toBlobCall","mock","calls","jpegBase64","CompressionFailedError","qualityValues","push","length","toBeGreaterThan","blobToBase64Promise","Promise","resolve","reject","reader","resizeAttempted","largeBlob","smallBlob","originalAtob","atob","str","fileTypeError","fileSizeError","compressionError","toBeInstanceOf","testMessage","message","emptyTypeFile","nullTypeFile","exactSizeFile","invalidBase64","parts","split"],"mappings":"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"}