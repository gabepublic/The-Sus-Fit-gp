{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/src/components/ui/enhanced-polaroid-photo-generator.tsx"],"sourcesContent":["\"use client\"\n\nimport { cn } from \"@/lib/utils\"\nimport { useState, useEffect, useRef, useCallback } from \"react\"\n\ninterface EnhancedPolaroidPhotoGeneratorProps {\n    className?: string\n    onGenerationStart?: () => void\n    onGenerationComplete?: (imageUrl: string) => void\n    isGenerating?: boolean\n    personImageUrl?: string\n    garmentImageUrl?: string\n    mockImageUrl?: string\n    position?: 'center' | 'bottom' // Position relative to camera\n}\n\nexport function EnhancedPolaroidPhotoGenerator({\n                                                   className,\n                                                   onGenerationStart,\n                                                   onGenerationComplete,\n                                                   isGenerating = false,\n                                                   personImageUrl,\n                                                   garmentImageUrl,\n                                                   mockImageUrl = \"/images/ScoredGarment.jpg\",\n                                                   position = 'bottom'\n                                               }: EnhancedPolaroidPhotoGeneratorProps) {\n    const [progress, setProgress] = useState(0)\n    const [photoVisible, setPhotoVisible] = useState(false)\n    const [generatedImageUrl, setGeneratedImageUrl] = useState<string | null>(null)\n    const [animationPhase, setAnimationPhase] = useState<'idle' | 'processing' | 'revealing' | 'complete'>('idle')\n    const [polaroidVisible, setPolaroidVisible] = useState(false)\n    const progressRef = useRef<NodeJS.Timeout | null>(null)\n    const timeoutRef = useRef<NodeJS.Timeout | null>(null)\n\n    // Cleanup function to clear all timers\n    const cleanupTimers = useCallback(() => {\n        if (progressRef.current) {\n            clearInterval(progressRef.current)\n            progressRef.current = null\n        }\n        if (timeoutRef.current) {\n            clearTimeout(timeoutRef.current)\n            timeoutRef.current = null\n        }\n    }, [])\n\n    // Reset state function\n    const resetState = useCallback(() => {\n        setProgress(0)\n        setPhotoVisible(false)\n        setGeneratedImageUrl(null)\n        setAnimationPhase('idle')\n        setPolaroidVisible(false)\n        cleanupTimers()\n    }, [cleanupTimers])\n\n    const startGenerationSequence = useCallback(() => {\n        // Reset state first\n        resetState()\n        \n        // Show the polaroid sliding out from camera\n        setPolaroidVisible(true)\n        setAnimationPhase('processing')\n        setProgress(0)\n\n        if (onGenerationStart) {\n            onGenerationStart()\n        }\n\n        // Determine which image to use\n        const imageToUse = personImageUrl || garmentImageUrl || mockImageUrl\n\n        // Phase 1: Progress bar animation (0-100% over ~4 seconds)\n        let currentProgress = 0\n        progressRef.current = setInterval(() => {\n            currentProgress += 2.5 // Faster progress to match test expectations\n            setProgress(Math.min(currentProgress, 100))\n\n            if (currentProgress >= 100) {\n                if (progressRef.current) {\n                    clearInterval(progressRef.current)\n                    progressRef.current = null\n                }\n\n                // Phase 2: Photo revelation (after progress completes)\n                timeoutRef.current = setTimeout(() => {\n                    setAnimationPhase('revealing')\n                    setGeneratedImageUrl(imageToUse)\n                    \n                    // Call onGenerationComplete immediately when revealing starts\n                    if (onGenerationComplete) {\n                        onGenerationComplete(imageToUse)\n                    }\n\n                    // Start photo slide animation\n                    timeoutRef.current = setTimeout(() => {\n                        setPhotoVisible(true)\n\n                        // Phase 3: Complete after slide animation (1.4s later to match test timing)\n                        timeoutRef.current = setTimeout(() => {\n                            setAnimationPhase('complete')\n                        }, 1400)\n                    }, 100)\n                }, 500)\n            }\n        }, 100) // Faster interval to match test expectations\n    }, [onGenerationStart, onGenerationComplete, personImageUrl, garmentImageUrl, mockImageUrl, resetState])\n\n    // Handle isGenerating changes\n    useEffect(() => {\n        if (isGenerating) {\n            if (animationPhase === 'idle') {\n                startGenerationSequence()\n            }\n        } else {\n            // Reset everything when isGenerating becomes false\n            resetState()\n        }\n    }, [isGenerating, animationPhase, startGenerationSequence, resetState])\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            cleanupTimers()\n        }\n    }, [cleanupTimers])\n\n    const getPositionClasses = () => {\n        switch (position) {\n            case 'center':\n                return \"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2\"\n            case 'bottom':\n            default:\n                return \"absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-8\"\n        }\n    }\n\n    if (!polaroidVisible) return null\n\n    return (\n        <div className={cn(\n            \"z-50 transition-all duration-700 ease-out\",\n            getPositionClasses(),\n            className\n        )}>\n            {/* Polaroid Card */}\n            <div className={cn(\n                \"relative bg-white border-2 border-black rounded-lg p-4 w-72 h-80 transition-all duration-500\",\n                \"polaroid-shadow\",\n                polaroidVisible ? \"animate-polaroidAppear\" : \"opacity-0 transform scale-95\"\n            )}>\n\n                {/* Photo Area */}\n                <div className=\"relative w-full h-48 bg-gray-400 border border-gray-300 overflow-hidden rounded-sm\">\n\n                    {/* Gray Placeholder with Developing Effect */}\n                    <div\n                        className={cn(\n                            \"absolute inset-0 transition-all duration-1000 z-10\",\n                            animationPhase === 'processing' ? \"photo-developing\" : \"\",\n                            photoVisible ? \"opacity-0\" : \"opacity-100 bg-gray-400\"\n                        )}\n                    />\n\n                    {/* Generated Photo */}\n                    {generatedImageUrl && (\n                        <div\n                            className={cn(\n                                \"absolute inset-0 transition-all duration-1500 ease-out\",\n                                photoVisible\n                                    ? \"transform translate-y-0 opacity-100\"\n                                    : \"transform -translate-y-full opacity-0\"\n                            )}\n                            style={{\n                                backgroundImage: `url(${generatedImageUrl})`,\n                                backgroundSize: 'cover',\n                                backgroundPosition: 'center'\n                            }}\n                        />\n                    )}\n\n                    {/* Processing Overlay */}\n                    {animationPhase === 'processing' && (\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-transparent via-white/10 to-transparent animate-pulse z-20\" />\n                    )}\n                </div>\n\n                {/* Polaroid White Space */}\n                <div className=\"h-16 bg-white flex items-center justify-center\">\n                    <div className=\"text-xs text-gray-600 font-mono tracking-wider\">\n                        {animationPhase === 'idle' && \"READY\"}\n                        {animationPhase === 'processing' && \"PROCESSING...\"}\n                        {animationPhase === 'revealing' && \"DEVELOPING...\"}\n                        {animationPhase === 'complete' && \"SUS FIT COMPLETE\"}\n                    </div>\n                </div>\n\n                {/* Enhanced Progress Bar */}\n                <div className=\"absolute bottom-3 left-4 right-4\">\n                    <div className=\"h-1.5 bg-gray-200 rounded-full overflow-hidden border border-gray-300\">\n                        <div\n                            className={cn(\n                                \"h-full bg-gradient-to-r from-[var(--color-susfit-pink-500)] via-[var(--color-susfit-teal-500)] to-[var(--color-susfit-green-500)] transition-all duration-200 ease-out rounded-full\",\n                                animationPhase === 'processing' ? \"progress-bar-animated\" : \"\"\n                            )}\n                            style={{\n                                width: `${progress}%`,\n                                transition: 'width 0.2s ease-out'\n                            }}\n                        />\n                    </div>\n\n                    {/* Progress Percentage */}\n                    <div className=\"text-xs text-gray-500 text-center mt-1 font-mono\">\n                        {Math.round(progress)}%\n                    </div>\n                </div>\n\n                {/* Vintage Polaroid Logo */}\n                <div className=\"absolute top-2 right-2 text-xs text-gray-400 font-mono\">\n                    SUS FIT\n                </div>\n            </div>\n\n            {/* Photo \"Ejection\" Animation Shadow */}\n            <div className={cn(\n                \"absolute -bottom-2 left-4 right-4 h-2 bg-black/20 rounded-full blur-sm transition-opacity duration-500\",\n                polaroidVisible ? \"opacity-100\" : \"opacity-0\"\n            )} />\n\n            {/* Development Completion Indicator */}\n            {animationPhase === 'complete' && (\n                <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 animate-bounce\">\n                    <div className=\"bg-[var(--color-susfit-green-500)] text-black px-3 py-1 rounded-full text-xs font-bold border-2 border-black\">\n                        âœ¨ READY!\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n"],"names":["EnhancedPolaroidPhotoGenerator","className","onGenerationStart","onGenerationComplete","isGenerating","personImageUrl","garmentImageUrl","mockImageUrl","position","progress","setProgress","useState","photoVisible","setPhotoVisible","generatedImageUrl","setGeneratedImageUrl","animationPhase","setAnimationPhase","polaroidVisible","setPolaroidVisible","progressRef","useRef","timeoutRef","cleanupTimers","useCallback","current","clearInterval","clearTimeout","resetState","startGenerationSequence","imageToUse","currentProgress","setInterval","Math","min","setTimeout","useEffect","getPositionClasses","div","cn","style","backgroundImage","backgroundSize","backgroundPosition","width","transition","round"],"mappings":"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"}