78618b5f21da407dee32e80eb973db4e
// Optimistic Updates Hooks
// React hooks for managing optimistic UI updates and progress indicators
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    useMultipleTryonProgress: function() {
        return useMultipleTryonProgress;
    },
    useOptimisticCacheInvalidation: function() {
        return useOptimisticCacheInvalidation;
    },
    useOptimisticUpdates: function() {
        return useOptimisticUpdates;
    },
    useProgressVisualization: function() {
        return useProgressVisualization;
    },
    useTryonProgress: function() {
        return useTryonProgress;
    },
    useTryonResult: function() {
        return useTryonResult;
    }
});
const _reactquery = require("@tanstack/react-query");
const _react = require("react");
const _optimisticUpdates = require("../utils/optimisticUpdates");
function useOptimisticUpdates(config = {}) {
    const queryClient = (0, _reactquery.useQueryClient)();
    const optimisticManager = config.optimisticManager || (0, _optimisticUpdates.getOptimisticUpdatesManager)();
    const activeUpdatesRef = (0, _react.useRef)(new Set());
    const isOptimisticEnabled = config.enabled !== false;
    // Get active optimistic updates
    const activeUpdates = (0, _react.useMemo)(()=>{
        return optimisticManager.getActiveOptimisticUpdates();
    }, [
        optimisticManager
    ]);
    const startOptimistic = (0, _react.useCallback)((optimisticConfig)=>{
        if (!isOptimisticEnabled || !config.mutationVariables) {
            return '';
        }
        const context = optimisticManager.startOptimisticUpdate(config.mutationVariables, optimisticConfig);
        activeUpdatesRef.current.add(context.optimisticId);
        return context.optimisticId;
    }, [
        isOptimisticEnabled,
        config.mutationVariables,
        optimisticManager
    ]);
    const completeOptimistic = (0, _react.useCallback)((optimisticId, result, mutationContext)=>{
        if (!optimisticId || !activeUpdatesRef.current.has(optimisticId)) {
            return;
        }
        optimisticManager.completeOptimisticUpdate(optimisticId, result, mutationContext);
        activeUpdatesRef.current.delete(optimisticId);
    }, [
        optimisticManager
    ]);
    const rollbackOptimistic = (0, _react.useCallback)((optimisticId, error)=>{
        if (!optimisticId || !activeUpdatesRef.current.has(optimisticId)) {
            return;
        }
        optimisticManager.rollbackOptimisticUpdate(optimisticId, error);
        activeUpdatesRef.current.delete(optimisticId);
    }, [
        optimisticManager
    ]);
    // Cleanup on unmount
    (0, _react.useEffect)(()=>{
        return ()=>{
            // Rollback any remaining optimistic updates
            activeUpdatesRef.current.forEach((optimisticId)=>{
                optimisticManager.rollbackOptimisticUpdate(optimisticId, new Error('Component unmounted'));
            });
            activeUpdatesRef.current.clear();
        };
    }, [
        optimisticManager
    ]);
    return {
        startOptimistic,
        completeOptimistic,
        rollbackOptimistic,
        isOptimisticEnabled,
        activeUpdates
    };
}
function useTryonProgress(optimisticId) {
    const progressQuery = (0, _reactquery.useQuery)({
        queryKey: [
            'tryon-progress',
            optimisticId
        ],
        enabled: Boolean(optimisticId),
        refetchInterval: (data)=>{
            // Stop refetching once completed or errored
            const progressData = data;
            return progressData?.status === 'processing' ? 500 : false;
        },
        staleTime: 0,
        gcTime: 5000 // Keep in cache briefly after completion
    });
    return {
        progress: progressQuery.data,
        isLoading: progressQuery.isLoading,
        error: progressQuery.error
    };
}
function useMultipleTryonProgress(optimisticIds) {
    const queries = optimisticIds.map((id)=>(0, _reactquery.useQuery)({
            queryKey: [
                'tryon-progress',
                id
            ],
            enabled: Boolean(id),
            refetchInterval: 500,
            staleTime: 0
        }));
    const progressMap = (0, _react.useMemo)(()=>{
        const map = {};
        optimisticIds.forEach((id, index)=>{
            const data = queries[index]?.data;
            if (data) {
                map[id] = data;
            }
        });
        return map;
    }, [
        optimisticIds,
        queries
    ]);
    const anyInProgress = (0, _react.useMemo)(()=>{
        return Object.values(progressMap).some((progress)=>progress.status === 'processing');
    }, [
        progressMap
    ]);
    const allCompleted = (0, _react.useMemo)(()=>{
        return optimisticIds.length > 0 && Object.keys(progressMap).length === optimisticIds.length && Object.values(progressMap).every((progress)=>progress.status !== 'processing');
    }, [
        optimisticIds,
        progressMap
    ]);
    return {
        progressMap,
        anyInProgress,
        allCompleted
    };
}
function useTryonResult(optimisticId) {
    const resultQuery = (0, _reactquery.useQuery)({
        queryKey: [
            'tryon-result',
            optimisticId
        ],
        enabled: Boolean(optimisticId),
        staleTime: Infinity,
        gcTime: 60000 // Keep results for 1 minute
    });
    const data = resultQuery.data;
    return {
        result: data?.result,
        isLoading: resultQuery.isLoading,
        isCompleted: data?.status === 'completed',
        error: resultQuery.error,
        processingTime: data?.processingTime
    };
}
function useProgressVisualization(optimisticId, config = {}) {
    const { progress } = useTryonProgress(optimisticId);
    const progressPercentage = progress?.progress || 0;
    const stageMessage = (0, _react.useMemo)(()=>{
        if (!config.enableStageMessages || !progress) return '';
        switch(progress.stage){
            case 'image-processing':
                return 'Processing images...';
            case 'ai-generation':
                return 'Generating your try-on...';
            case 'post-processing':
                return 'Adding final touches...';
            case 'finalizing':
                return 'Almost done...';
            case 'completed':
                return 'Complete!';
            case 'error':
                return 'Something went wrong';
            default:
                return 'Processing...';
        }
    }, [
        config.enableStageMessages,
        progress
    ]);
    const timeRemaining = (0, _react.useMemo)(()=>{
        if (!config.enableTimeEstimates || !progress?.estimatedTimeRemaining) return '';
        const seconds = Math.ceil(progress.estimatedTimeRemaining / 1000);
        if (seconds <= 0) return '';
        if (seconds < 60) return `${seconds}s remaining`;
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}m ${remainingSeconds}s remaining`;
    }, [
        config.enableTimeEstimates,
        progress
    ]);
    const progressColor = (0, _react.useMemo)(()=>{
        if (!progress) return '#e5e7eb';
        switch(progress.status){
            case 'processing':
                return '#3b82f6'; // Blue for processing
            case 'completed':
                return '#10b981'; // Green for completed
            case 'error':
                return '#ef4444'; // Red for error
            default:
                return '#e5e7eb'; // Gray for idle
        }
    }, [
        progress
    ]);
    const isAnimating = (0, _react.useMemo)(()=>{
        return config.enableAnimation !== false && progress?.status === 'processing';
    }, [
        config.enableAnimation,
        progress
    ]);
    return {
        progress,
        progressPercentage,
        stageMessage,
        timeRemaining,
        progressColor,
        isAnimating
    };
}
function useOptimisticCacheInvalidation() {
    const queryClient = (0, _reactquery.useQueryClient)();
    const invalidateRelatedQueries = (0, _react.useCallback)(async (context)=>{
        // Invalidate history queries
        await queryClient.invalidateQueries({
            queryKey: [
                'tryon-history'
            ],
            exact: false
        });
        // Invalidate user-specific queries if userId provided
        if (context?.userId) {
            await queryClient.invalidateQueries({
                queryKey: [
                    'user-data',
                    context.userId
                ],
                exact: false
            });
        }
        // Invalidate tag-specific queries if tags provided
        if (context?.tags?.length) {
            for (const tag of context.tags){
                await queryClient.invalidateQueries({
                    queryKey: [
                        'tryon-by-tag',
                        tag
                    ],
                    exact: false
                });
            }
        }
        // Invalidate stats and aggregations
        await queryClient.invalidateQueries({
            queryKey: [
                'tryon-stats'
            ],
            exact: false
        });
    }, [
        queryClient
    ]);
    const preloadRelatedQueries = (0, _react.useCallback)(async (context)=>{
        // Preload frequently accessed queries
        const preloadPromises = [];
        // Preload history
        preloadPromises.push(queryClient.prefetchQuery({
            queryKey: [
                'tryon-history',
                'entries'
            ],
            staleTime: 30000
        }));
        // Preload stats
        preloadPromises.push(queryClient.prefetchQuery({
            queryKey: [
                'tryon-history',
                'stats'
            ],
            staleTime: 60000
        }));
        if (context?.userId) {
            preloadPromises.push(queryClient.prefetchQuery({
                queryKey: [
                    'user-data',
                    context.userId
                ],
                staleTime: 60000
            }));
        }
        await Promise.all(preloadPromises);
    }, [
        queryClient
    ]);
    const warmupCache = (0, _react.useCallback)(async (prefetchData)=>{
        // Warm up the cache with commonly used data
        if (prefetchData?.length) {
            prefetchData.forEach((data, index)=>{
                queryClient.setQueryData([
                    'warmup-cache',
                    index
                ], data);
            });
        }
        // Prefetch critical queries that are likely to be needed
        await preloadRelatedQueries();
    }, [
        queryClient,
        preloadRelatedQueries
    ]);
    return {
        invalidateRelatedQueries,
        preloadRelatedQueries,
        warmupCache
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy93aWxsc3RyZWV0ZXIvV2Vic3Rvcm1Qcm9qZWN0cy92aWJlLWNvZGluZy90aG9zZS1wZW9wbGUvVGhlLVN1cy1GaXQtZ3Avc3JjL2J1c2luZXNzLWxheWVyL2hvb2tzL3VzZU9wdGltaXN0aWNVcGRhdGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIE9wdGltaXN0aWMgVXBkYXRlcyBIb29rc1xuLy8gUmVhY3QgaG9va3MgZm9yIG1hbmFnaW5nIG9wdGltaXN0aWMgVUkgdXBkYXRlcyBhbmQgcHJvZ3Jlc3MgaW5kaWNhdG9yc1xuXG5pbXBvcnQgeyB1c2VRdWVyeSwgdXNlUXVlcnlDbGllbnQgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtcXVlcnknO1xuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZU1lbW8sIHVzZVJlZiwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHR5cGUge1xuICBPcHRpbWlzdGljVXBkYXRlQ29uZmlnLFxuICBPcHRpbWlzdGljVXBkYXRlQ29udGV4dCxcbiAgT3B0aW1pc3RpY1VwZGF0ZXNNYW5hZ2VyXG59IGZyb20gJy4uL3V0aWxzL29wdGltaXN0aWNVcGRhdGVzJztcbmltcG9ydCB7IGdldE9wdGltaXN0aWNVcGRhdGVzTWFuYWdlciB9IGZyb20gJy4uL3V0aWxzL29wdGltaXN0aWNVcGRhdGVzJztcblxuLyoqXG4gKiBQcm9ncmVzcyBkYXRhIHN0cnVjdHVyZSBmb3IgdHJ5LW9uIG9wZXJhdGlvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUcnlvblByb2dyZXNzIHtcbiAgaWQ6IHN0cmluZztcbiAgc3RhdHVzOiAncHJvY2Vzc2luZycgfCAnY29tcGxldGVkJyB8ICdlcnJvcic7XG4gIHByb2dyZXNzOiBudW1iZXI7IC8vIDAtMTAwXG4gIHN0YWdlOiBzdHJpbmc7XG4gIGVzdGltYXRlZFRpbWVSZW1haW5pbmc6IG51bWJlcjtcbiAgc3RhcnRUaW1lOiBudW1iZXI7XG4gIGNvbXBsZXRlZEF0PzogbnVtYmVyO1xuICBlcnJvcj86IHN0cmluZztcbiAgcmVzdWx0PzogdW5rbm93bjtcbn1cblxuLyoqXG4gKiBIb29rIHJldHVybiB0eXBlIGZvciBvcHRpbWlzdGljIHVwZGF0ZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBVc2VPcHRpbWlzdGljVXBkYXRlc1JldHVybiB7XG4gIC8qKiBTdGFydCBhbiBvcHRpbWlzdGljIHVwZGF0ZSAqL1xuICBzdGFydE9wdGltaXN0aWM6IChjb25maWc/OiBPcHRpbWlzdGljVXBkYXRlQ29uZmlnKSA9PiBzdHJpbmc7XG4gIC8qKiBDb21wbGV0ZSBhbiBvcHRpbWlzdGljIHVwZGF0ZSAqL1xuICBjb21wbGV0ZU9wdGltaXN0aWM6IChvcHRpbWlzdGljSWQ6IHN0cmluZywgcmVzdWx0OiB1bmtub3duLCBjb250ZXh0PzogdW5rbm93bikgPT4gdm9pZDtcbiAgLyoqIFJvbGxiYWNrIGFuIG9wdGltaXN0aWMgdXBkYXRlICovXG4gIHJvbGxiYWNrT3B0aW1pc3RpYzogKG9wdGltaXN0aWNJZDogc3RyaW5nLCBlcnJvcj86IHVua25vd24pID0+IHZvaWQ7XG4gIC8qKiBDaGVjayBpZiBvcHRpbWlzdGljIHVwZGF0ZXMgYXJlIGVuYWJsZWQgKi9cbiAgaXNPcHRpbWlzdGljRW5hYmxlZDogYm9vbGVhbjtcbiAgLyoqIEdldCBjdXJyZW50IGFjdGl2ZSBvcHRpbWlzdGljIHVwZGF0ZXMgKi9cbiAgYWN0aXZlVXBkYXRlczogT3B0aW1pc3RpY1VwZGF0ZUNvbnRleHRbXTtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGZvciB0aGUgb3B0aW1pc3RpYyB1cGRhdGVzIGhvb2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBVc2VPcHRpbWlzdGljVXBkYXRlc0NvbmZpZyB7XG4gIC8qKiBWYXJpYWJsZXMgZm9yIHRoZSB0cnktb24gbXV0YXRpb24gKi9cbiAgbXV0YXRpb25WYXJpYWJsZXM/OiB1bmtub3duO1xuICAvKiogV2hldGhlciBvcHRpbWlzdGljIHVwZGF0ZXMgYXJlIGVuYWJsZWQgKi9cbiAgZW5hYmxlZD86IGJvb2xlYW47XG4gIC8qKiBDdXN0b20gb3B0aW1pc3RpYyB1cGRhdGVzIG1hbmFnZXIgKi9cbiAgb3B0aW1pc3RpY01hbmFnZXI/OiBPcHRpbWlzdGljVXBkYXRlc01hbmFnZXI7XG59XG5cbi8qKlxuICogSG9vayBmb3IgbWFuYWdpbmcgb3B0aW1pc3RpYyB1cGRhdGVzIGR1cmluZyB0cnktb24gbXV0YXRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VPcHRpbWlzdGljVXBkYXRlcyhcbiAgY29uZmlnOiBVc2VPcHRpbWlzdGljVXBkYXRlc0NvbmZpZyA9IHt9XG4pOiBVc2VPcHRpbWlzdGljVXBkYXRlc1JldHVybiB7XG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gdXNlUXVlcnlDbGllbnQoKTtcbiAgY29uc3Qgb3B0aW1pc3RpY01hbmFnZXIgPSBjb25maWcub3B0aW1pc3RpY01hbmFnZXIgfHwgZ2V0T3B0aW1pc3RpY1VwZGF0ZXNNYW5hZ2VyKCk7XG4gIGNvbnN0IGFjdGl2ZVVwZGF0ZXNSZWYgPSB1c2VSZWY8U2V0PHN0cmluZz4+KG5ldyBTZXQoKSk7XG5cbiAgY29uc3QgaXNPcHRpbWlzdGljRW5hYmxlZCA9IGNvbmZpZy5lbmFibGVkICE9PSBmYWxzZTtcblxuICAvLyBHZXQgYWN0aXZlIG9wdGltaXN0aWMgdXBkYXRlc1xuICBjb25zdCBhY3RpdmVVcGRhdGVzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgcmV0dXJuIG9wdGltaXN0aWNNYW5hZ2VyLmdldEFjdGl2ZU9wdGltaXN0aWNVcGRhdGVzKCk7XG4gIH0sIFtvcHRpbWlzdGljTWFuYWdlcl0pO1xuXG4gIGNvbnN0IHN0YXJ0T3B0aW1pc3RpYyA9IHVzZUNhbGxiYWNrKChvcHRpbWlzdGljQ29uZmlnPzogT3B0aW1pc3RpY1VwZGF0ZUNvbmZpZyk6IHN0cmluZyA9PiB7XG4gICAgaWYgKCFpc09wdGltaXN0aWNFbmFibGVkIHx8ICFjb25maWcubXV0YXRpb25WYXJpYWJsZXMpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBjb25zdCBjb250ZXh0ID0gb3B0aW1pc3RpY01hbmFnZXIuc3RhcnRPcHRpbWlzdGljVXBkYXRlKFxuICAgICAgY29uZmlnLm11dGF0aW9uVmFyaWFibGVzIGFzIGFueSxcbiAgICAgIG9wdGltaXN0aWNDb25maWdcbiAgICApO1xuXG4gICAgYWN0aXZlVXBkYXRlc1JlZi5jdXJyZW50LmFkZChjb250ZXh0Lm9wdGltaXN0aWNJZCk7XG4gICAgcmV0dXJuIGNvbnRleHQub3B0aW1pc3RpY0lkO1xuICB9LCBbaXNPcHRpbWlzdGljRW5hYmxlZCwgY29uZmlnLm11dGF0aW9uVmFyaWFibGVzLCBvcHRpbWlzdGljTWFuYWdlcl0pO1xuXG4gIGNvbnN0IGNvbXBsZXRlT3B0aW1pc3RpYyA9IHVzZUNhbGxiYWNrKChcbiAgICBvcHRpbWlzdGljSWQ6IHN0cmluZyxcbiAgICByZXN1bHQ6IHVua25vd24sXG4gICAgbXV0YXRpb25Db250ZXh0PzogdW5rbm93blxuICApID0+IHtcbiAgICBpZiAoIW9wdGltaXN0aWNJZCB8fCAhYWN0aXZlVXBkYXRlc1JlZi5jdXJyZW50LmhhcyhvcHRpbWlzdGljSWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgb3B0aW1pc3RpY01hbmFnZXIuY29tcGxldGVPcHRpbWlzdGljVXBkYXRlKFxuICAgICAgb3B0aW1pc3RpY0lkLFxuICAgICAgcmVzdWx0IGFzIGFueSxcbiAgICAgIG11dGF0aW9uQ29udGV4dCBhcyBhbnlcbiAgICApO1xuXG4gICAgYWN0aXZlVXBkYXRlc1JlZi5jdXJyZW50LmRlbGV0ZShvcHRpbWlzdGljSWQpO1xuICB9LCBbb3B0aW1pc3RpY01hbmFnZXJdKTtcblxuICBjb25zdCByb2xsYmFja09wdGltaXN0aWMgPSB1c2VDYWxsYmFjaygob3B0aW1pc3RpY0lkOiBzdHJpbmcsIGVycm9yPzogdW5rbm93bikgPT4ge1xuICAgIGlmICghb3B0aW1pc3RpY0lkIHx8ICFhY3RpdmVVcGRhdGVzUmVmLmN1cnJlbnQuaGFzKG9wdGltaXN0aWNJZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBvcHRpbWlzdGljTWFuYWdlci5yb2xsYmFja09wdGltaXN0aWNVcGRhdGUob3B0aW1pc3RpY0lkLCBlcnJvcik7XG4gICAgYWN0aXZlVXBkYXRlc1JlZi5jdXJyZW50LmRlbGV0ZShvcHRpbWlzdGljSWQpO1xuICB9LCBbb3B0aW1pc3RpY01hbmFnZXJdKTtcblxuICAvLyBDbGVhbnVwIG9uIHVubW91bnRcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgLy8gUm9sbGJhY2sgYW55IHJlbWFpbmluZyBvcHRpbWlzdGljIHVwZGF0ZXNcbiAgICAgIGFjdGl2ZVVwZGF0ZXNSZWYuY3VycmVudC5mb3JFYWNoKG9wdGltaXN0aWNJZCA9PiB7XG4gICAgICAgIG9wdGltaXN0aWNNYW5hZ2VyLnJvbGxiYWNrT3B0aW1pc3RpY1VwZGF0ZShvcHRpbWlzdGljSWQsIG5ldyBFcnJvcignQ29tcG9uZW50IHVubW91bnRlZCcpKTtcbiAgICAgIH0pO1xuICAgICAgYWN0aXZlVXBkYXRlc1JlZi5jdXJyZW50LmNsZWFyKCk7XG4gICAgfTtcbiAgfSwgW29wdGltaXN0aWNNYW5hZ2VyXSk7XG5cbiAgcmV0dXJuIHtcbiAgICBzdGFydE9wdGltaXN0aWMsXG4gICAgY29tcGxldGVPcHRpbWlzdGljLFxuICAgIHJvbGxiYWNrT3B0aW1pc3RpYyxcbiAgICBpc09wdGltaXN0aWNFbmFibGVkLFxuICAgIGFjdGl2ZVVwZGF0ZXNcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciB0cmFja2luZyBwcm9ncmVzcyBvZiB0cnktb24gb3BlcmF0aW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlVHJ5b25Qcm9ncmVzcyhvcHRpbWlzdGljSWQ6IHN0cmluZyk6IHtcbiAgcHJvZ3Jlc3M6IFRyeW9uUHJvZ3Jlc3MgfCB1bmRlZmluZWQ7XG4gIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgZXJyb3I6IEVycm9yIHwgbnVsbDtcbn0ge1xuICBjb25zdCBwcm9ncmVzc1F1ZXJ5ID0gdXNlUXVlcnkoe1xuICAgIHF1ZXJ5S2V5OiBbJ3RyeW9uLXByb2dyZXNzJywgb3B0aW1pc3RpY0lkXSxcbiAgICBlbmFibGVkOiBCb29sZWFuKG9wdGltaXN0aWNJZCksXG4gICAgcmVmZXRjaEludGVydmFsOiAoZGF0YSkgPT4ge1xuICAgICAgLy8gU3RvcCByZWZldGNoaW5nIG9uY2UgY29tcGxldGVkIG9yIGVycm9yZWRcbiAgICAgIGNvbnN0IHByb2dyZXNzRGF0YSA9IGRhdGEgYXMgdW5rbm93biBhcyBUcnlvblByb2dyZXNzIHwgdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIHByb2dyZXNzRGF0YT8uc3RhdHVzID09PSAncHJvY2Vzc2luZycgPyA1MDAgOiBmYWxzZTtcbiAgICB9LFxuICAgIHN0YWxlVGltZTogMCwgLy8gQWx3YXlzIGZyZXNoIGZvciByZWFsLXRpbWUgdXBkYXRlc1xuICAgIGdjVGltZTogNTAwMCAvLyBLZWVwIGluIGNhY2hlIGJyaWVmbHkgYWZ0ZXIgY29tcGxldGlvblxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHByb2dyZXNzOiBwcm9ncmVzc1F1ZXJ5LmRhdGEgYXMgVHJ5b25Qcm9ncmVzcyB8IHVuZGVmaW5lZCxcbiAgICBpc0xvYWRpbmc6IHByb2dyZXNzUXVlcnkuaXNMb2FkaW5nLFxuICAgIGVycm9yOiBwcm9ncmVzc1F1ZXJ5LmVycm9yXG4gIH07XG59XG5cbi8qKlxuICogSG9vayBmb3IgdHJhY2tpbmcgbXVsdGlwbGUgdHJ5LW9uIHByb2dyZXNzIGluc3RhbmNlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlTXVsdGlwbGVUcnlvblByb2dyZXNzKG9wdGltaXN0aWNJZHM6IHN0cmluZ1tdKToge1xuICBwcm9ncmVzc01hcDogUmVjb3JkPHN0cmluZywgVHJ5b25Qcm9ncmVzcz47XG4gIGFueUluUHJvZ3Jlc3M6IGJvb2xlYW47XG4gIGFsbENvbXBsZXRlZDogYm9vbGVhbjtcbn0ge1xuICBjb25zdCBxdWVyaWVzID0gb3B0aW1pc3RpY0lkcy5tYXAoaWQgPT4gXG4gICAgdXNlUXVlcnkoe1xuICAgICAgcXVlcnlLZXk6IFsndHJ5b24tcHJvZ3Jlc3MnLCBpZF0sXG4gICAgICBlbmFibGVkOiBCb29sZWFuKGlkKSxcbiAgICAgIHJlZmV0Y2hJbnRlcnZhbDogNTAwLFxuICAgICAgc3RhbGVUaW1lOiAwXG4gICAgfSlcbiAgKTtcblxuICBjb25zdCBwcm9ncmVzc01hcCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IG1hcDogUmVjb3JkPHN0cmluZywgVHJ5b25Qcm9ncmVzcz4gPSB7fTtcbiAgICBvcHRpbWlzdGljSWRzLmZvckVhY2goKGlkLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHF1ZXJpZXNbaW5kZXhdPy5kYXRhIGFzIFRyeW9uUHJvZ3Jlc3MgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBtYXBbaWRdID0gZGF0YTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWFwO1xuICB9LCBbb3B0aW1pc3RpY0lkcywgcXVlcmllc10pO1xuXG4gIGNvbnN0IGFueUluUHJvZ3Jlc3MgPSB1c2VNZW1vKCgpID0+IHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhwcm9ncmVzc01hcCkuc29tZShwcm9ncmVzcyA9PiBwcm9ncmVzcy5zdGF0dXMgPT09ICdwcm9jZXNzaW5nJyk7XG4gIH0sIFtwcm9ncmVzc01hcF0pO1xuXG4gIGNvbnN0IGFsbENvbXBsZXRlZCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiBvcHRpbWlzdGljSWRzLmxlbmd0aCA+IDAgJiYgXG4gICAgICAgICAgIE9iamVjdC5rZXlzKHByb2dyZXNzTWFwKS5sZW5ndGggPT09IG9wdGltaXN0aWNJZHMubGVuZ3RoICYmXG4gICAgICAgICAgIE9iamVjdC52YWx1ZXMocHJvZ3Jlc3NNYXApLmV2ZXJ5KHByb2dyZXNzID0+IHByb2dyZXNzLnN0YXR1cyAhPT0gJ3Byb2Nlc3NpbmcnKTtcbiAgfSwgW29wdGltaXN0aWNJZHMsIHByb2dyZXNzTWFwXSk7XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9ncmVzc01hcCxcbiAgICBhbnlJblByb2dyZXNzLFxuICAgIGFsbENvbXBsZXRlZFxuICB9O1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGdldHRpbmcgdHJ5LW9uIHJlc3VsdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVRyeW9uUmVzdWx0KG9wdGltaXN0aWNJZDogc3RyaW5nKToge1xuICByZXN1bHQ6IHVua25vd247XG4gIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgaXNDb21wbGV0ZWQ6IGJvb2xlYW47XG4gIGVycm9yOiBFcnJvciB8IG51bGw7XG4gIHByb2Nlc3NpbmdUaW1lPzogbnVtYmVyO1xufSB7XG4gIGNvbnN0IHJlc3VsdFF1ZXJ5ID0gdXNlUXVlcnkoe1xuICAgIHF1ZXJ5S2V5OiBbJ3RyeW9uLXJlc3VsdCcsIG9wdGltaXN0aWNJZF0sXG4gICAgZW5hYmxlZDogQm9vbGVhbihvcHRpbWlzdGljSWQpLFxuICAgIHN0YWxlVGltZTogSW5maW5pdHksIC8vIFJlc3VsdHMgZG9uJ3QgY2hhbmdlIG9uY2Ugc2V0XG4gICAgZ2NUaW1lOiA2MDAwMCAvLyBLZWVwIHJlc3VsdHMgZm9yIDEgbWludXRlXG4gIH0pO1xuXG4gIGNvbnN0IGRhdGEgPSByZXN1bHRRdWVyeS5kYXRhIGFzIGFueTtcbiAgXG4gIHJldHVybiB7XG4gICAgcmVzdWx0OiBkYXRhPy5yZXN1bHQsXG4gICAgaXNMb2FkaW5nOiByZXN1bHRRdWVyeS5pc0xvYWRpbmcsXG4gICAgaXNDb21wbGV0ZWQ6IGRhdGE/LnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcsXG4gICAgZXJyb3I6IHJlc3VsdFF1ZXJ5LmVycm9yLFxuICAgIHByb2Nlc3NpbmdUaW1lOiBkYXRhPy5wcm9jZXNzaW5nVGltZVxuICB9O1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIHByb2dyZXNzIHZpc3VhbGl6YXRpb24gYW5kIFVJIGZlZWRiYWNrXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VQcm9ncmVzc1Zpc3VhbGl6YXRpb24oXG4gIG9wdGltaXN0aWNJZDogc3RyaW5nLFxuICBjb25maWc6IHtcbiAgICBlbmFibGVTdGFnZU1lc3NhZ2VzPzogYm9vbGVhbjtcbiAgICBlbmFibGVUaW1lRXN0aW1hdGVzPzogYm9vbGVhbjtcbiAgICBlbmFibGVBbmltYXRpb24/OiBib29sZWFuO1xuICB9ID0ge31cbik6IHtcbiAgcHJvZ3Jlc3M6IFRyeW9uUHJvZ3Jlc3MgfCB1bmRlZmluZWQ7XG4gIHByb2dyZXNzUGVyY2VudGFnZTogbnVtYmVyO1xuICBzdGFnZU1lc3NhZ2U6IHN0cmluZztcbiAgdGltZVJlbWFpbmluZzogc3RyaW5nO1xuICBwcm9ncmVzc0NvbG9yOiBzdHJpbmc7XG4gIGlzQW5pbWF0aW5nOiBib29sZWFuO1xufSB7XG4gIGNvbnN0IHsgcHJvZ3Jlc3MgfSA9IHVzZVRyeW9uUHJvZ3Jlc3Mob3B0aW1pc3RpY0lkKTtcbiAgXG4gIGNvbnN0IHByb2dyZXNzUGVyY2VudGFnZSA9IHByb2dyZXNzPy5wcm9ncmVzcyB8fCAwO1xuICBcbiAgY29uc3Qgc3RhZ2VNZXNzYWdlID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFjb25maWcuZW5hYmxlU3RhZ2VNZXNzYWdlcyB8fCAhcHJvZ3Jlc3MpIHJldHVybiAnJztcbiAgICBcbiAgICBzd2l0Y2ggKHByb2dyZXNzLnN0YWdlKSB7XG4gICAgICBjYXNlICdpbWFnZS1wcm9jZXNzaW5nJzpcbiAgICAgICAgcmV0dXJuICdQcm9jZXNzaW5nIGltYWdlcy4uLic7XG4gICAgICBjYXNlICdhaS1nZW5lcmF0aW9uJzpcbiAgICAgICAgcmV0dXJuICdHZW5lcmF0aW5nIHlvdXIgdHJ5LW9uLi4uJztcbiAgICAgIGNhc2UgJ3Bvc3QtcHJvY2Vzc2luZyc6XG4gICAgICAgIHJldHVybiAnQWRkaW5nIGZpbmFsIHRvdWNoZXMuLi4nO1xuICAgICAgY2FzZSAnZmluYWxpemluZyc6XG4gICAgICAgIHJldHVybiAnQWxtb3N0IGRvbmUuLi4nO1xuICAgICAgY2FzZSAnY29tcGxldGVkJzpcbiAgICAgICAgcmV0dXJuICdDb21wbGV0ZSEnO1xuICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICByZXR1cm4gJ1NvbWV0aGluZyB3ZW50IHdyb25nJztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAnUHJvY2Vzc2luZy4uLic7XG4gICAgfVxuICB9LCBbY29uZmlnLmVuYWJsZVN0YWdlTWVzc2FnZXMsIHByb2dyZXNzXSk7XG4gIFxuICBjb25zdCB0aW1lUmVtYWluaW5nID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFjb25maWcuZW5hYmxlVGltZUVzdGltYXRlcyB8fCAhcHJvZ3Jlc3M/LmVzdGltYXRlZFRpbWVSZW1haW5pbmcpIHJldHVybiAnJztcbiAgICBcbiAgICBjb25zdCBzZWNvbmRzID0gTWF0aC5jZWlsKHByb2dyZXNzLmVzdGltYXRlZFRpbWVSZW1haW5pbmcgLyAxMDAwKTtcbiAgICBpZiAoc2Vjb25kcyA8PSAwKSByZXR1cm4gJyc7XG4gICAgaWYgKHNlY29uZHMgPCA2MCkgcmV0dXJuIGAke3NlY29uZHN9cyByZW1haW5pbmdgO1xuICAgIFxuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MCk7XG4gICAgY29uc3QgcmVtYWluaW5nU2Vjb25kcyA9IHNlY29uZHMgJSA2MDtcbiAgICByZXR1cm4gYCR7bWludXRlc31tICR7cmVtYWluaW5nU2Vjb25kc31zIHJlbWFpbmluZ2A7XG4gIH0sIFtjb25maWcuZW5hYmxlVGltZUVzdGltYXRlcywgcHJvZ3Jlc3NdKTtcbiAgXG4gIGNvbnN0IHByb2dyZXNzQ29sb3IgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAoIXByb2dyZXNzKSByZXR1cm4gJyNlNWU3ZWInO1xuICAgIFxuICAgIHN3aXRjaCAocHJvZ3Jlc3Muc3RhdHVzKSB7XG4gICAgICBjYXNlICdwcm9jZXNzaW5nJzpcbiAgICAgICAgcmV0dXJuICcjM2I4MmY2JzsgLy8gQmx1ZSBmb3IgcHJvY2Vzc2luZ1xuICAgICAgY2FzZSAnY29tcGxldGVkJzpcbiAgICAgICAgcmV0dXJuICcjMTBiOTgxJzsgLy8gR3JlZW4gZm9yIGNvbXBsZXRlZFxuICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICByZXR1cm4gJyNlZjQ0NDQnOyAvLyBSZWQgZm9yIGVycm9yXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJyNlNWU3ZWInOyAvLyBHcmF5IGZvciBpZGxlXG4gICAgfVxuICB9LCBbcHJvZ3Jlc3NdKTtcbiAgXG4gIGNvbnN0IGlzQW5pbWF0aW5nID0gdXNlTWVtbygoKSA9PiB7XG4gICAgcmV0dXJuIGNvbmZpZy5lbmFibGVBbmltYXRpb24gIT09IGZhbHNlICYmIFxuICAgICAgICAgICBwcm9ncmVzcz8uc3RhdHVzID09PSAncHJvY2Vzc2luZyc7XG4gIH0sIFtjb25maWcuZW5hYmxlQW5pbWF0aW9uLCBwcm9ncmVzc10pO1xuXG4gIHJldHVybiB7XG4gICAgcHJvZ3Jlc3MsXG4gICAgcHJvZ3Jlc3NQZXJjZW50YWdlLFxuICAgIHN0YWdlTWVzc2FnZSxcbiAgICB0aW1lUmVtYWluaW5nLFxuICAgIHByb2dyZXNzQ29sb3IsXG4gICAgaXNBbmltYXRpbmdcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBvcHRpbWlzdGljIGNhY2hlIGludmFsaWRhdGlvbiBzdHJhdGVnaWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VPcHRpbWlzdGljQ2FjaGVJbnZhbGlkYXRpb24oKToge1xuICBpbnZhbGlkYXRlUmVsYXRlZFF1ZXJpZXM6IChjb250ZXh0PzogeyB1c2VySWQ/OiBzdHJpbmc7IHRhZ3M/OiBzdHJpbmdbXSB9KSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcmVsb2FkUmVsYXRlZFF1ZXJpZXM6IChjb250ZXh0PzogeyB1c2VySWQ/OiBzdHJpbmcgfSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgd2FybXVwQ2FjaGU6IChwcmVmZXRjaERhdGE/OiB1bmtub3duW10pID0+IFByb21pc2U8dm9pZD47XG59IHtcbiAgY29uc3QgcXVlcnlDbGllbnQgPSB1c2VRdWVyeUNsaWVudCgpO1xuXG4gIGNvbnN0IGludmFsaWRhdGVSZWxhdGVkUXVlcmllcyA9IHVzZUNhbGxiYWNrKGFzeW5jIChjb250ZXh0PzogeyB1c2VySWQ/OiBzdHJpbmc7IHRhZ3M/OiBzdHJpbmdbXSB9KSA9PiB7XG4gICAgLy8gSW52YWxpZGF0ZSBoaXN0b3J5IHF1ZXJpZXNcbiAgICBhd2FpdCBxdWVyeUNsaWVudC5pbnZhbGlkYXRlUXVlcmllcyh7IFxuICAgICAgcXVlcnlLZXk6IFsndHJ5b24taGlzdG9yeSddLFxuICAgICAgZXhhY3Q6IGZhbHNlIFxuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSB1c2VyLXNwZWNpZmljIHF1ZXJpZXMgaWYgdXNlcklkIHByb3ZpZGVkXG4gICAgaWYgKGNvbnRleHQ/LnVzZXJJZCkge1xuICAgICAgYXdhaXQgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoeyBcbiAgICAgICAgcXVlcnlLZXk6IFsndXNlci1kYXRhJywgY29udGV4dC51c2VySWRdLFxuICAgICAgICBleGFjdDogZmFsc2UgXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBJbnZhbGlkYXRlIHRhZy1zcGVjaWZpYyBxdWVyaWVzIGlmIHRhZ3MgcHJvdmlkZWRcbiAgICBpZiAoY29udGV4dD8udGFncz8ubGVuZ3RoKSB7XG4gICAgICBmb3IgKGNvbnN0IHRhZyBvZiBjb250ZXh0LnRhZ3MpIHtcbiAgICAgICAgYXdhaXQgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoeyBcbiAgICAgICAgICBxdWVyeUtleTogWyd0cnlvbi1ieS10YWcnLCB0YWddLFxuICAgICAgICAgIGV4YWN0OiBmYWxzZSBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW52YWxpZGF0ZSBzdGF0cyBhbmQgYWdncmVnYXRpb25zXG4gICAgYXdhaXQgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoeyBcbiAgICAgIHF1ZXJ5S2V5OiBbJ3RyeW9uLXN0YXRzJ10sXG4gICAgICBleGFjdDogZmFsc2UgXG4gICAgfSk7XG4gIH0sIFtxdWVyeUNsaWVudF0pO1xuXG4gIGNvbnN0IHByZWxvYWRSZWxhdGVkUXVlcmllcyA9IHVzZUNhbGxiYWNrKGFzeW5jIChjb250ZXh0PzogeyB1c2VySWQ/OiBzdHJpbmcgfSkgPT4ge1xuICAgIC8vIFByZWxvYWQgZnJlcXVlbnRseSBhY2Nlc3NlZCBxdWVyaWVzXG4gICAgY29uc3QgcHJlbG9hZFByb21pc2VzID0gW107XG5cbiAgICAvLyBQcmVsb2FkIGhpc3RvcnlcbiAgICBwcmVsb2FkUHJvbWlzZXMucHVzaChcbiAgICAgIHF1ZXJ5Q2xpZW50LnByZWZldGNoUXVlcnkoe1xuICAgICAgICBxdWVyeUtleTogWyd0cnlvbi1oaXN0b3J5JywgJ2VudHJpZXMnXSxcbiAgICAgICAgc3RhbGVUaW1lOiAzMDAwMFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gUHJlbG9hZCBzdGF0c1xuICAgIHByZWxvYWRQcm9taXNlcy5wdXNoKFxuICAgICAgcXVlcnlDbGllbnQucHJlZmV0Y2hRdWVyeSh7XG4gICAgICAgIHF1ZXJ5S2V5OiBbJ3RyeW9uLWhpc3RvcnknLCAnc3RhdHMnXSxcbiAgICAgICAgc3RhbGVUaW1lOiA2MDAwMFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgaWYgKGNvbnRleHQ/LnVzZXJJZCkge1xuICAgICAgcHJlbG9hZFByb21pc2VzLnB1c2goXG4gICAgICAgIHF1ZXJ5Q2xpZW50LnByZWZldGNoUXVlcnkoe1xuICAgICAgICAgIHF1ZXJ5S2V5OiBbJ3VzZXItZGF0YScsIGNvbnRleHQudXNlcklkXSxcbiAgICAgICAgICBzdGFsZVRpbWU6IDYwMDAwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cblxuICAgIGF3YWl0IFByb21pc2UuYWxsKHByZWxvYWRQcm9taXNlcyk7XG4gIH0sIFtxdWVyeUNsaWVudF0pO1xuXG4gIGNvbnN0IHdhcm11cENhY2hlID0gdXNlQ2FsbGJhY2soYXN5bmMgKHByZWZldGNoRGF0YT86IHVua25vd25bXSkgPT4ge1xuICAgIC8vIFdhcm0gdXAgdGhlIGNhY2hlIHdpdGggY29tbW9ubHkgdXNlZCBkYXRhXG4gICAgaWYgKHByZWZldGNoRGF0YT8ubGVuZ3RoKSB7XG4gICAgICBwcmVmZXRjaERhdGEuZm9yRWFjaCgoZGF0YSwgaW5kZXgpID0+IHtcbiAgICAgICAgcXVlcnlDbGllbnQuc2V0UXVlcnlEYXRhKFsnd2FybXVwLWNhY2hlJywgaW5kZXhdLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFByZWZldGNoIGNyaXRpY2FsIHF1ZXJpZXMgdGhhdCBhcmUgbGlrZWx5IHRvIGJlIG5lZWRlZFxuICAgIGF3YWl0IHByZWxvYWRSZWxhdGVkUXVlcmllcygpO1xuICB9LCBbcXVlcnlDbGllbnQsIHByZWxvYWRSZWxhdGVkUXVlcmllc10pO1xuXG4gIHJldHVybiB7XG4gICAgaW52YWxpZGF0ZVJlbGF0ZWRRdWVyaWVzLFxuICAgIHByZWxvYWRSZWxhdGVkUXVlcmllcyxcbiAgICB3YXJtdXBDYWNoZVxuICB9O1xufSJdLCJuYW1lcyI6WyJ1c2VNdWx0aXBsZVRyeW9uUHJvZ3Jlc3MiLCJ1c2VPcHRpbWlzdGljQ2FjaGVJbnZhbGlkYXRpb24iLCJ1c2VPcHRpbWlzdGljVXBkYXRlcyIsInVzZVByb2dyZXNzVmlzdWFsaXphdGlvbiIsInVzZVRyeW9uUHJvZ3Jlc3MiLCJ1c2VUcnlvblJlc3VsdCIsImNvbmZpZyIsInF1ZXJ5Q2xpZW50IiwidXNlUXVlcnlDbGllbnQiLCJvcHRpbWlzdGljTWFuYWdlciIsImdldE9wdGltaXN0aWNVcGRhdGVzTWFuYWdlciIsImFjdGl2ZVVwZGF0ZXNSZWYiLCJ1c2VSZWYiLCJTZXQiLCJpc09wdGltaXN0aWNFbmFibGVkIiwiZW5hYmxlZCIsImFjdGl2ZVVwZGF0ZXMiLCJ1c2VNZW1vIiwiZ2V0QWN0aXZlT3B0aW1pc3RpY1VwZGF0ZXMiLCJzdGFydE9wdGltaXN0aWMiLCJ1c2VDYWxsYmFjayIsIm9wdGltaXN0aWNDb25maWciLCJtdXRhdGlvblZhcmlhYmxlcyIsImNvbnRleHQiLCJzdGFydE9wdGltaXN0aWNVcGRhdGUiLCJjdXJyZW50IiwiYWRkIiwib3B0aW1pc3RpY0lkIiwiY29tcGxldGVPcHRpbWlzdGljIiwicmVzdWx0IiwibXV0YXRpb25Db250ZXh0IiwiaGFzIiwiY29tcGxldGVPcHRpbWlzdGljVXBkYXRlIiwiZGVsZXRlIiwicm9sbGJhY2tPcHRpbWlzdGljIiwiZXJyb3IiLCJyb2xsYmFja09wdGltaXN0aWNVcGRhdGUiLCJ1c2VFZmZlY3QiLCJmb3JFYWNoIiwiRXJyb3IiLCJjbGVhciIsInByb2dyZXNzUXVlcnkiLCJ1c2VRdWVyeSIsInF1ZXJ5S2V5IiwiQm9vbGVhbiIsInJlZmV0Y2hJbnRlcnZhbCIsImRhdGEiLCJwcm9ncmVzc0RhdGEiLCJzdGF0dXMiLCJzdGFsZVRpbWUiLCJnY1RpbWUiLCJwcm9ncmVzcyIsImlzTG9hZGluZyIsIm9wdGltaXN0aWNJZHMiLCJxdWVyaWVzIiwibWFwIiwiaWQiLCJwcm9ncmVzc01hcCIsImluZGV4IiwiYW55SW5Qcm9ncmVzcyIsIk9iamVjdCIsInZhbHVlcyIsInNvbWUiLCJhbGxDb21wbGV0ZWQiLCJsZW5ndGgiLCJrZXlzIiwiZXZlcnkiLCJyZXN1bHRRdWVyeSIsIkluZmluaXR5IiwiaXNDb21wbGV0ZWQiLCJwcm9jZXNzaW5nVGltZSIsInByb2dyZXNzUGVyY2VudGFnZSIsInN0YWdlTWVzc2FnZSIsImVuYWJsZVN0YWdlTWVzc2FnZXMiLCJzdGFnZSIsInRpbWVSZW1haW5pbmciLCJlbmFibGVUaW1lRXN0aW1hdGVzIiwiZXN0aW1hdGVkVGltZVJlbWFpbmluZyIsInNlY29uZHMiLCJNYXRoIiwiY2VpbCIsIm1pbnV0ZXMiLCJmbG9vciIsInJlbWFpbmluZ1NlY29uZHMiLCJwcm9ncmVzc0NvbG9yIiwiaXNBbmltYXRpbmciLCJlbmFibGVBbmltYXRpb24iLCJpbnZhbGlkYXRlUmVsYXRlZFF1ZXJpZXMiLCJpbnZhbGlkYXRlUXVlcmllcyIsImV4YWN0IiwidXNlcklkIiwidGFncyIsInRhZyIsInByZWxvYWRSZWxhdGVkUXVlcmllcyIsInByZWxvYWRQcm9taXNlcyIsInB1c2giLCJwcmVmZXRjaFF1ZXJ5IiwiUHJvbWlzZSIsImFsbCIsIndhcm11cENhY2hlIiwicHJlZmV0Y2hEYXRhIiwic2V0UXVlcnlEYXRhIl0sIm1hcHBpbmdzIjoiQUFBQSwyQkFBMkI7QUFDM0IseUVBQXlFOzs7Ozs7Ozs7Ozs7SUFrS3pEQSx3QkFBd0I7ZUFBeEJBOztJQThKQUMsOEJBQThCO2VBQTlCQTs7SUF2UUFDLG9CQUFvQjtlQUFwQkE7O0lBa0xBQyx3QkFBd0I7ZUFBeEJBOztJQXBHQUMsZ0JBQWdCO2VBQWhCQTs7SUF3RUFDLGNBQWM7ZUFBZEE7Ozs0QkE3TXlCO3VCQUNlO21DQU1aO0FBZ0RyQyxTQUFTSCxxQkFDZEksU0FBcUMsQ0FBQyxDQUFDO0lBRXZDLE1BQU1DLGNBQWNDLElBQUFBLDBCQUFjO0lBQ2xDLE1BQU1DLG9CQUFvQkgsT0FBT0csaUJBQWlCLElBQUlDLElBQUFBLDhDQUEyQjtJQUNqRixNQUFNQyxtQkFBbUJDLElBQUFBLGFBQU0sRUFBYyxJQUFJQztJQUVqRCxNQUFNQyxzQkFBc0JSLE9BQU9TLE9BQU8sS0FBSztJQUUvQyxnQ0FBZ0M7SUFDaEMsTUFBTUMsZ0JBQWdCQyxJQUFBQSxjQUFPLEVBQUM7UUFDNUIsT0FBT1Isa0JBQWtCUywwQkFBMEI7SUFDckQsR0FBRztRQUFDVDtLQUFrQjtJQUV0QixNQUFNVSxrQkFBa0JDLElBQUFBLGtCQUFXLEVBQUMsQ0FBQ0M7UUFDbkMsSUFBSSxDQUFDUCx1QkFBdUIsQ0FBQ1IsT0FBT2dCLGlCQUFpQixFQUFFO1lBQ3JELE9BQU87UUFDVDtRQUVBLE1BQU1DLFVBQVVkLGtCQUFrQmUscUJBQXFCLENBQ3JEbEIsT0FBT2dCLGlCQUFpQixFQUN4QkQ7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