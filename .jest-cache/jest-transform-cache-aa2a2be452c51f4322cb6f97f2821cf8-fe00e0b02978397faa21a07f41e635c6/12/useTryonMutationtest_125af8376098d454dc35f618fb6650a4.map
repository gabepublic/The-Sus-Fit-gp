{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/mutations/useTryonMutation.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport React from 'react';\nimport { render, screen, waitFor, act } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport type { \n  TryonMutationVariables,\n  TryonMutationVariablesWithFiles, \n  TryonMutationResponse,\n  TryonMutationError,\n  UseTryonMutationConfig \n} from '../../../src/business-layer/types/tryon.types';\n\n// Mock image processing utilities\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn().mockImplementation(() => Promise.resolve({\n    processedImage: 'data:image/jpeg;base64,processed-image-data',\n    originalSize: 1024,\n    processedSize: 512,\n    compressionRatio: 0.5,\n    processingTime: 100,\n    dimensions: { width: 1024, height: 1536 }\n  })),\n  ImageProcessingError: class ImageProcessingError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  ImageDimensionError: class ImageDimensionError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock image utilities\njest.mock('../../../src/utils/image', () => ({\n  FileTypeNotSupportedError: class FileTypeNotSupportedError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  FileTooLargeError: class FileTooLargeError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  CompressionFailedError: class CompressionFailedError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock error handling utilities\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn().mockImplementation((error) => {\n    const message = error?.message || 'Unknown error';\n    if (message.includes('Network')) {\n      return {\n        userMessage: 'Network connection issue. Please check your internet and try again.',\n        technicalMessage: 'Network error',\n        retryable: true,\n        category: 'network',\n        severity: 'medium',\n        recoveryActions: [{ type: 'check_connection', description: 'Check your internet connection' }],\n        errorCode: 'NETWORK_ERROR'\n      };\n    }\n    return {\n      userMessage: 'An unexpected error occurred. Please try again or contact support if the problem persists.',\n      technicalMessage: message,\n      retryable: true,\n      category: 'unknown',\n      severity: 'high',\n      recoveryActions: [],\n      errorCode: 'UNKNOWN_ERROR'\n    };\n  }),\n  logAndClassifyError: jest.fn().mockImplementation((error) => {\n    const message = error?.message || 'Unknown error';\n    if (message.includes('Network')) {\n      return {\n        userMessage: 'Network connection issue. Please check your internet and try again.',\n        technicalMessage: 'Network error',\n        retryable: true,\n        category: 'network',\n        severity: 'medium',\n        recoveryActions: [{ type: 'check_connection', description: 'Check your internet connection' }],\n        errorCode: 'NETWORK_ERROR'\n      };\n    }\n    return {\n      userMessage: 'An unexpected error occurred. Please try again or contact support if the problem persists.',\n      technicalMessage: message,\n      retryable: true,\n      category: 'unknown',\n      severity: 'high',\n      recoveryActions: [],\n      errorCode: 'UNKNOWN_ERROR'\n    };\n  }),\n  isErrorRetryable: jest.fn().mockReturnValue(false)\n}));\n\n// Mock optimistic updates\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: jest.fn().mockReturnValue({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn().mockImplementation(() => ({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }))\n}));\n\n// Mock cache invalidation\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  getCacheInvalidationManager: jest.fn(),\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\n// Mock fetch globally\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch;\n\n// Mock abort controller for timeout tests\nclass MockAbortController {\n  signal = { aborted: false };\n  abort = jest.fn(() => {\n    this.signal.aborted = true;\n  });\n}\nglobal.AbortController = MockAbortController as any;\n\ndescribe('useTryonMutation', () => {\n  let queryClient: QueryClient;\n\n  beforeEach(() => {\n    queryClient = new QueryClient({\n      defaultOptions: {\n        queries: { retry: false, gcTime: 0 },\n        mutations: { retry: false },\n      },\n    });\n    mockFetch.mockClear();\n    jest.clearAllTimers();\n    jest.useFakeTimers();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n    queryClient.clear();\n  });\n\n  const renderWithProvider = (children: React.ReactNode) => {\n    return render(\n      <QueryClientProvider client={queryClient}>\n        {children}\n      </QueryClientProvider>\n    );\n  };\n\n  const mockVariables: TryonMutationVariables = {\n    modelImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD',\n    apparelImages: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD']\n  };\n\n  const mockSuccessResponse: TryonMutationResponse = {\n    img_generated: 'data:image/jpeg;base64,generatedImageBase64Data',\n    metadata: {\n      processingTime: 5000,\n      modelVersion: 'v1.0',\n      timestamp: '2023-01-01T00:00:00Z'\n    }\n  };\n\n  describe('Basic Hook Functionality', () => {\n    it('should initialize with correct default state', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"isLoading\">{mutation.isLoading.toString()}</div>\n            <div data-testid=\"isSuccess\">{mutation.isSuccess.toString()}</div>\n            <div data-testid=\"isError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"isIdle\">{mutation.isIdle.toString()}</div>\n            <div data-testid=\"hasData\">{Boolean(mutation.data).toString()}</div>\n            <div data-testid=\"hasError\">{Boolean(mutation.error).toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      expect(screen.getByTestId('isLoading')).toHaveTextContent('false');\n      expect(screen.getByTestId('isSuccess')).toHaveTextContent('false');\n      expect(screen.getByTestId('isError')).toHaveTextContent('false');\n      expect(screen.getByTestId('isIdle')).toHaveTextContent('true');\n      expect(screen.getByTestId('hasData')).toHaveTextContent('false');\n      expect(screen.getByTestId('hasError')).toHaveTextContent('false');\n    });\n\n    it('should provide mutate and mutateAsync functions', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"hasMutate\">{typeof mutation.mutate === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasMutateAsync\">{typeof mutation.mutateAsync === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasReset\">{typeof mutation.reset === 'function' ? 'function' : 'not-function'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('hasMutate')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasMutateAsync')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasReset')).toHaveTextContent('function');\n    });\n  });\n\n  describe('Successful API Calls', () => {\n    it('should handle successful API response', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"data\">{mutation.data ? JSON.stringify(mutation.data) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const dataContent = screen.getByTestId('data').textContent;\n      const parsedData = JSON.parse(dataContent!);\n      expect(parsedData.img_generated).toBe(mockSuccessResponse.img_generated);\n      expect(parsedData.metadata).toEqual(mockSuccessResponse.metadata);\n    });\n\n    it('should make correct API request with proper payload', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          modelImage: mockVariables.modelImage,\n          apparelImages: mockVariables.apparelImages,\n        }),\n      });\n    });\n\n    it('should include metadata in request when provided', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const variablesWithMetadata: TryonMutationVariables = {\n        ...mockVariables,\n        options: {\n          metadata: { custom: 'data', userId: '123' }\n        }\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithMetadata);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      const [, requestInit] = mockFetch.mock.calls[0];\n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.metadata).toEqual({ custom: 'data', userId: '123' });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle HTTP error responses', async () => {\n      const errorResponse = {\n        error: 'Validation failed',\n        details: [{ field: 'modelImage', message: 'Invalid format' }],\n        code: 'VALIDATION_ERROR'\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => errorResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"error\">{mutation.error ? JSON.stringify(mutation.error) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      const errorContent = screen.getByTestId('error').textContent;\n      const parsedError = JSON.parse(errorContent!);\n      expect(parsedError.error).toBe('Validation failed');\n      expect(parsedError.details).toEqual(errorResponse.details);\n      expect(parsedError.status).toBe(400);\n      expect(parsedError.retryable).toBe(false);\n    });\n\n    it('should handle network errors', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorType\">{mutation.error ? typeof mutation.error : 'null'}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Network error');\n    });\n\n    it('should handle invalid API response format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ invalid: 'response' }), // Missing img_generated\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Invalid API response: missing img_generated field');\n    });\n  });\n\n  describe('Retry Logic', () => {\n    it('should retry on retryable errors with exponential backoff', async () => {\n      // First call fails with 500 error (retryable)\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => mockSuccessResponse,\n        });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3,\n          initialRetryDelay: 100\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      // Fast-forward through retry delays\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3);\n    });\n\n    it('should not retry on non-retryable errors', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => ({ error: 'Validation error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should respect maxRetries configuration', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 2,\n          initialRetryDelay: 50\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3); // 1 initial + 2 retries\n    });\n  });\n\n  describe('Timeout Handling', () => {\n    it('should handle request timeout', async () => {\n      const timeoutPromise = new Promise((_, reject) => {\n        setTimeout(() => reject(new Error('Request timeout')), 1000);\n      });\n\n      mockFetch.mockImplementationOnce(() => timeoutPromise);\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            ...mockVariables,\n            options: { timeout: 500 }\n          });\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(600);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n    });\n  });\n\n  describe('Lifecycle Callbacks', () => {\n    it('should call onSuccess callback', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onSuccess = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSuccess });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables,\n          startTime: expect.any(Number),\n          retryCount: 0\n        })\n      );\n    });\n\n    it('should call onError callback', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const onError = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onError, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(onError).toHaveBeenCalledWith(\n        expect.objectContaining({\n          error: expect.stringContaining('Network connection'),\n          retryable: true,\n          category: 'network',\n          code: 'NETWORK_ERROR',\n          severity: 'medium',\n          recoveryActions: expect.arrayContaining([\n            expect.objectContaining({\n              type: 'check_connection'\n            })\n          ])\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n\n    it('should call onMutate callback and use returned context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onMutate = jest.fn().mockReturnValue({ customData: 'test' });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onMutate });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onMutate).toHaveBeenCalledWith(mockVariables);\n    });\n\n    it('should call onSettled callback on both success and error', async () => {\n      const onSettled = jest.fn();\n\n      // Test success case\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSettled });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      const { unmount } = renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        null,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n\n      unmount();\n      onSettled.mockClear();\n\n      // Test error case\n      mockFetch.mockRejectedValueOnce(new Error('Test error'));\n\n      const TestComponentError = () => {\n        const mutation = useTryonMutation({ onSettled, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponentError />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 5000 });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        undefined,\n        expect.objectContaining({\n          error: expect.stringContaining('unexpected error'),\n          category: 'unknown',\n          code: 'UNKNOWN_ERROR',\n          severity: 'high',\n          retryable: true\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n  });\n\n  describe('Reset Functionality', () => {\n    it('should reset mutation state', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        const handleReset = () => {\n          mutation.reset();\n        };\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <button onClick={handleReset} data-testid=\"reset-button\">Reset</button>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      act(() => {\n        screen.getByTestId('reset-button').click();\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      });\n    });\n  });\n\n  describe('Configuration Options', () => {\n    it('should disable retry when enableRetry is false', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Image Processing Integration', () => {\n    // Mock File constructor\n    const createMockFile = (name: string, type: string, content: string = 'test-image-data'): File => {\n      const blob = new Blob([content], { type });\n      return new File([blob], name, { type });\n    };\n\n    // Mock Canvas and Image for image processing\n    const mockCanvas = {\n      width: 0,\n      height: 0,\n      getContext: jest.fn(() => ({\n        drawImage: jest.fn(),\n        imageSmoothingEnabled: true,\n        imageSmoothingQuality: 'high',\n        fillStyle: '',\n        fillRect: jest.fn(),\n        getImageData: jest.fn(() => ({\n          data: new Uint8ClampedArray(4 * 100 * 100), // 100x100 RGBA data\n          width: 100,\n          height: 100\n        })),\n        putImageData: jest.fn()\n      })),\n      toDataURL: jest.fn(() => 'data:image/jpeg;base64,processed-image-data'),\n      toBlob: jest.fn((callback) => {\n        const blob = new Blob(['processed'], { type: 'image/jpeg' });\n        callback(blob);\n      })\n    };\n\n    beforeEach(() => {\n      global.HTMLCanvasElement.prototype.getContext = mockCanvas.getContext as any;\n      global.HTMLCanvasElement.prototype.toDataURL = mockCanvas.toDataURL as any;\n      global.HTMLCanvasElement.prototype.toBlob = mockCanvas.toBlob as any;\n      \n      // Mock Image constructor\n      global.Image = class MockImage {\n        onload: (() => void) | null = null;\n        onerror: (() => void) | null = null;\n        width = 1024;\n        height = 1536;\n        crossOrigin = '';\n        \n        set src(value: string) {\n          setTimeout(() => {\n            if (this.onload) this.onload();\n          }, 0);\n        }\n      } as any;\n\n      // Mock FileReader for file processing\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            this.result = 'data:image/jpeg;base64,processed-image-data';\n            if (this.onload) {\n              this.onload({ target: { result: this.result } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      // Mock document.createElement for canvas creation\n      const originalCreateElement = document.createElement;\n      document.createElement = jest.fn((tagName: string) => {\n        if (tagName === 'canvas') {\n          return {\n            width: 0,\n            height: 0,\n            getContext: mockCanvas.getContext,\n            toDataURL: mockCanvas.toDataURL,\n            toBlob: mockCanvas.toBlob\n          } as any;\n        }\n        return originalCreateElement.call(document, tagName);\n      });\n    });\n\n    it('should process File objects through image processing pipeline', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n      const mockApparelFile = createMockFile('apparel.png', 'image/png');\n\n      const variablesWithFiles: TryonMutationVariablesWithFiles = {\n        modelImage: mockFile,\n        apparelImages: [mockApparelFile]\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false,\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024\n          }\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithFiles as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"context\">{mutation.context ? 'has-context' : 'no-context'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(screen.getByTestId('context')).toHaveTextContent('has-context');\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', expect.objectContaining({\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: expect.stringContaining('processed-image-data')\n      }));\n    });\n\n    it('should handle mixed File and base64 inputs', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n\n      const mixedVariables: TryonMutationVariablesWithFiles = {\n        modelImage: 'data:image/jpeg;base64,existing-base64-data',\n        apparelImages: [mockFile, 'data:image/png;base64,another-base64-image']\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mixedVariables as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should handle image processing errors gracefully', async () => {\n      // Mock FileReader to simulate file processing error\n      const originalFileReader = global.FileReader;\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            if (this.onerror) {\n              this.onerror({ target: { error: new Error('File reading failed') } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      const mockFile = createMockFile('invalid.txt', 'text/plain');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n\n      // Restore FileReader\n      global.FileReader = originalFileReader;\n    });\n\n    it('should pass processed variables to API with correct format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: [mockFile]\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const [url, requestInit] = mockFetch.mock.calls[0];\n      expect(url).toBe('/api/tryon');\n      \n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.modelImage).toMatch(/^data:image\\/jpeg;base64,/);\n      expect(requestBody.apparelImages).toHaveLength(1);\n      expect(requestBody.apparelImages[0]).toMatch(/^data:image\\/jpeg;base64,/);\n    });\n\n    it('should include image processing results in mutation context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n      let capturedContext: any = null;\n\n      const onSuccess = jest.fn((data, variables, context) => {\n        capturedContext = context;\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ \n          enableRetry: false,\n          onSuccess\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalled();\n      expect(capturedContext).toBeTruthy();\n      expect(capturedContext.imageProcessingResults).toBeTruthy();\n      expect(capturedContext.imageProcessingResults.totalProcessingTime).toBeGreaterThan(0);\n    });\n  });\n});"],"names":["jest","mock","processImageForTryon","fn","mockImplementation","Promise","resolve","processedImage","originalSize","processedSize","compressionRatio","processingTime","dimensions","width","height","ImageProcessingError","Error","constructor","message","ImageDimensionError","FileTypeNotSupportedError","FileTooLargeError","CompressionFailedError","classifyTryonError","error","includes","userMessage","technicalMessage","retryable","category","severity","recoveryActions","type","description","errorCode","logAndClassifyError","isErrorRetryable","mockReturnValue","getOptimisticUpdatesManager","startOptimisticUpdate","optimisticId","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","getCacheInvalidationManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","mockFetch","global","fetch","MockAbortController","signal","aborted","abort","AbortController","describe","queryClient","beforeEach","QueryClient","defaultOptions","queries","retry","gcTime","mutations","mockClear","clearAllTimers","useFakeTimers","afterEach","useRealTimers","clear","renderWithProvider","children","render","QueryClientProvider","client","mockVariables","modelImage","apparelImages","mockSuccessResponse","img_generated","metadata","modelVersion","timestamp","it","TestComponent","mutation","useTryonMutation","div","data-testid","status","isLoading","toString","isSuccess","isError","isIdle","Boolean","data","expect","screen","getByTestId","toHaveTextContent","mutate","mutateAsync","reset","mockResolvedValueOnce","ok","json","React","useEffect","JSON","stringify","waitFor","dataContent","textContent","parsedData","parse","toBe","toEqual","toHaveBeenCalledTimes","toHaveBeenCalledWith","method","headers","body","variablesWithMetadata","options","custom","userId","requestInit","calls","requestBody","errorResponse","details","field","code","statusText","timeout","errorContent","parsedError","mockRejectedValueOnce","enableRetry","invalid","maxRetries","initialRetryDelay","act","advanceTimersByTimeAsync","timeoutPromise","_","reject","setTimeout","mockImplementationOnce","onSuccess","objectContaining","variables","startTime","any","Number","retryCount","onError","stringContaining","arrayContaining","onMutate","customData","onSettled","unmount","TestComponentError","handleReset","button","onClick","click","createMockFile","name","content","blob","Blob","File","mockCanvas","getContext","drawImage","imageSmoothingEnabled","imageSmoothingQuality","fillStyle","fillRect","getImageData","Uint8ClampedArray","putImageData","toDataURL","toBlob","callback","HTMLCanvasElement","prototype","Image","MockImage","src","value","onload","onerror","crossOrigin","FileReader","MockFileReader","readAsDataURL","file","result","target","originalCreateElement","document","createElement","tagName","call","mockFile","mockApparelFile","variablesWithFiles","imageProcessing","targetWidth","targetHeight","maxSizeKB","context","mixedVariables","originalFileReader","url","toMatch","toHaveLength","capturedContext","toHaveBeenCalled","toBeTruthy","imageProcessingResults","totalProcessingTime","toBeGreaterThan"],"mappings":"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"}