63654ad60ff721b5ce4fd8aafe5d268c
// Feature Flag Hooks
// Custom React hooks for accessing feature flags with type safety and error handling
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    useAllFeatureFlags: function() {
        return useAllFeatureFlags;
    },
    useAllFeatureFlagsEnabled: function() {
        return useAllFeatureFlagsEnabled;
    },
    useAnyFeatureFlagEnabled: function() {
        return useAnyFeatureFlagEnabled;
    },
    useExperimentVariant: function() {
        return useExperimentVariant;
    },
    useFeatureFlag: function() {
        return useFeatureFlag;
    },
    useFeatureFlagEnabled: function() {
        return useFeatureFlagEnabled;
    },
    useFeatureFlagNumber: function() {
        return useFeatureFlagNumber;
    },
    useFeatureFlagRefresh: function() {
        return useFeatureFlagRefresh;
    },
    useFeatureFlagString: function() {
        return useFeatureFlagString;
    },
    useFeatureFlagValue: function() {
        return useFeatureFlagValue;
    },
    useFeatureFlags: function() {
        return useFeatureFlags;
    }
});
const _react = require("react");
const _FeatureFlagContext = require("../providers/FeatureFlagContext");
// Development logging utility
const logFlagUsage = (key, value, source)=>{
    if (process.env.NODE_ENV === 'development') {
        console.debug(`[FeatureFlag] ${key}: ${JSON.stringify(value)} (${source})`);
    }
};
function useFeatureFlag(key, defaultValue) {
    const context = (0, _FeatureFlagContext.useFeatureFlagContext)();
    return (0, _react.useMemo)(()=>{
        const flag = context.getFlag(key);
        const isLoading = context.isLoading;
        const error = context.error;
        // Determine the final value
        let value;
        let isEnabled = false;
        let source = 'default';
        if (flag && flag.enabled) {
            value = flag.value;
            isEnabled = Boolean(flag.value);
            source = 'flag';
        } else {
            value = defaultValue;
            isEnabled = Boolean(defaultValue);
            source = 'default';
        }
        // Log usage in development
        logFlagUsage(key, value, source);
        return {
            flag,
            isEnabled,
            value,
            isLoading,
            error
        };
    }, [
        key,
        defaultValue,
        context
    ]);
}
function useFeatureFlagEnabled(key, defaultValue = false) {
    return useFeatureFlag(key, defaultValue);
}
function useFeatureFlagString(key, defaultValue = '') {
    return useFeatureFlag(key, defaultValue);
}
function useFeatureFlagNumber(key, defaultValue = 0) {
    return useFeatureFlag(key, defaultValue);
}
function useFeatureFlags(keys, defaultValues) {
    const context = (0, _FeatureFlagContext.useFeatureFlagContext)();
    return (0, _react.useMemo)(()=>{
        const flags = {};
        const values = {};
        let enabledCount = 0;
        keys.forEach((key)=>{
            const flag = context.getFlag(key);
            const defaultValue = defaultValues?.[key];
            flags[key] = flag;
            if (flag && flag.enabled) {
                values[key] = flag.value;
                if (flag.value) enabledCount++;
                logFlagUsage(key, flag.value, 'flag');
            } else {
                const fallbackValue = defaultValue ?? false;
                values[key] = fallbackValue;
                if (fallbackValue) enabledCount++;
                logFlagUsage(key, fallbackValue, 'default');
            }
        });
        return {
            flags,
            values,
            isLoading: context.isLoading,
            error: context.error,
            isAnyEnabled: enabledCount > 0,
            areAllEnabled: enabledCount === keys.length
        };
    }, [
        keys,
        defaultValues,
        context
    ]);
}
function useAnyFeatureFlagEnabled(keys) {
    const { values, isLoading, error } = useFeatureFlags(keys);
    return (0, _react.useMemo)(()=>{
        const enabledFlags = keys.filter((key)=>Boolean(values[key]));
        return {
            isEnabled: enabledFlags.length > 0,
            enabledFlags,
            isLoading,
            error
        };
    }, [
        keys,
        values,
        isLoading,
        error
    ]);
}
function useAllFeatureFlagsEnabled(keys) {
    const { values, isLoading, error } = useFeatureFlags(keys);
    return (0, _react.useMemo)(()=>{
        const disabledFlags = keys.filter((key)=>!Boolean(values[key]));
        return {
            isEnabled: disabledFlags.length === 0,
            disabledFlags,
            isLoading,
            error
        };
    }, [
        keys,
        values,
        isLoading,
        error
    ]);
}
function useFeatureFlagValue(key, enabledValue, disabledValue) {
    const { isEnabled, isLoading, error } = useFeatureFlagEnabled(key);
    return (0, _react.useMemo)(()=>({
            value: isEnabled ? enabledValue : disabledValue,
            isEnabled,
            isLoading,
            error
        }), [
        isEnabled,
        enabledValue,
        disabledValue,
        isLoading,
        error
    ]);
}
function useFeatureFlagRefresh() {
    const context = (0, _FeatureFlagContext.useFeatureFlagContext)();
    return (0, _react.useMemo)(()=>({
            refresh: context.refreshFlags,
            isRefreshing: context.isLoading,
            error: context.error
        }), [
        context
    ]);
}
function useAllFeatureFlags() {
    const context = (0, _FeatureFlagContext.useFeatureFlagContext)();
    return (0, _react.useMemo)(()=>{
        if (process.env.NODE_ENV !== 'development') {
            return null;
        }
        return {
            flags: context.flags,
            isLoading: context.isLoading,
            error: context.error
        };
    }, [
        context
    ]);
}
function useExperimentVariant(experimentKey, variants, defaultVariant) {
    const { flag, value: flagValue, isEnabled, isLoading, error } = useFeatureFlagString(experimentKey, defaultVariant);
    return (0, _react.useMemo)(()=>{
        const flagExists = Boolean(flag);
        const variant = flagExists && isEnabled && flagValue in variants ? flagValue : defaultVariant;
        const value = variants[variant] || variants[defaultVariant];
        if (process.env.NODE_ENV === 'development') {
            console.debug(`[Experiment] ${experimentKey}: variant=${variant}, value=${JSON.stringify(value)}, flagExists=${flagExists}`);
        }
        return {
            variant,
            value,
            isInExperiment: flagExists && isEnabled && flagValue in variants,
            isLoading,
            error
        };
    }, [
        experimentKey,
        variants,
        defaultVariant,
        flag,
        flagValue,
        isEnabled,
        isLoading,
        error
    ]);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy93aWxsc3RyZWV0ZXIvV2Vic3Rvcm1Qcm9qZWN0cy92aWJlLWNvZGluZy90aG9zZS1wZW9wbGUvVGhlLVN1cy1GaXQtZ3Avc3JjL2J1c2luZXNzLWxheWVyL2hvb2tzL3VzZUZlYXR1cmVGbGFnLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZlYXR1cmUgRmxhZyBIb29rc1xuLy8gQ3VzdG9tIFJlYWN0IGhvb2tzIGZvciBhY2Nlc3NpbmcgZmVhdHVyZSBmbGFncyB3aXRoIHR5cGUgc2FmZXR5IGFuZCBlcnJvciBoYW5kbGluZ1xuXG5pbXBvcnQgeyB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlRmVhdHVyZUZsYWdDb250ZXh0IH0gZnJvbSAnLi4vcHJvdmlkZXJzL0ZlYXR1cmVGbGFnQ29udGV4dCc7XG5pbXBvcnQgdHlwZSB7XG4gIEZlYXR1cmVGbGFnLFxuICBGZWF0dXJlRmxhZ1ZhbHVlLFxuICBVc2VGZWF0dXJlRmxhZ1JldHVybixcbn0gZnJvbSAnLi4vdHlwZXMvZmVhdHVyZUZsYWcudHlwZXMnO1xuXG4vLyBEZXZlbG9wbWVudCBsb2dnaW5nIHV0aWxpdHlcbmNvbnN0IGxvZ0ZsYWdVc2FnZSA9IChrZXk6IHN0cmluZywgdmFsdWU6IEZlYXR1cmVGbGFnVmFsdWUsIHNvdXJjZTogJ2ZsYWcnIHwgJ2RlZmF1bHQnKSA9PiB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgIGNvbnNvbGUuZGVidWcoYFtGZWF0dXJlRmxhZ10gJHtrZXl9OiAke0pTT04uc3RyaW5naWZ5KHZhbHVlKX0gKCR7c291cmNlfSlgKTtcbiAgfVxufTtcblxuLyoqXG4gKiBIb29rIHRvIGdldCBhIHNwZWNpZmljIGZlYXR1cmUgZmxhZyB3aXRoIHR5cGUgc2FmZXR5XG4gKiBAcGFyYW0ga2V5IC0gRmVhdHVyZSBmbGFnIGtleVxuICogQHBhcmFtIGRlZmF1bHRWYWx1ZSAtIEZhbGxiYWNrIHZhbHVlIGlmIGZsYWcgaXMgbm90IGZvdW5kIG9yIGRpc2FibGVkXG4gKiBAcmV0dXJucyBGZWF0dXJlIGZsYWcgZGF0YSB3aXRoIGxvYWRpbmcgc3RhdGUgYW5kIGVycm9yIGhhbmRsaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VGZWF0dXJlRmxhZzxUIGV4dGVuZHMgRmVhdHVyZUZsYWdWYWx1ZT4oXG4gIGtleTogc3RyaW5nLFxuICBkZWZhdWx0VmFsdWU/OiBUXG4pOiBVc2VGZWF0dXJlRmxhZ1JldHVybjxUPiB7XG4gIGNvbnN0IGNvbnRleHQgPSB1c2VGZWF0dXJlRmxhZ0NvbnRleHQoKTtcblxuICByZXR1cm4gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZmxhZyA9IGNvbnRleHQuZ2V0RmxhZzxUPihrZXkpO1xuICAgIGNvbnN0IGlzTG9hZGluZyA9IGNvbnRleHQuaXNMb2FkaW5nO1xuICAgIGNvbnN0IGVycm9yID0gY29udGV4dC5lcnJvcjtcblxuICAgIC8vIERldGVybWluZSB0aGUgZmluYWwgdmFsdWVcbiAgICBsZXQgdmFsdWU6IFQ7XG4gICAgbGV0IGlzRW5hYmxlZCA9IGZhbHNlO1xuICAgIGxldCBzb3VyY2U6ICdmbGFnJyB8ICdkZWZhdWx0JyA9ICdkZWZhdWx0JztcblxuICAgIGlmIChmbGFnICYmIGZsYWcuZW5hYmxlZCkge1xuICAgICAgdmFsdWUgPSBmbGFnLnZhbHVlIGFzIFQ7XG4gICAgICBpc0VuYWJsZWQgPSBCb29sZWFuKGZsYWcudmFsdWUpO1xuICAgICAgc291cmNlID0gJ2ZsYWcnO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZSA9IGRlZmF1bHRWYWx1ZSBhcyBUO1xuICAgICAgaXNFbmFibGVkID0gQm9vbGVhbihkZWZhdWx0VmFsdWUpO1xuICAgICAgc291cmNlID0gJ2RlZmF1bHQnO1xuICAgIH1cblxuICAgIC8vIExvZyB1c2FnZSBpbiBkZXZlbG9wbWVudFxuICAgIGxvZ0ZsYWdVc2FnZShrZXksIHZhbHVlLCBzb3VyY2UpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZsYWcsXG4gICAgICBpc0VuYWJsZWQsXG4gICAgICB2YWx1ZSxcbiAgICAgIGlzTG9hZGluZyxcbiAgICAgIGVycm9yLFxuICAgIH07XG4gIH0sIFtrZXksIGRlZmF1bHRWYWx1ZSwgY29udGV4dF0pO1xufVxuXG4vKipcbiAqIEhvb2sgc3BlY2lmaWNhbGx5IGZvciBib29sZWFuIGZlYXR1cmUgZmxhZ3NcbiAqIEBwYXJhbSBrZXkgLSBGZWF0dXJlIGZsYWcga2V5XG4gKiBAcGFyYW0gZGVmYXVsdFZhbHVlIC0gRGVmYXVsdCBib29sZWFuIHZhbHVlIChkZWZhdWx0cyB0byBmYWxzZSlcbiAqIEByZXR1cm5zIEJvb2xlYW4gZmxhZyBzdGF0ZSB3aXRoIGxvYWRpbmcvZXJyb3IgaW5mb1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRmVhdHVyZUZsYWdFbmFibGVkKFxuICBrZXk6IHN0cmluZyxcbiAgZGVmYXVsdFZhbHVlID0gZmFsc2Vcbik6IFVzZUZlYXR1cmVGbGFnUmV0dXJuPGJvb2xlYW4+IHtcbiAgcmV0dXJuIHVzZUZlYXR1cmVGbGFnPGJvb2xlYW4+KGtleSwgZGVmYXVsdFZhbHVlKTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBzdHJpbmcgZmVhdHVyZSBmbGFnc1xuICogQHBhcmFtIGtleSAtIEZlYXR1cmUgZmxhZyBrZXlcbiAqIEBwYXJhbSBkZWZhdWx0VmFsdWUgLSBEZWZhdWx0IHN0cmluZyB2YWx1ZVxuICogQHJldHVybnMgU3RyaW5nIGZsYWcgdmFsdWUgd2l0aCBsb2FkaW5nL2Vycm9yIGluZm9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUZlYXR1cmVGbGFnU3RyaW5nKFxuICBrZXk6IHN0cmluZyxcbiAgZGVmYXVsdFZhbHVlID0gJydcbik6IFVzZUZlYXR1cmVGbGFnUmV0dXJuPHN0cmluZz4ge1xuICByZXR1cm4gdXNlRmVhdHVyZUZsYWc8c3RyaW5nPihrZXksIGRlZmF1bHRWYWx1ZSk7XG59XG5cbi8qKlxuICogSG9vayBmb3IgbnVtYmVyIGZlYXR1cmUgZmxhZ3NcbiAqIEBwYXJhbSBrZXkgLSBGZWF0dXJlIGZsYWcga2V5XG4gKiBAcGFyYW0gZGVmYXVsdFZhbHVlIC0gRGVmYXVsdCBudW1iZXIgdmFsdWVcbiAqIEByZXR1cm5zIE51bWJlciBmbGFnIHZhbHVlIHdpdGggbG9hZGluZy9lcnJvciBpbmZvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VGZWF0dXJlRmxhZ051bWJlcihcbiAga2V5OiBzdHJpbmcsXG4gIGRlZmF1bHRWYWx1ZSA9IDBcbik6IFVzZUZlYXR1cmVGbGFnUmV0dXJuPG51bWJlcj4ge1xuICByZXR1cm4gdXNlRmVhdHVyZUZsYWc8bnVtYmVyPihrZXksIGRlZmF1bHRWYWx1ZSk7XG59XG5cbi8qKlxuICogSG9vayB0byBnZXQgbXVsdGlwbGUgZmVhdHVyZSBmbGFncyBhdCBvbmNlXG4gKiBAcGFyYW0ga2V5cyAtIEFycmF5IG9mIGZlYXR1cmUgZmxhZyBrZXlzXG4gKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyAtIE9wdGlvbmFsIG9iamVjdCB3aXRoIGRlZmF1bHQgdmFsdWVzIGZvciBlYWNoIGtleVxuICogQHJldHVybnMgT2JqZWN0IGNvbnRhaW5pbmcgYWxsIHJlcXVlc3RlZCBmbGFnc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRmVhdHVyZUZsYWdzPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBGZWF0dXJlRmxhZ1ZhbHVlPj4oXG4gIGtleXM6IHN0cmluZ1tdLFxuICBkZWZhdWx0VmFsdWVzPzogUGFydGlhbDxUPlxuKToge1xuICBmbGFnczogUmVjb3JkPHN0cmluZywgRmVhdHVyZUZsYWcgfCB1bmRlZmluZWQ+O1xuICB2YWx1ZXM6IFJlY29yZDxzdHJpbmcsIEZlYXR1cmVGbGFnVmFsdWU+O1xuICBpc0xvYWRpbmc6IGJvb2xlYW47XG4gIGVycm9yOiBFcnJvciB8IG51bGw7XG4gIGlzQW55RW5hYmxlZDogYm9vbGVhbjtcbiAgYXJlQWxsRW5hYmxlZDogYm9vbGVhbjtcbn0ge1xuICBjb25zdCBjb250ZXh0ID0gdXNlRmVhdHVyZUZsYWdDb250ZXh0KCk7XG5cbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGZsYWdzOiBSZWNvcmQ8c3RyaW5nLCBGZWF0dXJlRmxhZyB8IHVuZGVmaW5lZD4gPSB7fTtcbiAgICBjb25zdCB2YWx1ZXM6IFJlY29yZDxzdHJpbmcsIEZlYXR1cmVGbGFnVmFsdWU+ID0ge307XG4gICAgbGV0IGVuYWJsZWRDb3VudCA9IDA7XG5cbiAgICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IGZsYWcgPSBjb250ZXh0LmdldEZsYWcoa2V5KTtcbiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZXM/LltrZXldO1xuICAgICAgXG4gICAgICBmbGFnc1trZXldID0gZmxhZztcbiAgICAgIFxuICAgICAgaWYgKGZsYWcgJiYgZmxhZy5lbmFibGVkKSB7XG4gICAgICAgIHZhbHVlc1trZXldID0gZmxhZy52YWx1ZTtcbiAgICAgICAgaWYgKGZsYWcudmFsdWUpIGVuYWJsZWRDb3VudCsrO1xuICAgICAgICBsb2dGbGFnVXNhZ2Uoa2V5LCBmbGFnLnZhbHVlLCAnZmxhZycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZmFsbGJhY2tWYWx1ZSA9IGRlZmF1bHRWYWx1ZSA/PyBmYWxzZTtcbiAgICAgICAgdmFsdWVzW2tleV0gPSBmYWxsYmFja1ZhbHVlO1xuICAgICAgICBpZiAoZmFsbGJhY2tWYWx1ZSkgZW5hYmxlZENvdW50Kys7XG4gICAgICAgIGxvZ0ZsYWdVc2FnZShrZXksIGZhbGxiYWNrVmFsdWUsICdkZWZhdWx0Jyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZmxhZ3MsXG4gICAgICB2YWx1ZXMsXG4gICAgICBpc0xvYWRpbmc6IGNvbnRleHQuaXNMb2FkaW5nLFxuICAgICAgZXJyb3I6IGNvbnRleHQuZXJyb3IsXG4gICAgICBpc0FueUVuYWJsZWQ6IGVuYWJsZWRDb3VudCA+IDAsXG4gICAgICBhcmVBbGxFbmFibGVkOiBlbmFibGVkQ291bnQgPT09IGtleXMubGVuZ3RoLFxuICAgIH07XG4gIH0sIFtrZXlzLCBkZWZhdWx0VmFsdWVzLCBjb250ZXh0XSk7XG59XG5cbi8qKlxuICogSG9vayB0byBjaGVjayBpZiBhbnkgb2YgdGhlIHByb3ZpZGVkIGZsYWdzIGFyZSBlbmFibGVkXG4gKiBAcGFyYW0ga2V5cyAtIEFycmF5IG9mIGZlYXR1cmUgZmxhZyBrZXlzIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIGFueSBmbGFnIGlzIGVuYWJsZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUFueUZlYXR1cmVGbGFnRW5hYmxlZChrZXlzOiBzdHJpbmdbXSk6IHtcbiAgaXNFbmFibGVkOiBib29sZWFuO1xuICBlbmFibGVkRmxhZ3M6IHN0cmluZ1tdO1xuICBpc0xvYWRpbmc6IGJvb2xlYW47XG4gIGVycm9yOiBFcnJvciB8IG51bGw7XG59IHtcbiAgY29uc3QgeyB2YWx1ZXMsIGlzTG9hZGluZywgZXJyb3IgfSA9IHVzZUZlYXR1cmVGbGFncyhrZXlzKTtcblxuICByZXR1cm4gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZW5hYmxlZEZsYWdzID0ga2V5cy5maWx0ZXIoa2V5ID0+IEJvb2xlYW4odmFsdWVzW2tleV0pKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgaXNFbmFibGVkOiBlbmFibGVkRmxhZ3MubGVuZ3RoID4gMCxcbiAgICAgIGVuYWJsZWRGbGFncyxcbiAgICAgIGlzTG9hZGluZyxcbiAgICAgIGVycm9yLFxuICAgIH07XG4gIH0sIFtrZXlzLCB2YWx1ZXMsIGlzTG9hZGluZywgZXJyb3JdKTtcbn1cblxuLyoqXG4gKiBIb29rIHRvIGNoZWNrIGlmIGFsbCBwcm92aWRlZCBmbGFncyBhcmUgZW5hYmxlZFxuICogQHBhcmFtIGtleXMgLSBBcnJheSBvZiBmZWF0dXJlIGZsYWcga2V5cyB0byBjaGVja1xuICogQHJldHVybnMgVHJ1ZSBpZiBhbGwgZmxhZ3MgYXJlIGVuYWJsZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUFsbEZlYXR1cmVGbGFnc0VuYWJsZWQoa2V5czogc3RyaW5nW10pOiB7XG4gIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgZGlzYWJsZWRGbGFnczogc3RyaW5nW107XG4gIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgZXJyb3I6IEVycm9yIHwgbnVsbDtcbn0ge1xuICBjb25zdCB7IHZhbHVlcywgaXNMb2FkaW5nLCBlcnJvciB9ID0gdXNlRmVhdHVyZUZsYWdzKGtleXMpO1xuXG4gIHJldHVybiB1c2VNZW1vKCgpID0+IHtcbiAgICBjb25zdCBkaXNhYmxlZEZsYWdzID0ga2V5cy5maWx0ZXIoa2V5ID0+ICFCb29sZWFuKHZhbHVlc1trZXldKSk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzRW5hYmxlZDogZGlzYWJsZWRGbGFncy5sZW5ndGggPT09IDAsXG4gICAgICBkaXNhYmxlZEZsYWdzLFxuICAgICAgaXNMb2FkaW5nLFxuICAgICAgZXJyb3IsXG4gICAgfTtcbiAgfSwgW2tleXMsIHZhbHVlcywgaXNMb2FkaW5nLCBlcnJvcl0pO1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGNvbmRpdGlvbmFsIGZlYXR1cmUgZmxhZyB1c2FnZSB3aXRoIGZhbGxiYWNrIGJlaGF2aW9yXG4gKiBAcGFyYW0ga2V5IC0gRmVhdHVyZSBmbGFnIGtleVxuICogQHBhcmFtIGVuYWJsZWRWYWx1ZSAtIFZhbHVlIHRvIHJldHVybiB3aGVuIGZsYWcgaXMgZW5hYmxlZFxuICogQHBhcmFtIGRpc2FibGVkVmFsdWUgLSBWYWx1ZSB0byByZXR1cm4gd2hlbiBmbGFnIGlzIGRpc2FibGVkXG4gKiBAcmV0dXJucyBUaGUgYXBwcm9wcmlhdGUgdmFsdWUgYmFzZWQgb24gZmxhZyBzdGF0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRmVhdHVyZUZsYWdWYWx1ZTxUPihcbiAga2V5OiBzdHJpbmcsXG4gIGVuYWJsZWRWYWx1ZTogVCxcbiAgZGlzYWJsZWRWYWx1ZTogVFxuKToge1xuICB2YWx1ZTogVDtcbiAgaXNFbmFibGVkOiBib29sZWFuO1xuICBpc0xvYWRpbmc6IGJvb2xlYW47XG4gIGVycm9yOiBFcnJvciB8IG51bGw7XG59IHtcbiAgY29uc3QgeyBpc0VuYWJsZWQsIGlzTG9hZGluZywgZXJyb3IgfSA9IHVzZUZlYXR1cmVGbGFnRW5hYmxlZChrZXkpO1xuXG4gIHJldHVybiB1c2VNZW1vKCgpID0+ICh7XG4gICAgdmFsdWU6IGlzRW5hYmxlZCA/IGVuYWJsZWRWYWx1ZSA6IGRpc2FibGVkVmFsdWUsXG4gICAgaXNFbmFibGVkLFxuICAgIGlzTG9hZGluZyxcbiAgICBlcnJvcixcbiAgfSksIFtpc0VuYWJsZWQsIGVuYWJsZWRWYWx1ZSwgZGlzYWJsZWRWYWx1ZSwgaXNMb2FkaW5nLCBlcnJvcl0pO1xufVxuXG4vKipcbiAqIEhvb2sgdG8gcmVmcmVzaCBmZWF0dXJlIGZsYWdzIG1hbnVhbGx5XG4gKiBAcmV0dXJucyBGdW5jdGlvbiB0byByZWZyZXNoIGZsYWdzIGFuZCBsb2FkaW5nIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VGZWF0dXJlRmxhZ1JlZnJlc2goKToge1xuICByZWZyZXNoOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBpc1JlZnJlc2hpbmc6IGJvb2xlYW47XG4gIGVycm9yOiBFcnJvciB8IG51bGw7XG59IHtcbiAgY29uc3QgY29udGV4dCA9IHVzZUZlYXR1cmVGbGFnQ29udGV4dCgpO1xuXG4gIHJldHVybiB1c2VNZW1vKCgpID0+ICh7XG4gICAgcmVmcmVzaDogY29udGV4dC5yZWZyZXNoRmxhZ3MsXG4gICAgaXNSZWZyZXNoaW5nOiBjb250ZXh0LmlzTG9hZGluZyxcbiAgICBlcnJvcjogY29udGV4dC5lcnJvcixcbiAgfSksIFtjb250ZXh0XSk7XG59XG5cbi8qKlxuICogRGV2ZWxvcG1lbnQgaGVscGVyIGhvb2sgdG8gZ2V0IGFsbCBhdmFpbGFibGUgZmxhZ3NcbiAqIE9ubHkgd29ya3MgaW4gZGV2ZWxvcG1lbnQgbW9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlQWxsRmVhdHVyZUZsYWdzKCk6IHtcbiAgZmxhZ3M6IFJlY29yZDxzdHJpbmcsIEZlYXR1cmVGbGFnPjtcbiAgaXNMb2FkaW5nOiBib29sZWFuO1xuICBlcnJvcjogRXJyb3IgfCBudWxsO1xufSB8IG51bGwge1xuICBjb25zdCBjb250ZXh0ID0gdXNlRmVhdHVyZUZsYWdDb250ZXh0KCk7XG5cbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZsYWdzOiBjb250ZXh0LmZsYWdzLFxuICAgICAgaXNMb2FkaW5nOiBjb250ZXh0LmlzTG9hZGluZyxcbiAgICAgIGVycm9yOiBjb250ZXh0LmVycm9yLFxuICAgIH07XG4gIH0sIFtjb250ZXh0XSk7XG59XG5cbi8qKlxuICogSG9vayBmb3IgQS9CIHRlc3Rpbmcgc2NlbmFyaW9zXG4gKiBAcGFyYW0gZXhwZXJpbWVudEtleSAtIFRoZSBleHBlcmltZW50IGZlYXR1cmUgZmxhZyBrZXlcbiAqIEBwYXJhbSB2YXJpYW50cyAtIE9iamVjdCBtYXBwaW5nIHZhcmlhbnQgbmFtZXMgdG8gdGhlaXIgdmFsdWVzXG4gKiBAcGFyYW0gZGVmYXVsdFZhcmlhbnQgLSBEZWZhdWx0IHZhcmlhbnQgdG8gdXNlIGlmIGZsYWcgaXMgbm90IGZvdW5kXG4gKiBAcmV0dXJucyBUaGUgdmFyaWFudCB2YWx1ZSBhbmQgbWV0YWRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUV4cGVyaW1lbnRWYXJpYW50PFQ+KFxuICBleHBlcmltZW50S2V5OiBzdHJpbmcsXG4gIHZhcmlhbnRzOiBSZWNvcmQ8c3RyaW5nLCBUPixcbiAgZGVmYXVsdFZhcmlhbnQ6IHN0cmluZ1xuKToge1xuICB2YXJpYW50OiBzdHJpbmc7XG4gIHZhbHVlOiBUO1xuICBpc0luRXhwZXJpbWVudDogYm9vbGVhbjtcbiAgaXNMb2FkaW5nOiBib29sZWFuO1xuICBlcnJvcjogRXJyb3IgfCBudWxsO1xufSB7XG4gIGNvbnN0IHsgZmxhZywgdmFsdWU6IGZsYWdWYWx1ZSwgaXNFbmFibGVkLCBpc0xvYWRpbmcsIGVycm9yIH0gPSB1c2VGZWF0dXJlRmxhZ1N0cmluZyhcbiAgICBleHBlcmltZW50S2V5LFxuICAgIGRlZmF1bHRWYXJpYW50XG4gICk7XG5cbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGZsYWdFeGlzdHMgPSBCb29sZWFuKGZsYWcpO1xuICAgIGNvbnN0IHZhcmlhbnQgPSBmbGFnRXhpc3RzICYmIGlzRW5hYmxlZCAmJiBmbGFnVmFsdWUgaW4gdmFyaWFudHMgPyBmbGFnVmFsdWUgOiBkZWZhdWx0VmFyaWFudDtcbiAgICBjb25zdCB2YWx1ZSA9IHZhcmlhbnRzW3ZhcmlhbnRdIHx8IHZhcmlhbnRzW2RlZmF1bHRWYXJpYW50XTtcblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgY29uc29sZS5kZWJ1ZyhgW0V4cGVyaW1lbnRdICR7ZXhwZXJpbWVudEtleX06IHZhcmlhbnQ9JHt2YXJpYW50fSwgdmFsdWU9JHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9LCBmbGFnRXhpc3RzPSR7ZmxhZ0V4aXN0c31gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFyaWFudCxcbiAgICAgIHZhbHVlLFxuICAgICAgaXNJbkV4cGVyaW1lbnQ6IGZsYWdFeGlzdHMgJiYgaXNFbmFibGVkICYmIGZsYWdWYWx1ZSBpbiB2YXJpYW50cyxcbiAgICAgIGlzTG9hZGluZyxcbiAgICAgIGVycm9yLFxuICAgIH07XG4gIH0sIFtleHBlcmltZW50S2V5LCB2YXJpYW50cywgZGVmYXVsdFZhcmlhbnQsIGZsYWcsIGZsYWdWYWx1ZSwgaXNFbmFibGVkLCBpc0xvYWRpbmcsIGVycm9yXSk7XG59Il0sIm5hbWVzIjpbInVzZUFsbEZlYXR1cmVGbGFncyIsInVzZUFsbEZlYXR1cmVGbGFnc0VuYWJsZWQiLCJ1c2VBbnlGZWF0dXJlRmxhZ0VuYWJsZWQiLCJ1c2VFeHBlcmltZW50VmFyaWFudCIsInVzZUZlYXR1cmVGbGFnIiwidXNlRmVhdHVyZUZsYWdFbmFibGVkIiwidXNlRmVhdHVyZUZsYWdOdW1iZXIiLCJ1c2VGZWF0dXJlRmxhZ1JlZnJlc2giLCJ1c2VGZWF0dXJlRmxhZ1N0cmluZyIsInVzZUZlYXR1cmVGbGFnVmFsdWUiLCJ1c2VGZWF0dXJlRmxhZ3MiLCJsb2dGbGFnVXNhZ2UiLCJrZXkiLCJ2YWx1ZSIsInNvdXJjZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImNvbnNvbGUiLCJkZWJ1ZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWZhdWx0VmFsdWUiLCJjb250ZXh0IiwidXNlRmVhdHVyZUZsYWdDb250ZXh0IiwidXNlTWVtbyIsImZsYWciLCJnZXRGbGFnIiwiaXNMb2FkaW5nIiwiZXJyb3IiLCJpc0VuYWJsZWQiLCJlbmFibGVkIiwiQm9vbGVhbiIsImtleXMiLCJkZWZhdWx0VmFsdWVzIiwiZmxhZ3MiLCJ2YWx1ZXMiLCJlbmFibGVkQ291bnQiLCJmb3JFYWNoIiwiZmFsbGJhY2tWYWx1ZSIsImlzQW55RW5hYmxlZCIsImFyZUFsbEVuYWJsZWQiLCJsZW5ndGgiLCJlbmFibGVkRmxhZ3MiLCJmaWx0ZXIiLCJkaXNhYmxlZEZsYWdzIiwiZW5hYmxlZFZhbHVlIiwiZGlzYWJsZWRWYWx1ZSIsInJlZnJlc2giLCJyZWZyZXNoRmxhZ3MiLCJpc1JlZnJlc2hpbmciLCJleHBlcmltZW50S2V5IiwidmFyaWFudHMiLCJkZWZhdWx0VmFyaWFudCIsImZsYWdWYWx1ZSIsImZsYWdFeGlzdHMiLCJ2YXJpYW50IiwiaXNJbkV4cGVyaW1lbnQiXSwibWFwcGluZ3MiOiJBQUFBLHFCQUFxQjtBQUNyQixxRkFBcUY7Ozs7Ozs7Ozs7OztJQTZQckVBLGtCQUFrQjtlQUFsQkE7O0lBckVBQyx5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