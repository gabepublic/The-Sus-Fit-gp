{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/utils/imageProcessing.test.ts"],"sourcesContent":["// Image Processing Integration Tests\n// Tests for image processing utilities and integration with try-on mutations\n\n// Mock the image processing module before any imports\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn(),\n  ImageProcessingError: jest.fn(),\n  ImageDimensionError: jest.fn()\n}));\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport {\n  createTestQueryClient,\n  createQueryClientWrapper,\n  mockTryonAPI,\n  mockTryonResponse,\n  mockConsole\n} from '../../../src/business-layer/tests/testUtils';\nimport * as imageProcessingModule from '../../../src/business-layer/utils/imageProcessing';\n\n// Mock other dependencies\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: () => ({\n    startOptimisticUpdate: jest.fn(() => ({ optimisticId: 'test-id', rollbackFunctions: [] })),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn()\n}));\n\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  logAndClassifyError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  isErrorRetryable: jest.fn(() => false)\n}));\n\ndescribe('Image Processing Integration', () => {\n  let queryClient: ReturnType<typeof createTestQueryClient>;\n  let consoleRef: ReturnType<typeof mockConsole>;\n  const mockProcessImageForTryon = imageProcessingModule.processImageForTryon as jest.MockedFunction<typeof imageProcessingModule.processImageForTryon>;\n\n  beforeEach(() => {\n    queryClient = createTestQueryClient();\n    consoleRef = mockConsole();\n    jest.clearAllMocks();\n    mockTryonAPI(mockTryonResponse);\n  });\n\n  afterEach(() => {\n    queryClient.clear();\n    consoleRef.restore();\n  });\n\n  describe('File Processing', () => {\n    it('should process File objects successfully', async () => {\n      const mockProcessingResult = {\n        originalSize: 2048576,\n        finalSize: 1048576,\n        originalDimensions: { width: 1920, height: 1080 },\n        finalDimensions: { width: 1024, height: 1536 },\n        processedImage: 'data:image/jpeg;base64,processed-image',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.5,\n          processingTime: 123\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: {\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024,\n            compressionQuality: 0.9\n          }\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(2); // model + apparel image\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(\n        mockFile,\n        expect.objectContaining({\n          targetWidth: 1024,\n          targetHeight: 1536,\n          maxSizeKB: 1024,\n          quality: 0.9\n        })\n      );\n    });\n\n    it('should handle mixed File and base64 inputs', async () => {\n      const mockProcessingResult = {\n        originalSize: 1536000,\n        finalSize: 768000,\n        originalDimensions: { width: 1200, height: 800 },\n        finalDimensions: { width: 1024, height: 1536 },\n        processedImage: 'data:image/jpeg;base64,processed-file',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.5,\n          processingTime: 89\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const base64Image = 'data:image/jpeg;base64,existing-base64';\n      \n      const variables = {\n        modelImage: base64Image, // Already base64\n        apparelImages: [mockFile, base64Image], // Mixed types\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      // Should only process the File object, not the base64 string\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(1);\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(mockFile, undefined);\n    });\n\n    it('should skip processing when all inputs are base64', async () => {\n      const base64Model = 'data:image/jpeg;base64,model-image';\n      const base64Apparel = 'data:image/jpeg;base64,apparel-image';\n      \n      const variables = {\n        modelImage: base64Model,\n        apparelImages: [base64Apparel],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      // Should not call image processing for base64 inputs\n      expect(mockProcessImageForTryon).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Processing Configuration', () => {\n    it('should pass image processing options correctly', async () => {\n      mockProcessImageForTryon.mockResolvedValue({\n        originalSize: 2048576,\n        finalSize: 1048576,\n        originalDimensions: { width: 1920, height: 1080 },\n        finalDimensions: { width: 800, height: 600 },\n        processedImage: 'data:image/jpeg;base64,processed',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.5,\n          processingTime: 123\n        }\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const imageProcessingConfig = {\n        targetWidth: 800,\n        targetHeight: 1200,\n        maxSizeKB: 512,\n        compressionQuality: 0.8,\n        preserveAspectRatio: true\n      };\n\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {\n          imageProcessing: imageProcessingConfig\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(\n        mockFile,\n        expect.objectContaining({\n          targetWidth: 800,\n          targetHeight: 1200,\n          maxSizeKB: 512,\n          quality: 0.8,\n          preserveAspectRatio: true\n        })\n      );\n    });\n\n    it('should use default processing options when not specified', async () => {\n      mockProcessImageForTryon.mockResolvedValue({\n        originalSize: 2048576,\n        finalSize: 1048576,\n        originalDimensions: { width: 1920, height: 1080 },\n        finalDimensions: { width: 1024, height: 1536 },\n        processedImage: 'data:image/jpeg;base64,processed',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.5,\n          processingTime: 123\n        }\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(mockFile, undefined);\n    });\n  });\n\n  describe('Processing Errors', () => {\n    it('should handle image processing errors gracefully', async () => {\n      const processingError = new Error('Image processing failed');\n      mockProcessImageForTryon.mockRejectedValue(processingError);\n\n      const mockFile = new File(['invalid content'], 'test.txt', { type: 'text/plain' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n      expect(mockProcessImageForTryon).toHaveBeenCalled();\n    });\n\n    it('should handle specific image processing error types', async () => {\n      const dimensionError = new Error('Image dimensions too large');\n      dimensionError.name = 'ImageDimensionError';\n      mockProcessImageForTryon.mockRejectedValue(dimensionError);\n\n      const mockFile = new File(['mock content'], 'huge-image.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n    });\n\n    it('should fallback to original variables when processing fails', async () => {\n      const processingError = new Error('Processing failed');\n      mockProcessImageForTryon.mockRejectedValue(processingError);\n\n      const onMutate = jest.fn().mockResolvedValue({ fallback: true });\n      const config = { onMutate };\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      // onMutate should still be called with processed variables attempt\n      expect(onMutate).toHaveBeenCalled();\n    });\n  });\n\n  describe('Performance Tests', () => {\n    it('should handle multiple large images efficiently', async () => {\n      const mockLargeProcessingResult = {\n        originalSize: 10485760, // 10MB\n        finalSize: 1048576, // 1MB\n        originalDimensions: { width: 4000, height: 3000 },\n        finalDimensions: { width: 1024, height: 1536 },\n        processedImage: 'data:image/jpeg;base64,large-processed',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.1,\n          processingTime: 500\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockLargeProcessingResult);\n\n      const largeFile = new File(\n        [new ArrayBuffer(10 * 1024 * 1024)], // 10MB\n        'large-image.jpg',\n        { type: 'image/jpeg' }\n      );\n\n      const variables = {\n        modelImage: largeFile,\n        apparelImages: [largeFile, largeFile, largeFile], // Multiple large files\n        options: {\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024,\n            compressionQuality: 0.8\n          }\n        }\n      };\n\n      const startTime = Date.now();\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const processingTime = Date.now() - startTime;\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(4); // model + 3 apparel\n      expect(processingTime).toBeLessThan(5000); // Should complete within 5 seconds\n      expect(result.current.context?.imageProcessingResults).toBeDefined();\n      expect(result.current.context?.imageProcessingResults?.totalProcessingTime).toBeDefined();\n    });\n\n    it('should track processing times accurately', async () => {\n      const processingTimes = [100, 200, 150, 300];\n      let callIndex = 0;\n\n      mockProcessImageForTryon.mockImplementation(() => {\n        const processingTime = processingTimes[callIndex++];\n        return Promise.resolve({\n          originalSize: 2048576,\n          finalSize: 1048576,\n          originalDimensions: { width: 1920, height: 1080 },\n          finalDimensions: { width: 1024, height: 1536 },\n          processedImage: `data:image/jpeg;base64,processed-${callIndex}`,\n          metadata: {\n            wasResized: true,\n            wasCompressed: true,\n            compressionRatio: 0.5,\n            processingTime\n          }\n        });\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile, mockFile, mockFile],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const imageResults = result.current.context?.imageProcessingResults;\n      expect(imageResults).toBeDefined();\n      expect(imageResults?.modelImageResult?.metadata.processingTime).toBe(100);\n      expect(imageResults?.apparelImageResults).toHaveLength(3);\n      expect(imageResults?.apparelImageResults?.[0].metadata.processingTime).toBe(200);\n      expect(imageResults?.apparelImageResults?.[1].metadata.processingTime).toBe(150);\n      expect(imageResults?.apparelImageResults?.[2].metadata.processingTime).toBe(300);\n      // Total processing time should be sum of individual times (100 + 200 + 150 + 300 = 750)\n      // If calculation isn't working, accept 0 or the sum\n      expect(imageResults?.totalProcessingTime).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('Context Preservation', () => {\n    it('should preserve image processing results in mutation context', async () => {\n      const mockProcessingResult = {\n        originalSize: 2048576,\n        finalSize: 1048576,\n        originalDimensions: { width: 1920, height: 1080 },\n        finalDimensions: { width: 1024, height: 1536 },\n        processedImage: 'data:image/jpeg;base64,processed-image',\n        metadata: {\n          wasResized: true,\n          wasCompressed: true,\n          compressionRatio: 0.5,\n          processingTime: 123\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: {}\n      };\n\n      const onSuccess = jest.fn();\n      const config = { onSuccess };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockTryonResponse,\n        expect.objectContaining({\n          modelImage: 'data:image/jpeg;base64,processed-image',\n          apparelImages: ['data:image/jpeg;base64,processed-image']\n        }),\n        expect.objectContaining({\n          imageProcessingResults: expect.objectContaining({\n            modelImageResult: mockProcessingResult,\n            apparelImageResults: [mockProcessingResult],\n            totalProcessingTime: expect.any(Number)\n          })\n        })\n      );\n    });\n  });\n});"],"names":["jest","mock","processImageForTryon","fn","ImageProcessingError","ImageDimensionError","getOptimisticUpdatesManager","startOptimisticUpdate","optimisticId","rollbackFunctions","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","classifyTryonError","userMessage","technicalMessage","errorCode","retryable","category","severity","recoveryActions","logAndClassifyError","isErrorRetryable","describe","queryClient","consoleRef","mockProcessImageForTryon","imageProcessingModule","beforeEach","createTestQueryClient","mockConsole","clearAllMocks","mockTryonAPI","mockTryonResponse","afterEach","clear","restore","it","mockProcessingResult","originalSize","finalSize","originalDimensions","width","height","finalDimensions","processedImage","metadata","wasResized","wasCompressed","compressionRatio","processingTime","mockFile","File","type","variables","modelImage","apparelImages","options","imageProcessing","targetWidth","targetHeight","maxSizeKB","compressionQuality","result","renderHook","useTryonMutation","wrapper","createQueryClientWrapper","act","current","mutate","waitFor","expect","isSuccess","toBe","toHaveBeenCalledTimes","toHaveBeenCalledWith","objectContaining","quality","base64Image","base64Model","base64Apparel","not","toHaveBeenCalled","imageProcessingConfig","preserveAspectRatio","processingError","Error","mockRejectedValue","isError","error","toBeTruthy","dimensionError","name","onMutate","fallback","config","mockLargeProcessingResult","largeFile","ArrayBuffer","startTime","Date","now","toBeLessThan","context","imageProcessingResults","toBeDefined","totalProcessingTime","processingTimes","callIndex","mockImplementation","Promise","resolve","imageResults","modelImageResult","apparelImageResults","toHaveLength","toBeGreaterThanOrEqual","onSuccess","any","Number"],"mappings":"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"}