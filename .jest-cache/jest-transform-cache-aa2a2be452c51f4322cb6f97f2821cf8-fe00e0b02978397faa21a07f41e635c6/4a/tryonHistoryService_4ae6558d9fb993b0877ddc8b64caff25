bfdc239f88dae34affc22749cd6f48bd
// Try-On History Storage Service
// Implements persistent storage for try-on history using localStorage with compression
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    LocalStorageTryonHistoryService: function() {
        return LocalStorageTryonHistoryService;
    },
    defaultHistoryService: function() {
        return defaultHistoryService;
    }
});
const _imageProcessing = require("../utils/imageProcessing");
/**
 * Default configuration for history storage
 */ const DEFAULT_CONFIG = {
    storageType: 'localStorage',
    maxEntries: 50,
    maxEntrySizeKB: 2048,
    compressImages: true,
    compressionQuality: 0.8,
    autoCleanup: true,
    encryptionKey: ''
};
/**
 * Storage keys for localStorage
 */ const STORAGE_KEYS = {
    ENTRIES: 'susfit_tryon_history_entries',
    CONFIG: 'susfit_tryon_history_config',
    METADATA: 'susfit_tryon_history_metadata'
};
/**
 * Generate a unique ID for history entries
 */ function generateHistoryId() {
    return `tryon_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
}
/**
 * Calculate the size of a history entry in KB
 */ function calculateEntrySize(entry) {
    const json = JSON.stringify(entry);
    return new Blob([
        json
    ]).size / 1024;
}
/**
 * Compress images in a history entry
 */ async function compressHistoryEntry(entry, config) {
    if (!config.compressImages) {
        return entry;
    }
    try {
        const maxSizeKB = config.maxEntrySizeKB / (2 + entry.apparelImages.length);
        const quality = config.compressionQuality;
        // Compress generated image
        const compressedGenerated = await (0, _imageProcessing.compressBase64)(entry.generatedImage, maxSizeKB, quality);
        // Compress model image
        const compressedModel = await (0, _imageProcessing.compressBase64)(entry.modelImage, maxSizeKB, quality);
        // Compress apparel images
        const compressedApparel = await Promise.all(entry.apparelImages.map((img)=>(0, _imageProcessing.compressBase64)(img, maxSizeKB, quality)));
        return {
            ...entry,
            generatedImage: compressedGenerated,
            modelImage: compressedModel,
            apparelImages: compressedApparel,
            metadata: {
                ...entry.metadata,
                imageProcessingResults: {
                    ...entry.metadata?.imageProcessingResults,
                    finalImageSizes: {
                        modelImageSize: (0, _imageProcessing.getBase64Size)(compressedModel),
                        apparelImageSizes: compressedApparel.map((img)=>(0, _imageProcessing.getBase64Size)(img))
                    }
                }
            }
        };
    } catch (error) {
        if (error instanceof _imageProcessing.CompressionFailedError) {
            console.warn('Failed to compress history entry images, using original', error);
            return entry;
        }
        throw error;
    }
}
class LocalStorageTryonHistoryService {
    constructor(config = {}){
        this.config = {
            ...DEFAULT_CONFIG,
            ...config
        };
        this.initializeStorage();
    }
    /**
   * Initialize localStorage storage
   */ initializeStorage() {
        try {
            // Check if localStorage is available
            if (typeof window === 'undefined' || !window.localStorage) {
                throw new Error('localStorage is not available');
            }
            // Initialize config if not exists
            if (!localStorage.getItem(STORAGE_KEYS.CONFIG)) {
                localStorage.setItem(STORAGE_KEYS.CONFIG, JSON.stringify(this.config));
            }
            // Initialize entries array if not exists
            if (!localStorage.getItem(STORAGE_KEYS.ENTRIES)) {
                localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify([]));
            }
            // Initialize metadata if not exists
            if (!localStorage.getItem(STORAGE_KEYS.METADATA)) {
                const metadata = {
                    version: '1.0.0',
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(STORAGE_KEYS.METADATA, JSON.stringify(metadata));
            }
        } catch (error) {
            console.error('Failed to initialize history storage:', error);
            throw new Error('History storage initialization failed');
        }
    }
    /**
   * Get all stored entries from localStorage
   */ getStoredEntries() {
        try {
            const entriesJson = localStorage.getItem(STORAGE_KEYS.ENTRIES);
            return entriesJson ? JSON.parse(entriesJson) : [];
        } catch (error) {
            console.error('Failed to parse stored entries:', error);
            return [];
        }
    }
    /**
   * Save entries to localStorage
   */ saveEntries(entries) {
        try {
            localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify(entries));
            // Update metadata
            const metadata = JSON.parse(localStorage.getItem(STORAGE_KEYS.METADATA) || '{}');
            metadata.lastUpdated = new Date().toISOString();
            localStorage.setItem(STORAGE_KEYS.METADATA, JSON.stringify(metadata));
        } catch (error) {
            console.error('Failed to save entries to localStorage:', error);
            throw new Error('Failed to save history entries');
        }
    }
    /**
   * Perform cleanup if needed
   */ performCleanupIfNeeded(entries) {
        if (!this.config.autoCleanup || entries.length <= this.config.maxEntries) {
            return entries;
        }
        // Sort by timestamp and keep only the most recent entries
        const sorted = [
            ...entries
        ].sort((a, b)=>new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());
        return sorted.slice(0, this.config.maxEntries);
    }
    /**
   * Filter and sort entries based on query options
   */ filterAndSortEntries(entries, options = {}) {
        let filtered = [
            ...entries
        ];
        // Apply favorites filter
        if (options.favoritesOnly) {
            filtered = filtered.filter((entry)=>entry.isFavorite);
        }
        // Apply date range filter
        if (options.dateRange) {
            const startDate = new Date(options.dateRange.startDate);
            const endDate = new Date(options.dateRange.endDate);
            filtered = filtered.filter((entry)=>{
                const entryDate = new Date(entry.timestamp);
                return entryDate >= startDate && entryDate <= endDate;
            });
        }
        // Apply search term filter
        if (options.searchTerm) {
            const searchTerm = options.searchTerm.toLowerCase();
            filtered = filtered.filter((entry)=>entry.tags?.some((tag)=>tag.toLowerCase().includes(searchTerm)) || entry.notes?.toLowerCase().includes(searchTerm));
        }
        // Apply sorting
        const sortBy = options.sortBy || 'timestamp';
        const sortDirection = options.sortDirection || 'desc';
        filtered.sort((a, b)=>{
            let aValue, bValue;
            switch(sortBy){
                case 'timestamp':
                    aValue = new Date(a.timestamp);
                    bValue = new Date(b.timestamp);
                    break;
                case 'processingTime':
                    aValue = a.processingTime || 0;
                    bValue = b.processingTime || 0;
                    break;
                case 'isFavorite':
                    aValue = a.isFavorite ? 1 : 0;
                    bValue = b.isFavorite ? 1 : 0;
                    break;
                default:
                    aValue = a.timestamp;
                    bValue = b.timestamp;
            }
            if (sortDirection === 'asc') {
                return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
            } else {
                return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
            }
        });
        return filtered;
    }
    /**
   * Add a new history entry
   */ async addEntry(options) {
        const entry = {
            id: generateHistoryId(),
            timestamp: new Date().toISOString(),
            generatedImage: options.generatedImage,
            modelImage: options.modelImage,
            apparelImages: options.apparelImages,
            processingTime: options.processingTime,
            metadata: options.metadata,
            tags: options.tags || [],
            isFavorite: options.isFavorite || false,
            notes: options.notes || ''
        };
        // Compress entry if enabled
        const compressedEntry = await compressHistoryEntry(entry, this.config);
        // Check entry size
        const entrySize = calculateEntrySize(compressedEntry);
        if (entrySize > this.config.maxEntrySizeKB) {
            throw new Error(`History entry too large: ${entrySize.toFixed(2)}KB exceeds limit of ${this.config.maxEntrySizeKB}KB`);
        }
        // Get current entries and add the new one
        let entries = this.getStoredEntries();
        entries.push(compressedEntry);
        // Perform cleanup if needed
        entries = this.performCleanupIfNeeded(entries);
        // Save updated entries
        this.saveEntries(entries);
        return compressedEntry;
    }
    /**
   * Get history entries with filtering and pagination
   */ async getEntries(options = {}) {
        const allEntries = this.getStoredEntries();
        const filteredEntries = this.filterAndSortEntries(allEntries, options);
        // Apply pagination
        const page = options.page || 0;
        const pageSize = options.pageSize || 20;
        const startIndex = page * pageSize;
        const endIndex = startIndex + pageSize;
        const paginatedEntries = filteredEntries.slice(startIndex, endIndex);
        return {
            entries: paginatedEntries,
            totalCount: filteredEntries.length,
            currentPage: page,
            pageSize,
            hasMore: endIndex < filteredEntries.length,
            lastUpdated: new Date().toISOString()
        };
    }
    /**
   * Get a specific history entry by ID
   */ async getEntry(id) {
        const entries = this.getStoredEntries();
        return entries.find((entry)=>entry.id === id) || null;
    }
    /**
   * Update an existing history entry
   */ async updateEntry(id, updates) {
        const entries = this.getStoredEntries();
        const entryIndex = entries.findIndex((entry)=>entry.id === id);
        if (entryIndex === -1) {
            throw new Error(`History entry with ID ${id} not found`);
        }
        // Apply updates
        const updatedEntry = {
            ...entries[entryIndex],
            ...updates,
            // Preserve ID and timestamp, update only if explicitly provided
            id: entries[entryIndex].id,
            timestamp: updates.timestamp || entries[entryIndex].timestamp
        };
        entries[entryIndex] = updatedEntry;
        this.saveEntries(entries);
        return updatedEntry;
    }
    /**
   * Delete a history entry
   */ async deleteEntry(id) {
        const entries = this.getStoredEntries();
        const filteredEntries = entries.filter((entry)=>entry.id !== id);
        if (filteredEntries.length === entries.length) {
            return false; // Entry not found
        }
        this.saveEntries(filteredEntries);
        return true;
    }
    /**
   * Clear all history entries
   */ async clearAll() {
        try {
            localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify([]));
            return true;
        } catch (error) {
            console.error('Failed to clear history:', error);
            return false;
        }
    }
    /**
   * Get storage statistics
   */ async getStorageStats() {
        const entries = this.getStoredEntries();
        let totalSizeKB = 0;
        entries.forEach((entry)=>{
            totalSizeKB += calculateEntrySize(entry);
        });
        const timestamps = entries.map((entry)=>entry.timestamp).sort();
        return {
            totalEntries: entries.length,
            totalSizeKB,
            oldestEntry: timestamps[0],
            newestEntry: timestamps[timestamps.length - 1]
        };
    }
    /**
   * Export history data
   */ async exportHistory() {
        return this.getStoredEntries();
    }
    /**
   * Import history data
   */ async importHistory(entries) {
        try {
            // Validate entries
            const validEntries = entries.filter((entry)=>entry.id && entry.generatedImage && entry.modelImage && entry.apparelImages);
            // Get existing entries and merge with imports
            const existingEntries = this.getStoredEntries();
            const existingIds = new Set(existingEntries.map((entry)=>entry.id));
            // Only import entries that don't already exist
            const newEntries = validEntries.filter((entry)=>!existingIds.has(entry.id));
            if (newEntries.length === 0) {
                return 0;
            }
            // Merge and save
            const mergedEntries = [
                ...existingEntries,
                ...newEntries
            ];
            const cleanedEntries = this.performCleanupIfNeeded(mergedEntries);
            this.saveEntries(cleanedEntries);
            return newEntries.length;
        } catch (error) {
            console.error('Failed to import history:', error);
            throw new Error('History import failed');
        }
    }
    /**
   * Update service configuration
   */ updateConfig(newConfig) {
        this.config = {
            ...this.config,
            ...newConfig
        };
        try {
            localStorage.setItem(STORAGE_KEYS.CONFIG, JSON.stringify(this.config));
        } catch (error) {
            console.error('Failed to save config:', error);
        }
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const defaultHistoryService = new LocalStorageTryonHistoryService();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy93aWxsc3RyZWV0ZXIvV2Vic3Rvcm1Qcm9qZWN0cy92aWJlLWNvZGluZy90aG9zZS1wZW9wbGUvVGhlLVN1cy1GaXQtZ3Avc3JjL2J1c2luZXNzLWxheWVyL3NlcnZpY2VzL3RyeW9uSGlzdG9yeVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVHJ5LU9uIEhpc3RvcnkgU3RvcmFnZSBTZXJ2aWNlXG4vLyBJbXBsZW1lbnRzIHBlcnNpc3RlbnQgc3RvcmFnZSBmb3IgdHJ5LW9uIGhpc3RvcnkgdXNpbmcgbG9jYWxTdG9yYWdlIHdpdGggY29tcHJlc3Npb25cblxuaW1wb3J0IHsgXG4gIGNvbXByZXNzQmFzZTY0LCBcbiAgZ2V0QmFzZTY0U2l6ZSwgXG4gIENvbXByZXNzaW9uRmFpbGVkRXJyb3IgXG59IGZyb20gJy4uL3V0aWxzL2ltYWdlUHJvY2Vzc2luZyc7XG5pbXBvcnQgdHlwZSB7XG4gIFRyeW9uSGlzdG9yeUVudHJ5LFxuICBUcnlvbkhpc3RvcnlDb2xsZWN0aW9uLFxuICBUcnlvbkhpc3RvcnlRdWVyeU9wdGlvbnMsXG4gIENyZWF0ZVRyeW9uSGlzdG9yeUVudHJ5T3B0aW9ucyxcbiAgVHJ5b25IaXN0b3J5U2VydmljZSxcbiAgVHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZ1xufSBmcm9tICcuLi90eXBlcy9oaXN0b3J5LnR5cGVzJztcblxuLyoqXG4gKiBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gZm9yIGhpc3Rvcnkgc3RvcmFnZVxuICovXG5jb25zdCBERUZBVUxUX0NPTkZJRzogUmVxdWlyZWQ8VHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZz4gPSB7XG4gIHN0b3JhZ2VUeXBlOiAnbG9jYWxTdG9yYWdlJyxcbiAgbWF4RW50cmllczogNTAsXG4gIG1heEVudHJ5U2l6ZUtCOiAyMDQ4LCAvLyAyTUIgcGVyIGVudHJ5XG4gIGNvbXByZXNzSW1hZ2VzOiB0cnVlLFxuICBjb21wcmVzc2lvblF1YWxpdHk6IDAuOCxcbiAgYXV0b0NsZWFudXA6IHRydWUsXG4gIGVuY3J5cHRpb25LZXk6ICcnXG59O1xuXG4vKipcbiAqIFN0b3JhZ2Uga2V5cyBmb3IgbG9jYWxTdG9yYWdlXG4gKi9cbmNvbnN0IFNUT1JBR0VfS0VZUyA9IHtcbiAgRU5UUklFUzogJ3N1c2ZpdF90cnlvbl9oaXN0b3J5X2VudHJpZXMnLFxuICBDT05GSUc6ICdzdXNmaXRfdHJ5b25faGlzdG9yeV9jb25maWcnLFxuICBNRVRBREFUQTogJ3N1c2ZpdF90cnlvbl9oaXN0b3J5X21ldGFkYXRhJ1xufSBhcyBjb25zdDtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHVuaXF1ZSBJRCBmb3IgaGlzdG9yeSBlbnRyaWVzXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSGlzdG9yeUlkKCk6IHN0cmluZyB7XG4gIHJldHVybiBgdHJ5b25fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSB0aGUgc2l6ZSBvZiBhIGhpc3RvcnkgZW50cnkgaW4gS0JcbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlRW50cnlTaXplKGVudHJ5OiBUcnlvbkhpc3RvcnlFbnRyeSk6IG51bWJlciB7XG4gIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShlbnRyeSk7XG4gIHJldHVybiBuZXcgQmxvYihbanNvbl0pLnNpemUgLyAxMDI0O1xufVxuXG4vKipcbiAqIENvbXByZXNzIGltYWdlcyBpbiBhIGhpc3RvcnkgZW50cnlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY29tcHJlc3NIaXN0b3J5RW50cnkoXG4gIGVudHJ5OiBUcnlvbkhpc3RvcnlFbnRyeSwgXG4gIGNvbmZpZzogVHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZ1xuKTogUHJvbWlzZTxUcnlvbkhpc3RvcnlFbnRyeT4ge1xuICBpZiAoIWNvbmZpZy5jb21wcmVzc0ltYWdlcykge1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgbWF4U2l6ZUtCID0gY29uZmlnLm1heEVudHJ5U2l6ZUtCISAvICgyICsgZW50cnkuYXBwYXJlbEltYWdlcy5sZW5ndGgpO1xuICAgIGNvbnN0IHF1YWxpdHkgPSBjb25maWcuY29tcHJlc3Npb25RdWFsaXR5ITtcblxuICAgIC8vIENvbXByZXNzIGdlbmVyYXRlZCBpbWFnZVxuICAgIGNvbnN0IGNvbXByZXNzZWRHZW5lcmF0ZWQgPSBhd2FpdCBjb21wcmVzc0Jhc2U2NChcbiAgICAgIGVudHJ5LmdlbmVyYXRlZEltYWdlLCBcbiAgICAgIG1heFNpemVLQiwgXG4gICAgICBxdWFsaXR5XG4gICAgKTtcblxuICAgIC8vIENvbXByZXNzIG1vZGVsIGltYWdlXG4gICAgY29uc3QgY29tcHJlc3NlZE1vZGVsID0gYXdhaXQgY29tcHJlc3NCYXNlNjQoXG4gICAgICBlbnRyeS5tb2RlbEltYWdlLCBcbiAgICAgIG1heFNpemVLQiwgXG4gICAgICBxdWFsaXR5XG4gICAgKTtcblxuICAgIC8vIENvbXByZXNzIGFwcGFyZWwgaW1hZ2VzXG4gICAgY29uc3QgY29tcHJlc3NlZEFwcGFyZWwgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIGVudHJ5LmFwcGFyZWxJbWFnZXMubWFwKGltZyA9PiBjb21wcmVzc0Jhc2U2NChpbWcsIG1heFNpemVLQiwgcXVhbGl0eSkpXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5lbnRyeSxcbiAgICAgIGdlbmVyYXRlZEltYWdlOiBjb21wcmVzc2VkR2VuZXJhdGVkLFxuICAgICAgbW9kZWxJbWFnZTogY29tcHJlc3NlZE1vZGVsLFxuICAgICAgYXBwYXJlbEltYWdlczogY29tcHJlc3NlZEFwcGFyZWwsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5lbnRyeS5tZXRhZGF0YSxcbiAgICAgICAgaW1hZ2VQcm9jZXNzaW5nUmVzdWx0czoge1xuICAgICAgICAgIC4uLmVudHJ5Lm1ldGFkYXRhPy5pbWFnZVByb2Nlc3NpbmdSZXN1bHRzLFxuICAgICAgICAgIGZpbmFsSW1hZ2VTaXplczoge1xuICAgICAgICAgICAgbW9kZWxJbWFnZVNpemU6IGdldEJhc2U2NFNpemUoY29tcHJlc3NlZE1vZGVsKSxcbiAgICAgICAgICAgIGFwcGFyZWxJbWFnZVNpemVzOiBjb21wcmVzc2VkQXBwYXJlbC5tYXAoaW1nID0+IGdldEJhc2U2NFNpemUoaW1nKSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENvbXByZXNzaW9uRmFpbGVkRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGNvbXByZXNzIGhpc3RvcnkgZW50cnkgaW1hZ2VzLCB1c2luZyBvcmlnaW5hbCcsIGVycm9yKTtcbiAgICAgIHJldHVybiBlbnRyeTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBsb2NhbFN0b3JhZ2UtYmFzZWQgVHJ5LU9uIEhpc3RvcnkgU2VydmljZSBpbXBsZW1lbnRhdGlvblxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxTdG9yYWdlVHJ5b25IaXN0b3J5U2VydmljZSBpbXBsZW1lbnRzIFRyeW9uSGlzdG9yeVNlcnZpY2Uge1xuICBwcml2YXRlIGNvbmZpZzogUmVxdWlyZWQ8VHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZz47XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPFRyeW9uSGlzdG9yeVN0b3JhZ2VDb25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLmNvbmZpZyB9O1xuICAgIHRoaXMuaW5pdGlhbGl6ZVN0b3JhZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGxvY2FsU3RvcmFnZSBzdG9yYWdlXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVTdG9yYWdlKCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBsb2NhbFN0b3JhZ2UgaXMgYXZhaWxhYmxlXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdsb2NhbFN0b3JhZ2UgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsaXplIGNvbmZpZyBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5DT05GSUcpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5DT05GSUcsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZmlnKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluaXRpYWxpemUgZW50cmllcyBhcnJheSBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5FTlRSSUVTKSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuRU5UUklFUywgSlNPTi5zdHJpbmdpZnkoW10pKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGl6ZSBtZXRhZGF0YSBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSkpIHtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH07XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEpKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgaGlzdG9yeSBzdG9yYWdlOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeSBzdG9yYWdlIGluaXRpYWxpemF0aW9uIGZhaWxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHN0b3JlZCBlbnRyaWVzIGZyb20gbG9jYWxTdG9yYWdlXG4gICAqL1xuICBwcml2YXRlIGdldFN0b3JlZEVudHJpZXMoKTogVHJ5b25IaXN0b3J5RW50cnlbXSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVudHJpZXNKc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlTLkVOVFJJRVMpO1xuICAgICAgcmV0dXJuIGVudHJpZXNKc29uID8gSlNPTi5wYXJzZShlbnRyaWVzSnNvbikgOiBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBhcnNlIHN0b3JlZCBlbnRyaWVzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2F2ZSBlbnRyaWVzIHRvIGxvY2FsU3RvcmFnZVxuICAgKi9cbiAgcHJpdmF0ZSBzYXZlRW50cmllcyhlbnRyaWVzOiBUcnlvbkhpc3RvcnlFbnRyeVtdKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5FTlRSSUVTLCBKU09OLnN0cmluZ2lmeShlbnRyaWVzKSk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBtZXRhZGF0YVxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSkgfHwgJ3t9Jyk7XG4gICAgICBtZXRhZGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgZW50cmllcyB0byBsb2NhbFN0b3JhZ2U6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2F2ZSBoaXN0b3J5IGVudHJpZXMnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybSBjbGVhbnVwIGlmIG5lZWRlZFxuICAgKi9cbiAgcHJpdmF0ZSBwZXJmb3JtQ2xlYW51cElmTmVlZGVkKGVudHJpZXM6IFRyeW9uSGlzdG9yeUVudHJ5W10pOiBUcnlvbkhpc3RvcnlFbnRyeVtdIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmF1dG9DbGVhbnVwIHx8IGVudHJpZXMubGVuZ3RoIDw9IHRoaXMuY29uZmlnLm1heEVudHJpZXMpIHtcbiAgICAgIHJldHVybiBlbnRyaWVzO1xuICAgIH1cblxuICAgIC8vIFNvcnQgYnkgdGltZXN0YW1wIGFuZCBrZWVwIG9ubHkgdGhlIG1vc3QgcmVjZW50IGVudHJpZXNcbiAgICBjb25zdCBzb3J0ZWQgPSBbLi4uZW50cmllc10uc29ydCgoYSwgYikgPT4gXG4gICAgICBuZXcgRGF0ZShiLnRpbWVzdGFtcCkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS50aW1lc3RhbXApLmdldFRpbWUoKVxuICAgICk7XG4gICAgXG4gICAgcmV0dXJuIHNvcnRlZC5zbGljZSgwLCB0aGlzLmNvbmZpZy5tYXhFbnRyaWVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWx0ZXIgYW5kIHNvcnQgZW50cmllcyBiYXNlZCBvbiBxdWVyeSBvcHRpb25zXG4gICAqL1xuICBwcml2YXRlIGZpbHRlckFuZFNvcnRFbnRyaWVzKFxuICAgIGVudHJpZXM6IFRyeW9uSGlzdG9yeUVudHJ5W10sIFxuICAgIG9wdGlvbnM6IFRyeW9uSGlzdG9yeVF1ZXJ5T3B0aW9ucyA9IHt9XG4gICk6IFRyeW9uSGlzdG9yeUVudHJ5W10ge1xuICAgIGxldCBmaWx0ZXJlZCA9IFsuLi5lbnRyaWVzXTtcblxuICAgIC8vIEFwcGx5IGZhdm9yaXRlcyBmaWx0ZXJcbiAgICBpZiAob3B0aW9ucy5mYXZvcml0ZXNPbmx5KSB7XG4gICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihlbnRyeSA9PiBlbnRyeS5pc0Zhdm9yaXRlKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBkYXRlIHJhbmdlIGZpbHRlclxuICAgIGlmIChvcHRpb25zLmRhdGVSYW5nZSkge1xuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUob3B0aW9ucy5kYXRlUmFuZ2Uuc3RhcnREYXRlKTtcbiAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShvcHRpb25zLmRhdGVSYW5nZS5lbmREYXRlKTtcbiAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQuZmlsdGVyKGVudHJ5ID0+IHtcbiAgICAgICAgY29uc3QgZW50cnlEYXRlID0gbmV3IERhdGUoZW50cnkudGltZXN0YW1wKTtcbiAgICAgICAgcmV0dXJuIGVudHJ5RGF0ZSA+PSBzdGFydERhdGUgJiYgZW50cnlEYXRlIDw9IGVuZERhdGU7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBzZWFyY2ggdGVybSBmaWx0ZXJcbiAgICBpZiAob3B0aW9ucy5zZWFyY2hUZXJtKSB7XG4gICAgICBjb25zdCBzZWFyY2hUZXJtID0gb3B0aW9ucy5zZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCk7XG4gICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihlbnRyeSA9PiBcbiAgICAgICAgZW50cnkudGFncz8uc29tZSh0YWcgPT4gdGFnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSkpIHx8XG4gICAgICAgIGVudHJ5Lm5vdGVzPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0pXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IHNvcnRpbmdcbiAgICBjb25zdCBzb3J0QnkgPSBvcHRpb25zLnNvcnRCeSB8fCAndGltZXN0YW1wJztcbiAgICBjb25zdCBzb3J0RGlyZWN0aW9uID0gb3B0aW9ucy5zb3J0RGlyZWN0aW9uIHx8ICdkZXNjJztcbiAgICBcbiAgICBmaWx0ZXJlZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBsZXQgYVZhbHVlOiBEYXRlIHwgbnVtYmVyLCBiVmFsdWU6IERhdGUgfCBudW1iZXI7XG4gICAgICBcbiAgICAgIHN3aXRjaCAoc29ydEJ5KSB7XG4gICAgICAgIGNhc2UgJ3RpbWVzdGFtcCc6XG4gICAgICAgICAgYVZhbHVlID0gbmV3IERhdGUoYS50aW1lc3RhbXApO1xuICAgICAgICAgIGJWYWx1ZSA9IG5ldyBEYXRlKGIudGltZXN0YW1wKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncHJvY2Vzc2luZ1RpbWUnOlxuICAgICAgICAgIGFWYWx1ZSA9IGEucHJvY2Vzc2luZ1RpbWUgfHwgMDtcbiAgICAgICAgICBiVmFsdWUgPSBiLnByb2Nlc3NpbmdUaW1lIHx8IDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2lzRmF2b3JpdGUnOlxuICAgICAgICAgIGFWYWx1ZSA9IGEuaXNGYXZvcml0ZSA/IDEgOiAwO1xuICAgICAgICAgIGJWYWx1ZSA9IGIuaXNGYXZvcml0ZSA/IDEgOiAwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGFWYWx1ZSA9IGEudGltZXN0YW1wO1xuICAgICAgICAgIGJWYWx1ZSA9IGIudGltZXN0YW1wO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoc29ydERpcmVjdGlvbiA9PT0gJ2FzYycpIHtcbiAgICAgICAgcmV0dXJuIGFWYWx1ZSA8IGJWYWx1ZSA/IC0xIDogYVZhbHVlID4gYlZhbHVlID8gMSA6IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYVZhbHVlID4gYlZhbHVlID8gLTEgOiBhVmFsdWUgPCBiVmFsdWUgPyAxIDogMDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBuZXcgaGlzdG9yeSBlbnRyeVxuICAgKi9cbiAgYXN5bmMgYWRkRW50cnkob3B0aW9uczogQ3JlYXRlVHJ5b25IaXN0b3J5RW50cnlPcHRpb25zKTogUHJvbWlzZTxUcnlvbkhpc3RvcnlFbnRyeT4ge1xuICAgIGNvbnN0IGVudHJ5OiBUcnlvbkhpc3RvcnlFbnRyeSA9IHtcbiAgICAgIGlkOiBnZW5lcmF0ZUhpc3RvcnlJZCgpLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBnZW5lcmF0ZWRJbWFnZTogb3B0aW9ucy5nZW5lcmF0ZWRJbWFnZSxcbiAgICAgIG1vZGVsSW1hZ2U6IG9wdGlvbnMubW9kZWxJbWFnZSxcbiAgICAgIGFwcGFyZWxJbWFnZXM6IG9wdGlvbnMuYXBwYXJlbEltYWdlcyxcbiAgICAgIHByb2Nlc3NpbmdUaW1lOiBvcHRpb25zLnByb2Nlc3NpbmdUaW1lLFxuICAgICAgbWV0YWRhdGE6IG9wdGlvbnMubWV0YWRhdGEsXG4gICAgICB0YWdzOiBvcHRpb25zLnRhZ3MgfHwgW10sXG4gICAgICBpc0Zhdm9yaXRlOiBvcHRpb25zLmlzRmF2b3JpdGUgfHwgZmFsc2UsXG4gICAgICBub3Rlczogb3B0aW9ucy5ub3RlcyB8fCAnJ1xuICAgIH07XG5cbiAgICAvLyBDb21wcmVzcyBlbnRyeSBpZiBlbmFibGVkXG4gICAgY29uc3QgY29tcHJlc3NlZEVudHJ5ID0gYXdhaXQgY29tcHJlc3NIaXN0b3J5RW50cnkoZW50cnksIHRoaXMuY29uZmlnKTtcblxuICAgIC8vIENoZWNrIGVudHJ5IHNpemVcbiAgICBjb25zdCBlbnRyeVNpemUgPSBjYWxjdWxhdGVFbnRyeVNpemUoY29tcHJlc3NlZEVudHJ5KTtcbiAgICBpZiAoZW50cnlTaXplID4gdGhpcy5jb25maWcubWF4RW50cnlTaXplS0IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEhpc3RvcnkgZW50cnkgdG9vIGxhcmdlOiAke2VudHJ5U2l6ZS50b0ZpeGVkKDIpfUtCIGV4Y2VlZHMgbGltaXQgb2YgJHt0aGlzLmNvbmZpZy5tYXhFbnRyeVNpemVLQn1LQmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGN1cnJlbnQgZW50cmllcyBhbmQgYWRkIHRoZSBuZXcgb25lXG4gICAgbGV0IGVudHJpZXMgPSB0aGlzLmdldFN0b3JlZEVudHJpZXMoKTtcbiAgICBlbnRyaWVzLnB1c2goY29tcHJlc3NlZEVudHJ5KTtcblxuICAgIC8vIFBlcmZvcm0gY2xlYW51cCBpZiBuZWVkZWRcbiAgICBlbnRyaWVzID0gdGhpcy5wZXJmb3JtQ2xlYW51cElmTmVlZGVkKGVudHJpZXMpO1xuXG4gICAgLy8gU2F2ZSB1cGRhdGVkIGVudHJpZXNcbiAgICB0aGlzLnNhdmVFbnRyaWVzKGVudHJpZXMpO1xuXG4gICAgcmV0dXJuIGNvbXByZXNzZWRFbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaGlzdG9yeSBlbnRyaWVzIHdpdGggZmlsdGVyaW5nIGFuZCBwYWdpbmF0aW9uXG4gICAqL1xuICBhc3luYyBnZXRFbnRyaWVzKG9wdGlvbnM6IFRyeW9uSGlzdG9yeVF1ZXJ5T3B0aW9ucyA9IHt9KTogUHJvbWlzZTxUcnlvbkhpc3RvcnlDb2xsZWN0aW9uPiB7XG4gICAgY29uc3QgYWxsRW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgIGNvbnN0IGZpbHRlcmVkRW50cmllcyA9IHRoaXMuZmlsdGVyQW5kU29ydEVudHJpZXMoYWxsRW50cmllcywgb3B0aW9ucyk7XG5cbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uXG4gICAgY29uc3QgcGFnZSA9IG9wdGlvbnMucGFnZSB8fCAwO1xuICAgIGNvbnN0IHBhZ2VTaXplID0gb3B0aW9ucy5wYWdlU2l6ZSB8fCAyMDtcbiAgICBjb25zdCBzdGFydEluZGV4ID0gcGFnZSAqIHBhZ2VTaXplO1xuICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIHBhZ2VTaXplO1xuICAgIGNvbnN0IHBhZ2luYXRlZEVudHJpZXMgPSBmaWx0ZXJlZEVudHJpZXMuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGVudHJpZXM6IHBhZ2luYXRlZEVudHJpZXMsXG4gICAgICB0b3RhbENvdW50OiBmaWx0ZXJlZEVudHJpZXMubGVuZ3RoLFxuICAgICAgY3VycmVudFBhZ2U6IHBhZ2UsXG4gICAgICBwYWdlU2l6ZSxcbiAgICAgIGhhc01vcmU6IGVuZEluZGV4IDwgZmlsdGVyZWRFbnRyaWVzLmxlbmd0aCxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNwZWNpZmljIGhpc3RvcnkgZW50cnkgYnkgSURcbiAgICovXG4gIGFzeW5jIGdldEVudHJ5KGlkOiBzdHJpbmcpOiBQcm9taXNlPFRyeW9uSGlzdG9yeUVudHJ5IHwgbnVsbD4ge1xuICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLmdldFN0b3JlZEVudHJpZXMoKTtcbiAgICByZXR1cm4gZW50cmllcy5maW5kKGVudHJ5ID0+IGVudHJ5LmlkID09PSBpZCkgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYW4gZXhpc3RpbmcgaGlzdG9yeSBlbnRyeVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlRW50cnkoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxUcnlvbkhpc3RvcnlFbnRyeT4pOiBQcm9taXNlPFRyeW9uSGlzdG9yeUVudHJ5PiB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgIGNvbnN0IGVudHJ5SW5kZXggPSBlbnRyaWVzLmZpbmRJbmRleChlbnRyeSA9PiBlbnRyeS5pZCA9PT0gaWQpO1xuICAgIFxuICAgIGlmIChlbnRyeUluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBIaXN0b3J5IGVudHJ5IHdpdGggSUQgJHtpZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgdXBkYXRlc1xuICAgIGNvbnN0IHVwZGF0ZWRFbnRyeSA9IHsgXG4gICAgICAuLi5lbnRyaWVzW2VudHJ5SW5kZXhdLCBcbiAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICAvLyBQcmVzZXJ2ZSBJRCBhbmQgdGltZXN0YW1wLCB1cGRhdGUgb25seSBpZiBleHBsaWNpdGx5IHByb3ZpZGVkXG4gICAgICBpZDogZW50cmllc1tlbnRyeUluZGV4XS5pZCxcbiAgICAgIHRpbWVzdGFtcDogdXBkYXRlcy50aW1lc3RhbXAgfHwgZW50cmllc1tlbnRyeUluZGV4XS50aW1lc3RhbXBcbiAgICB9O1xuXG4gICAgZW50cmllc1tlbnRyeUluZGV4XSA9IHVwZGF0ZWRFbnRyeTtcbiAgICB0aGlzLnNhdmVFbnRyaWVzKGVudHJpZXMpO1xuXG4gICAgcmV0dXJuIHVwZGF0ZWRFbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBhc3luYyBkZWxldGVFbnRyeShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgIGNvbnN0IGZpbHRlcmVkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGVudHJ5ID0+IGVudHJ5LmlkICE9PSBpZCk7XG4gICAgXG4gICAgaWYgKGZpbHRlcmVkRW50cmllcy5sZW5ndGggPT09IGVudHJpZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIEVudHJ5IG5vdCBmb3VuZFxuICAgIH1cblxuICAgIHRoaXMuc2F2ZUVudHJpZXMoZmlsdGVyZWRFbnRyaWVzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgaGlzdG9yeSBlbnRyaWVzXG4gICAqL1xuICBhc3luYyBjbGVhckFsbCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlTLkVOVFJJRVMsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNsZWFyIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3RvcmFnZSBzdGF0aXN0aWNzXG4gICAqL1xuICBhc3luYyBnZXRTdG9yYWdlU3RhdHMoKTogUHJvbWlzZTx7XG4gICAgdG90YWxFbnRyaWVzOiBudW1iZXI7XG4gICAgdG90YWxTaXplS0I6IG51bWJlcjtcbiAgICBvbGRlc3RFbnRyeT86IHN0cmluZztcbiAgICBuZXdlc3RFbnRyeT86IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLmdldFN0b3JlZEVudHJpZXMoKTtcbiAgICBcbiAgICBsZXQgdG90YWxTaXplS0IgPSAwO1xuICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICB0b3RhbFNpemVLQiArPSBjYWxjdWxhdGVFbnRyeVNpemUoZW50cnkpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdGltZXN0YW1wcyA9IGVudHJpZXMubWFwKGVudHJ5ID0+IGVudHJ5LnRpbWVzdGFtcCkuc29ydCgpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbEVudHJpZXM6IGVudHJpZXMubGVuZ3RoLFxuICAgICAgdG90YWxTaXplS0IsXG4gICAgICBvbGRlc3RFbnRyeTogdGltZXN0YW1wc1swXSxcbiAgICAgIG5ld2VzdEVudHJ5OiB0aW1lc3RhbXBzW3RpbWVzdGFtcHMubGVuZ3RoIC0gMV1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBoaXN0b3J5IGRhdGFcbiAgICovXG4gIGFzeW5jIGV4cG9ydEhpc3RvcnkoKTogUHJvbWlzZTxUcnlvbkhpc3RvcnlFbnRyeVtdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEltcG9ydCBoaXN0b3J5IGRhdGFcbiAgICovXG4gIGFzeW5jIGltcG9ydEhpc3RvcnkoZW50cmllczogVHJ5b25IaXN0b3J5RW50cnlbXSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIGVudHJpZXNcbiAgICAgIGNvbnN0IHZhbGlkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGVudHJ5ID0+IFxuICAgICAgICBlbnRyeS5pZCAmJiBlbnRyeS5nZW5lcmF0ZWRJbWFnZSAmJiBlbnRyeS5tb2RlbEltYWdlICYmIGVudHJ5LmFwcGFyZWxJbWFnZXNcbiAgICAgICk7XG5cbiAgICAgIC8vIEdldCBleGlzdGluZyBlbnRyaWVzIGFuZCBtZXJnZSB3aXRoIGltcG9ydHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nRW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgICAgY29uc3QgZXhpc3RpbmdJZHMgPSBuZXcgU2V0KGV4aXN0aW5nRW50cmllcy5tYXAoZW50cnkgPT4gZW50cnkuaWQpKTtcbiAgICAgIFxuICAgICAgLy8gT25seSBpbXBvcnQgZW50cmllcyB0aGF0IGRvbid0IGFscmVhZHkgZXhpc3RcbiAgICAgIGNvbnN0IG5ld0VudHJpZXMgPSB2YWxpZEVudHJpZXMuZmlsdGVyKGVudHJ5ID0+ICFleGlzdGluZ0lkcy5oYXMoZW50cnkuaWQpKTtcbiAgICAgIFxuICAgICAgaWYgKG5ld0VudHJpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICAvLyBNZXJnZSBhbmQgc2F2ZVxuICAgICAgY29uc3QgbWVyZ2VkRW50cmllcyA9IFsuLi5leGlzdGluZ0VudHJpZXMsIC4uLm5ld0VudHJpZXNdO1xuICAgICAgY29uc3QgY2xlYW5lZEVudHJpZXMgPSB0aGlzLnBlcmZvcm1DbGVhbnVwSWZOZWVkZWQobWVyZ2VkRW50cmllcyk7XG4gICAgICBcbiAgICAgIHRoaXMuc2F2ZUVudHJpZXMoY2xlYW5lZEVudHJpZXMpO1xuICAgICAgcmV0dXJuIG5ld0VudHJpZXMubGVuZ3RoO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW1wb3J0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5IGltcG9ydCBmYWlsZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNlcnZpY2UgY29uZmlndXJhdGlvblxuICAgKi9cbiAgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZzogUGFydGlhbDxUcnlvbkhpc3RvcnlTdG9yYWdlQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4ubmV3Q29uZmlnIH07XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5DT05GSUcsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZmlnKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGNvbmZpZzonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBUcnlvbkhpc3RvcnlTdG9yYWdlQ29uZmlnIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmNvbmZpZyB9O1xuICB9XG59XG5cbi8qKlxuICogRGVmYXVsdCBoaXN0b3J5IHNlcnZpY2UgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRIaXN0b3J5U2VydmljZSA9IG5ldyBMb2NhbFN0b3JhZ2VUcnlvbkhpc3RvcnlTZXJ2aWNlKCk7Il0sIm5hbWVzIjpbIkxvY2FsU3RvcmFnZVRyeW9uSGlzdG9yeVNlcnZpY2UiLCJkZWZhdWx0SGlzdG9yeVNlcnZpY2UiLCJERUZBVUxUX0NPTkZJRyIsInN0b3JhZ2VUeXBlIiwibWF4RW50cmllcyIsIm1heEVudHJ5U2l6ZUtCIiwiY29tcHJlc3NJbWFnZXMiLCJjb21wcmVzc2lvblF1YWxpdHkiLCJhdXRvQ2xlYW51cCIsImVuY3J5cHRpb25LZXkiLCJTVE9SQUdFX0tFWVMiLCJFTlRSSUVTIiwiQ09ORklHIiwiTUVUQURBVEEiLCJnZW5lcmF0ZUhpc3RvcnlJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJjYWxjdWxhdGVFbnRyeVNpemUiLCJlbnRyeSIsImpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiQmxvYiIsInNpemUiLCJjb21wcmVzc0hpc3RvcnlFbnRyeSIsImNvbmZpZyIsIm1heFNpemVLQiIsImFwcGFyZWxJbWFnZXMiLCJsZW5ndGgiLCJxdWFsaXR5IiwiY29tcHJlc3NlZEdlbmVyYXRlZCIsImNvbXByZXNzQmFzZTY0IiwiZ2VuZXJhdGVkSW1hZ2UiLCJjb21wcmVzc2VkTW9kZWwiLCJtb2RlbEltYWdlIiwiY29tcHJlc3NlZEFwcGFyZWwiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiaW1nIiwibWV0YWRhdGEiLCJpbWFnZVByb2Nlc3NpbmdSZXN1bHRzIiwiZmluYWxJbWFnZVNpemVzIiwibW9kZWxJbWFnZVNpemUiLCJnZXRCYXNlNjRTaXplIiwiYXBwYXJlbEltYWdlU2l6ZXMiLCJlcnJvciIsIkNvbXByZXNzaW9uRmFpbGVkRXJyb3IiLCJjb25zb2xlIiwid2FybiIsImNvbnN0cnVjdG9yIiwiaW5pdGlhbGl6ZVN0b3JhZ2UiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJFcnJvciIsImdldEl0ZW0iLCJzZXRJdGVtIiwidmVyc2lvbiIsImNyZWF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibGFzdFVwZGF0ZWQiLCJnZXRTdG9yZWRFbnRyaWVzIiwiZW50cmllc0pzb24iLCJwYXJzZSIsInNhdmVFbnRyaWVzIiwiZW50cmllcyIsInBlcmZvcm1DbGVhbnVwSWZOZWVkZWQiLCJzb3J0ZWQiLCJzb3J0IiwiYSIsImIiLCJ0aW1lc3RhbXAiLCJnZXRUaW1lIiwic2xpY2UiLCJmaWx0ZXJBbmRTb3J0RW50cmllcyIsIm9wdGlvbnMiLCJmaWx0ZXJlZCIsImZhdm9yaXRlc09ubHkiLCJmaWx0ZXIiLCJpc0Zhdm9yaXRlIiwiZGF0ZVJhbmdlIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImVudHJ5RGF0ZSIsInNlYXJjaFRlcm0iLCJ0b0xvd2VyQ2FzZSIsInRhZ3MiLCJzb21lIiwidGFnIiwiaW5jbHVkZXMiLCJub3RlcyIsInNvcnRCeSIsInNvcnREaXJlY3Rpb24iLCJhVmFsdWUiLCJiVmFsdWUiLCJwcm9jZXNzaW5nVGltZSIsImFkZEVudHJ5IiwiaWQiLCJjb21wcmVzc2VkRW50cnkiLCJlbnRyeVNpemUiLCJ0b0ZpeGVkIiwicHVzaCIsImdldEVudHJpZXMiLCJhbGxFbnRyaWVzIiwiZmlsdGVyZWRFbnRyaWVzIiwicGFnZSIsInBhZ2VTaXplIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwicGFnaW5hdGVkRW50cmllcyIsInRvdGFsQ291bnQiLCJjdXJyZW50UGFnZSIsImhhc01vcmUiLCJnZXRFbnRyeSIsImZpbmQiLCJ1cGRhdGVFbnRyeSIsInVwZGF0ZXMiLCJlbnRyeUluZGV4IiwiZmluZEluZGV4IiwidXBkYXRlZEVudHJ5IiwiZGVsZXRlRW50cnkiLCJjbGVhckFsbCIsImdldFN0b3JhZ2VTdGF0cyIsInRvdGFsU2l6ZUtCIiwiZm9yRWFjaCIsInRpbWVzdGFtcHMiLCJ0b3RhbEVudHJpZXMiLCJvbGRlc3RFbnRyeSIsIm5ld2VzdEVudHJ5IiwiZXhwb3J0SGlzdG9yeSIsImltcG9ydEhpc3RvcnkiLCJ2YWxpZEVudHJpZXMiLCJleGlzdGluZ0VudHJpZXMiLCJleGlzdGluZ0lkcyIsIlNldCIsIm5ld0VudHJpZXMiLCJoYXMiLCJtZXJnZWRFbnRyaWVzIiwiY2xlYW5lZEVudHJpZXMiLCJ1cGRhdGVDb25maWciLCJuZXdDb25maWciLCJnZXRDb25maWciXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUNqQyx1RkFBdUY7Ozs7Ozs7Ozs7OztJQW1IMUVBLCtCQUErQjtlQUEvQkE7O0lBc1hBQyxxQkFBcUI7ZUFBckJBOzs7aUNBbmVOO0FBVVA7O0NBRUMsR0FDRCxNQUFNQyxpQkFBc0Q7SUFDMURDLGFBQWE7SUFDYkMsWUFBWTtJQUNaQyxnQkFBZ0I7SUFDaEJDLGdCQUFnQjtJQUNoQkMsb0JBQW9CO0lBQ3BCQyxhQUFhO0lBQ2JDLGVBQWU7QUFDakI7QUFFQTs7Q0FFQyxHQUNELE1BQU1DLGVBQWU7SUFDbkJDLFNBQVM7SUFDVEMsUUFBUTtJQUNSQyxVQUFVO0FBQ1o7QUFFQTs7Q0FFQyxHQUNELFNBQVNDO0lBQ1AsT0FBTyxDQUFDLE1BQU0sRUFBRUMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsTUFBTSxDQUFDLEdBQUcsSUFBSTtBQUN6RTtBQUVBOztDQUVDLEdBQ0QsU0FBU0MsbUJBQW1CQyxLQUF3QjtJQUNsRCxNQUFNQyxPQUFPQyxLQUFLQyxTQUFTLENBQUNIO0lBQzVCLE9BQU8sSUFBSUksS0FBSztRQUFDSDtLQUFLLEVBQUVJLElBQUksR0FBRztBQUNqQztBQUVBOztDQUVDLEdBQ0QsZUFBZUMscUJBQ2JOLEtBQXdCLEVBQ3hCTyxNQUFpQztJQUVqQyxJQUFJLENBQUNBLE9BQU92QixjQUFjLEVBQUU7UUFDMUIsT0FBT2dCO0lBQ1Q7SUFFQSxJQUFJO1FBQ0YsTUFBTVEsWUFBWUQsT0FBT3hCLGNBQWMs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