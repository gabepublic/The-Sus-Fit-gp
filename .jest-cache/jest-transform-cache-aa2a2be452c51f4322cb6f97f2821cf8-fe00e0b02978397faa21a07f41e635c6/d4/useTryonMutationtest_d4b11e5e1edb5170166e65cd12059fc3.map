{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/mutations/useTryonMutation.test.ts"],"sourcesContent":["// Comprehensive Tests for useTryonMutation Hook\n// Tests covering all scenarios: success, error, retry, image processing, optimistic updates\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { QueryClient } from '@tanstack/react-query';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport type {\n  TryonMutationVariables,\n  TryonMutationResponse,\n  TryonMutationError,\n  UseTryonMutationConfig\n} from '../../../src/business-layer/types/tryon.types';\nimport {\n  createTestQueryClient,\n  createQueryClientWrapper,\n  mockTryonAPI,\n  mockTryonVariables,\n  mockTryonResponse,\n  mockTryonError,\n  mockConsole,\n  waitForPromises\n} from '../../../src/business-layer/tests/testUtils';\n\n// Mock the optimistic updates manager\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: () => ({\n    startOptimisticUpdate: jest.fn(() => ({\n      optimisticId: 'mock-optimistic-id',\n      variables: mockTryonVariables,\n      config: {},\n      startTime: Date.now(),\n      rollbackFunctions: []\n    })),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn(() => ({\n    startOptimisticUpdate: jest.fn(),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }))\n}));\n\n// Mock the cache invalidation utility\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined),\n  getCacheInvalidationManager: jest.fn(() => ({\n    invalidateAfterSuccess: jest.fn(),\n    invalidateAfterError: jest.fn()\n  }))\n}));\n\n// Mock image processing utilities\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn().mockResolvedValue({\n    originalSize: 2048576,\n    processedSize: 1048576,\n    compressionRatio: 0.5,\n    processingTime: 123,\n    processedImage: 'data:image/jpeg;base64,processed-image',\n    metadata: {\n      originalDimensions: { width: 1920, height: 1080 },\n      processedDimensions: { width: 1024, height: 1536 },\n      format: 'jpeg',\n      quality: 0.9\n    }\n  })\n}));\n\n// Mock error handling utilities\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn((error) => ({\n    userMessage: 'An error occurred',\n    technicalMessage: error.message || 'Unknown error',\n    errorCode: 'UNKNOWN_ERROR',\n    retryable: false,\n    category: 'NETWORK_ERROR',\n    severity: 'MEDIUM',\n    recoveryActions: []\n  })),\n  logAndClassifyError: jest.fn((error) => ({\n    userMessage: 'An error occurred',\n    technicalMessage: error.details || error.message || 'Unknown error',\n    errorCode: 'UNKNOWN_ERROR',\n    retryable: false,\n    category: 'NETWORK_ERROR',\n    severity: 'MEDIUM',\n    recoveryActions: []\n  })),\n  isErrorRetryable: jest.fn(() => true)\n}));\n\ndescribe('useTryonMutation Hook', () => {\n  let queryClient: QueryClient;\n  let consoleRef: ReturnType<typeof mockConsole>;\n\n  beforeEach(() => {\n    queryClient = createTestQueryClient();\n    consoleRef = mockConsole();\n    jest.clearAllMocks();\n    global.fetch = jest.fn();\n  });\n\n  afterEach(() => {\n    queryClient.clear();\n    consoleRef.restore();\n    jest.restoreAllMocks();\n  });\n\n  describe('Basic Functionality', () => {\n    it('should initialize with correct default state', () => {\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      expect(result.current.data).toBeUndefined();\n      expect(result.current.error).toBeNull();\n      expect(result.current.isLoading).toBe(false);\n      expect(result.current.isSuccess).toBe(false);\n      expect(result.current.isError).toBe(false);\n      expect(result.current.isIdle).toBe(true);\n      expect(result.current.status).toBe('idle');\n      expect(typeof result.current.mutate).toBe('function');\n      expect(typeof result.current.mutateAsync).toBe('function');\n      expect(typeof result.current.reset).toBe('function');\n    });\n\n    it('should accept custom configuration', () => {\n      const config: UseTryonMutationConfig = {\n        enableRetry: false,\n        maxRetries: 5,\n        initialRetryDelay: 2000,\n        enableOptimisticUpdates: true\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      expect(result.current.isIdle).toBe(true);\n    });\n  });\n\n  describe('Success Scenarios', () => {\n    it('should handle successful mutation with base64 strings', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(result.current.data).toEqual(mockTryonResponse);\n      expect(result.current.error).toBeNull();\n      expect(result.current.isLoading).toBe(false);\n      expect(global.fetch).toHaveBeenCalledWith(\n        '/api/tryon',\n        expect.objectContaining({\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: expect.stringContaining('\"modelImage\":\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/mock-model-image\"')\n        })\n      );\n    });\n\n    it('should handle successful mutation with File objects', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variablesWithFiles = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: mockTryonVariables.options\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(variablesWithFiles as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(result.current.data).toEqual(mockTryonResponse);\n    });\n\n    it('should call success callback on successful mutation', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const onSuccess = jest.fn();\n      const config: UseTryonMutationConfig = { onSuccess };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockTryonResponse,\n        expect.objectContaining(mockTryonVariables),\n        expect.objectContaining({\n          variables: expect.objectContaining(mockTryonVariables),\n          startTime: expect.any(Number),\n          retryCount: 0\n        })\n      );\n    });\n\n    it('should handle mutation with timeout configuration', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 100); // 100ms delay\n\n      const variablesWithTimeout = {\n        ...mockTryonVariables,\n        options: {\n          ...mockTryonVariables.options,\n          timeout: 5000\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(variablesWithTimeout);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(result.current.data).toEqual(mockTryonResponse);\n    });\n  });\n\n  describe('Error Scenarios', () => {\n    it('should handle API error responses', async () => {\n      const apiError = {\n        ...mockTryonError,\n        status: 400\n      };\n      mockTryonAPI(undefined, apiError);\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n      expect(result.current.data).toBeUndefined();\n      expect(result.current.isLoading).toBe(false);\n    });\n\n    it('should call error callback on failed mutation', async () => {\n      const apiError = new Error('API request failed');\n      mockTryonAPI(undefined, apiError);\n\n      const onError = jest.fn();\n      const config: UseTryonMutationConfig = { onError };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(onError).toHaveBeenCalledWith(\n        expect.objectContaining({\n          error: 'An error occurred',\n          details: 'API request failed'\n        }),\n        expect.objectContaining(mockTryonVariables),\n        expect.objectContaining({\n          variables: expect.objectContaining(mockTryonVariables)\n        })\n      );\n    });\n\n    it('should handle network timeout errors', async () => {\n      // Mock fetch to simulate timeout\n      (global.fetch as jest.Mock).mockImplementation(() => {\n        return new Promise((_, reject) => {\n          setTimeout(() => {\n            const error = new Error('Request timeout');\n            error.name = 'AbortError';\n            reject(error);\n          }, 50);\n        });\n      });\n\n      const variablesWithShortTimeout = {\n        ...mockTryonVariables,\n        options: {\n          ...mockTryonVariables.options,\n          timeout: 10 // Very short timeout\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(variablesWithShortTimeout);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      }, { timeout: 1000 });\n\n      expect(result.current.error).toBeTruthy();\n    });\n\n    it('should handle image processing errors', async () => {\n      const { processImageForTryon } = require('../../../src/business-layer/utils/imageProcessing');\n      processImageForTryon.mockRejectedValueOnce(new Error('Invalid image format'));\n\n      const mockFile = new File(['invalid content'], 'test.txt', { type: 'text/plain' });\n      const variablesWithInvalidFile = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: mockTryonVariables.options\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(variablesWithInvalidFile as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n    });\n  });\n\n  describe('Retry Logic', () => {\n    it('should retry on retryable errors', async () => {\n      let callCount = 0;\n      (global.fetch as jest.Mock).mockImplementation(() => {\n        callCount++;\n        if (callCount <= 2) {\n          return Promise.resolve({\n            ok: false,\n            status: 500,\n            json: () => Promise.resolve({ error: 'Internal Server Error' })\n          });\n        }\n        return Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve(mockTryonResponse)\n        });\n      });\n\n      const config: UseTryonMutationConfig = {\n        enableRetry: true,\n        maxRetries: 3,\n        initialRetryDelay: 10 // Short delay for testing\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      }, { timeout: 5000 });\n\n      expect(callCount).toBe(3);\n      expect(result.current.data).toEqual(mockTryonResponse);\n    });\n\n    it('should not retry when retry is disabled', async () => {\n      let callCount = 0;\n      (global.fetch as jest.Mock).mockImplementation(() => {\n        callCount++;\n        return Promise.resolve({\n          ok: false,\n          status: 500,\n          json: () => Promise.resolve({ error: 'Internal Server Error' })\n        });\n      });\n\n      const config: UseTryonMutationConfig = {\n        enableRetry: false\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(callCount).toBe(1);\n    });\n\n    it('should stop retrying after max retries reached', async () => {\n      let callCount = 0;\n      (global.fetch as jest.Mock).mockImplementation(() => {\n        callCount++;\n        return Promise.resolve({\n          ok: false,\n          status: 500,\n          json: () => Promise.resolve({ error: 'Internal Server Error' })\n        });\n      });\n\n      const config: UseTryonMutationConfig = {\n        enableRetry: true,\n        maxRetries: 2,\n        initialRetryDelay: 10\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      }, { timeout: 5000 });\n\n      expect(callCount).toBe(3); // Initial call + 2 retries\n    });\n  });\n\n  describe('Optimistic Updates Integration', () => {\n    it('should start optimistic updates when enabled', async () => {\n      mockTryonAPI(mockTryonResponse);\n      \n      const { getOptimisticUpdatesManager } = require('../../../src/business-layer/utils/optimisticUpdates');\n      const mockOptimisticManager = getOptimisticUpdatesManager();\n\n      const config: UseTryonMutationConfig = {\n        enableOptimisticUpdates: true,\n        optimisticConfig: {\n          showPreview: true,\n          updateHistory: true\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockOptimisticManager.startOptimisticUpdate).toHaveBeenCalledWith(\n        expect.objectContaining(mockTryonVariables),\n        expect.objectContaining({\n          showPreview: true,\n          updateHistory: true\n        })\n      );\n      expect(mockOptimisticManager.completeOptimisticUpdate).toHaveBeenCalledWith(\n        'mock-optimistic-id',\n        mockTryonResponse,\n        expect.any(Object)\n      );\n    });\n\n    it('should rollback optimistic updates on error', async () => {\n      const apiError = new Error('API request failed');\n      mockTryonAPI(undefined, apiError);\n\n      const { getOptimisticUpdatesManager } = require('../../../src/business-layer/utils/optimisticUpdates');\n      const mockOptimisticManager = getOptimisticUpdatesManager();\n\n      const config: UseTryonMutationConfig = {\n        enableOptimisticUpdates: true\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(mockOptimisticManager.rollbackOptimisticUpdate).toHaveBeenCalledWith(\n        'mock-optimistic-id',\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('Cache Invalidation Integration', () => {\n    it('should invalidate cache on successful mutation', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const { invalidateCacheAfterMutation } = require('../../../src/business-layer/utils/cacheInvalidation');\n\n      const config: UseTryonMutationConfig = {\n        cacheInvalidationConfig: {\n          invalidateHistory: true,\n          invalidateUserData: true\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(invalidateCacheAfterMutation).toHaveBeenCalledWith(\n        queryClient,\n        mockTryonResponse,\n        expect.objectContaining(mockTryonVariables),\n        expect.any(Object),\n        expect.objectContaining({\n          invalidateHistory: true,\n          invalidateUserData: true\n        })\n      );\n    });\n\n    it('should handle cache invalidation failures gracefully', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const { invalidateCacheAfterMutation } = require('../../../src/business-layer/utils/cacheInvalidation');\n      invalidateCacheAfterMutation.mockRejectedValueOnce(new Error('Cache invalidation failed'));\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      // Should still succeed even if cache invalidation fails\n      expect(result.current.data).toEqual(mockTryonResponse);\n      expect(consoleRef.mocks.warn).toHaveBeenCalledWith(\n        'Failed to invalidate cache after mutation:',\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('Lifecycle Callbacks', () => {\n    it('should call onMutate callback before mutation', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 100);\n\n      const onMutate = jest.fn().mockResolvedValue({ customData: 'test' });\n      const config: UseTryonMutationConfig = { onMutate };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      expect(onMutate).toHaveBeenCalledWith(\n        expect.objectContaining(mockTryonVariables)\n      );\n    });\n\n    it('should call onSettled callback after mutation completes', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const onSettled = jest.fn();\n      const config: UseTryonMutationConfig = { onSettled };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        mockTryonResponse,\n        null,\n        expect.objectContaining(mockTryonVariables),\n        expect.objectContaining({\n          variables: expect.objectContaining(mockTryonVariables)\n        })\n      );\n    });\n\n    it('should call onSettled callback after mutation fails', async () => {\n      const apiError = new Error('API request failed');\n      mockTryonAPI(undefined, apiError);\n\n      const onSettled = jest.fn();\n      const config: UseTryonMutationConfig = { onSettled };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        undefined,\n        expect.objectContaining({\n          error: 'An error occurred'\n        }),\n        expect.objectContaining(mockTryonVariables),\n        expect.objectContaining({\n          variables: expect.objectContaining(mockTryonVariables)\n        })\n      );\n    });\n  });\n\n  describe('Reset Functionality', () => {\n    it('should reset mutation state correctly', async () => {\n      mockTryonAPI(mockTryonResponse);\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      // Execute mutation\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(result.current.data).toEqual(mockTryonResponse);\n\n      // Reset mutation\n      act(() => {\n        result.current.reset();\n      });\n\n      expect(result.current.data).toBeUndefined();\n      expect(result.current.error).toBeNull();\n      expect(result.current.isLoading).toBe(false);\n      expect(result.current.isSuccess).toBe(false);\n      expect(result.current.isError).toBe(false);\n      expect(result.current.isIdle).toBe(true);\n      expect(result.current.status).toBe('idle');\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle malformed API responses', async () => {\n      (global.fetch as jest.Mock).mockResolvedValueOnce({\n        ok: true,\n        status: 200,\n        json: () => Promise.resolve({ invalid: 'response' }) // Missing img_generated field\n      });\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n    });\n\n    it('should handle JSON parsing errors', async () => {\n      (global.fetch as jest.Mock).mockResolvedValueOnce({\n        ok: true,\n        status: 200,\n        json: () => Promise.reject(new Error('Invalid JSON'))\n      });\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n    });\n\n    it('should handle component unmount during mutation', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 500); // Long delay\n\n      const { result, unmount } = renderHook(\n        () => useTryonMutation({ enableOptimisticUpdates: true }),\n        {\n          wrapper: createQueryClientWrapper(queryClient)\n        }\n      );\n\n      const { getOptimisticUpdatesManager } = require('../../../src/business-layer/utils/optimisticUpdates');\n      const mockOptimisticManager = getOptimisticUpdatesManager();\n\n      // Start mutation\n      await act(async () => {\n        result.current.mutate(mockTryonVariables);\n      });\n\n      // Unmount component before mutation completes\n      unmount();\n\n      // Wait for cleanup\n      await waitForPromises();\n\n      // Should rollback optimistic updates on unmount\n      expect(mockOptimisticManager.rollbackOptimisticUpdate).toHaveBeenCalledWith(\n        'mock-optimistic-id',\n        expect.objectContaining({ message: 'Component unmounted' })\n      );\n    });\n  });\n});"],"names":["jest","mock","getOptimisticUpdatesManager","startOptimisticUpdate","fn","optimisticId","variables","mockTryonVariables","config","startTime","Date","now","rollbackFunctions","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","getCacheInvalidationManager","invalidateAfterSuccess","invalidateAfterError","processImageForTryon","originalSize","processedSize","compressionRatio","processingTime","processedImage","metadata","originalDimensions","width","height","processedDimensions","format","quality","classifyTryonError","error","userMessage","technicalMessage","message","errorCode","retryable","category","severity","recoveryActions","logAndClassifyError","details","isErrorRetryable","describe","queryClient","consoleRef","beforeEach","createTestQueryClient","mockConsole","clearAllMocks","global","fetch","afterEach","clear","restore","restoreAllMocks","it","result","renderHook","useTryonMutation","wrapper","createQueryClientWrapper","expect","current","data","toBeUndefined","toBeNull","isLoading","toBe","isSuccess","isError","isIdle","status","mutate","mutateAsync","reset","enableRetry","maxRetries","initialRetryDelay","enableOptimisticUpdates","mockTryonAPI","mockTryonResponse","act","waitFor","toEqual","toHaveBeenCalledWith","objectContaining","method","headers","body","stringContaining","mockFile","File","type","variablesWithFiles","modelImage","apparelImages","options","onSuccess","any","Number","retryCount","variablesWithTimeout","timeout","apiError","mockTryonError","toBeTruthy","Error","onError","mockImplementation","Promise","_","reject","setTimeout","name","variablesWithShortTimeout","require","mockRejectedValueOnce","variablesWithInvalidFile","callCount","resolve","ok","json","mockOptimisticManager","optimisticConfig","showPreview","updateHistory","Object","cacheInvalidationConfig","invalidateHistory","invalidateUserData","mocks","warn","onMutate","customData","onSettled","mockResolvedValueOnce","invalid","unmount","waitForPromises"],"mappings":"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"}