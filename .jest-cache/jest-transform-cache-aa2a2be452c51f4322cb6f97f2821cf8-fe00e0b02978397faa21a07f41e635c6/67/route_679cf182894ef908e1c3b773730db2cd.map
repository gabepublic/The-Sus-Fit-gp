{"version":3,"names":["OPTIONS","cov_2cufqgrfb1","f","s","POST","createCorsHeaders","origin","request","b","headers","get","process","env","NEXT_PUBLIC_BASE_URL","_server","NextResponse","status","corsHeaders","body","json","modelImage","apparelImages","_schema","TryonSchema","parse","img_generated","_openaiClient","generateTryOn","error","_zod","ZodError","details","errors","map","err","field","path","join","message","console","errorMessage","NODE_ENV","Error"],"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/src/app/api/tryon/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { ZodError } from 'zod';\nimport { TryonSchema } from './schema';\nimport { generateTryOn } from '../../../lib/openaiClient';\n\n// TODO: Implement try-on functionality\n// - ✅ Add request validation (subtask 3.2) - COMPLETED\n// - ✅ Add request parsing & payload validation (subtask 3.3) - COMPLETED\n// - ✅ Add image processing logic (subtask 3.4) - COMPLETED\n// - ✅ Add error handling (subtask 3.5) - COMPLETED\n\n// Helper function to create CORS headers\nfunction createCorsHeaders(origin: string) {\n  return {\n    'Access-Control-Allow-Origin': origin,\n    'Access-Control-Allow-Methods': 'POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type'\n  };\n}\n\n// Handle OPTIONS preflight requests\nexport async function OPTIONS(request: NextRequest): Promise<NextResponse> {\n  const origin = request.headers.get('origin') ?? process.env.NEXT_PUBLIC_BASE_URL ?? '';\n  return new NextResponse(null, {\n    status: 200,\n    headers: createCorsHeaders(origin)\n  });\n}\n\nexport async function POST(request: NextRequest): Promise<NextResponse> {\n  const origin = request.headers.get('origin') ?? process.env.NEXT_PUBLIC_BASE_URL ?? '';\n  const corsHeaders = createCorsHeaders(origin);\n\n  try {\n    // Parse request body\n    const body = await request.json();\n    \n    // Validate payload against schema\n    const { modelImage, apparelImages } = TryonSchema.parse(body);\n    \n    // Generate try-on image using OpenAI\n    const img_generated = await generateTryOn({ modelImage, apparelImages });\n    \n    // Return generated image with CORS headers\n    return NextResponse.json({ \n      img_generated \n    }, { \n      status: 200,\n      headers: corsHeaders\n    });\n    \n  } catch (error) {\n    // Handle Zod validation errors\n    if (error instanceof ZodError) {\n      return NextResponse.json({ \n        error: 'Validation failed',\n        details: error.errors.map(err => ({\n          field: err.path.join('.'),\n          message: err.message\n        }))\n      }, { \n        status: 400,\n        headers: corsHeaders\n      });\n    }\n    \n    // Handle generateTryOn errors and other internal errors\n    console.error('Try-on API error:', error);\n    const errorMessage = process.env.NODE_ENV === 'development' \n      ? (error instanceof Error ? error.message : 'Unknown error occurred')\n      : 'Internal Server Error';\n    \n    return NextResponse.json({ \n      error: errorMessage\n    }, { \n      status: 500,\n      headers: corsHeaders\n    });\n  }\n} "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAqBsBA,OAAO,WAAAA,CAAA;IAAA;IAAAC,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAPH,OAAA;;EAQAI,IAAI,WAAAA,CAAA;IAAA;IAAAH,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAJC,IAAA;;;;;kCA7BoB;;;kCACjB;;;kCACG;;;kCACE;AAE9B;AACA;AACA;AACA;AACA;AAEA;AACA,SAASC,kBAAkBC,MAAc;EAAA;EAAAL,cAAA,GAAAC,CAAA;EAAAD,cAAA,GAAAE,CAAA;EACvC,OAAO;IACL,+BAA+BG,MAAA;IAC/B,gCAAgC;IAChC,gCAAgC;EAClC;AACF;AAGO,eAAeN,QAAQO,OAAoB;EAAA;EAAAN,cAAA,GAAAC,CAAA;EAChD,MAAMI,MAAA;EAAA;EAAA,CAAAL,cAAA,GAAAE,CAAA;EAAS;EAAA,CAAAF,cAAA,GAAAO,CAAA,UAAAD,OAAA,CAAQE,OAAO,CAACC,GAAG,CAAC;EAAA;EAAA,CAAAT,cAAA,GAAAO,CAAA,UAAaG,OAAA,CAAQC,GAAG,CAACC,oBAAoB;EAAA;EAAA,CAAAZ,cAAA,GAAAO,CAAA,UAAI;EAAA;EAAAP,cAAA,GAAAE,CAAA;EACpF,OAAO,IAAIW,OAAA,CAAAC,YAAY,CAAC,MAAM;IAC5BC,MAAA,EAAQ;IACRP,OAAA,EAASJ,iBAAA,CAAkBC,MAAA;EAC7B;AACF;AAEO,eAAeF,KAAKG,OAAoB;EAAA;EAAAN,cAAA,GAAAC,CAAA;EAC7C,MAAMI,MAAA;EAAA;EAAA,CAAAL,cAAA,GAAAE,CAAA;EAAS;EAAA,CAAAF,cAAA,GAAAO,CAAA,UAAAD,OAAA,CAAQE,OAAO,CAACC,GAAG,CAAC;EAAA;EAAA,CAAAT,cAAA,GAAAO,CAAA,UAAaG,OAAA,CAAQC,GAAG,CAACC,oBAAoB;EAAA;EAAA,CAAAZ,cAAA,GAAAO,CAAA,UAAI;EACpF,MAAMS,WAAA;EAAA;EAAA,CAAAhB,cAAA,GAAAE,CAAA,QAAcE,iBAAA,CAAkBC,MAAA;EAAA;EAAAL,cAAA,GAAAE,CAAA;EAEtC,IAAI;IACF;IACA,MAAMe,IAAA;IAAA;IAAA,CAAAjB,cAAA,GAAAE,CAAA,QAAO,MAAMI,OAAA,CAAQY,IAAI;IAE/B;IACA,MAAM;MAAEC,UAAU;MAAEC;IAAa,CAAE;IAAA;IAAA,CAAApB,cAAA,GAAAE,CAAA,QAAGmB,OAAA,CAAAC,WAAW,CAACC,KAAK,CAACN,IAAA;IAExD;IACA,MAAMO,aAAA;IAAA;IAAA,CAAAxB,cAAA,GAAAE,CAAA,QAAgB,MAAM,IAAAuB,aAAA,CAAAC,aAAa,EAAC;MAAEP,UAAA;MAAYC;IAAc;IAEtE;IAAA;IAAApB,cAAA,GAAAE,CAAA;IACA,OAAOW,OAAA,CAAAC,YAAY,CAACI,IAAI,CAAC;MACvBM;IACF,GAAG;MACDT,MAAA,EAAQ;MACRP,OAAA,EAASQ;IACX;EAEF,EAAE,OAAOW,KAAA,EAAO;IAAA;IAAA3B,cAAA,GAAAE,CAAA;IACd;IACA,IAAIyB,KAAA,YAAiBC,IAAA,CAAAC,QAAQ,EAAE;MAAA;MAAA7B,cAAA,GAAAO,CAAA;MAAAP,cAAA,GAAAE,CAAA;MAC7B,OAAOW,OAAA,CAAAC,YAAY,CAACI,IAAI,CAAC;QACvBS,KAAA,EAAO;QACPG,OAAA,EAASH,KAAA,CAAMI,MAAM,CAACC,GAAG,CAACC,GAAA,IAAQ;UAAA;UAAAjC,cAAA,GAAAC,CAAA;UAAAD,cAAA,GAAAE,CAAA;UAAA;YAChCgC,KAAA,EAAOD,GAAA,CAAIE,IAAI,CAACC,IAAI,CAAC;YACrBC,OAAA,EAASJ,GAAA,CAAII;UACf;QAAA;MACF,GAAG;QACDtB,MAAA,EAAQ;QACRP,OAAA,EAASQ;MACX;IACF;IAAA;IAAA;MAAAhB,cAAA,GAAAO,CAAA;IAAA;IAEA;IAAAP,cAAA,GAAAE,CAAA;IACAoC,OAAA,CAAQX,KAAK,CAAC,qBAAqBA,KAAA;IACnC,MAAMY,YAAA;IAAA;IAAA,CAAAvC,cAAA,GAAAE,CAAA,QAAeQ,OAAA,CAAQC,GAAG,CAAC6B,QAAQ,KAAK;IAAA;IAAA,CAAAxC,cAAA,GAAAO,CAAA,UACzCoB,KAAA,YAAiBc,KAAA;IAAA;IAAA,CAAAzC,cAAA,GAAAO,CAAA,UAAQoB,KAAA,CAAMU,OAAO;IAAA;IAAA,CAAArC,cAAA,GAAAO,CAAA,UAAG;IAAA;IAAA,CAAAP,cAAA,GAAAO,CAAA,UAC1C;IAAA;IAAAP,cAAA,GAAAE,CAAA;IAEJ,OAAOW,OAAA,CAAAC,YAAY,CAACI,IAAI,CAAC;MACvBS,KAAA,EAAOY;IACT,GAAG;MACDxB,MAAA,EAAQ;MACRP,OAAA,EAASQ;IACX;EACF;AACF","ignoreList":[]}