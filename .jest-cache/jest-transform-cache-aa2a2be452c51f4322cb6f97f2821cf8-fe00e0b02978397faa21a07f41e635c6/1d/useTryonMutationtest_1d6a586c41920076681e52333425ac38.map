{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/mutations/useTryonMutation.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport React from 'react';\nimport { render, screen, waitFor, act } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport type { \n  TryonMutationVariables,\n  TryonMutationVariablesWithFiles, \n  TryonMutationResponse,\n  TryonMutationError,\n  UseTryonMutationConfig \n} from '../../../src/business-layer/types/tryon.types';\n\n// Mock image processing utilities\nconst mockProcessImageForTryon = jest.fn().mockImplementation((file, options) => {\n  return Promise.resolve({\n    processedImage: 'data:image/jpeg;base64,processed-image-data',\n    originalSize: 1024,\n    processedSize: 512,\n    compressionRatio: 0.5,\n    processingTime: 100,\n    dimensions: { width: 1024, height: 1536 }\n  });\n});\n\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: mockProcessImageForTryon,\n  ImageProcessingError: class ImageProcessingError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  ImageDimensionError: class ImageDimensionError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock image utilities\njest.mock('../../../src/utils/image', () => ({\n  FileTypeNotSupportedError: class FileTypeNotSupportedError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  FileTooLargeError: class FileTooLargeError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  CompressionFailedError: class CompressionFailedError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock error handling utilities\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn().mockImplementation((error) => {\n    const message = error?.message || 'Unknown error';\n    if (message.includes('Network')) {\n      return {\n        userMessage: 'Network connection issue. Please check your internet and try again.',\n        technicalMessage: 'Network error',\n        retryable: true,\n        category: 'network',\n        severity: 'medium',\n        recoveryActions: [{ type: 'check_connection', description: 'Check your internet connection' }],\n        errorCode: 'NETWORK_ERROR'\n      };\n    }\n    return {\n      userMessage: 'An unexpected error occurred. Please try again or contact support if the problem persists.',\n      technicalMessage: message,\n      retryable: true,\n      category: 'unknown',\n      severity: 'high',\n      recoveryActions: [],\n      errorCode: 'UNKNOWN_ERROR'\n    };\n  }),\n  logAndClassifyError: jest.fn().mockImplementation((error) => {\n    const message = error?.message || 'Unknown error';\n    if (message.includes('Network')) {\n      return {\n        userMessage: 'Network connection issue. Please check your internet and try again.',\n        technicalMessage: 'Network error',\n        retryable: true,\n        category: 'network',\n        severity: 'medium',\n        recoveryActions: [{ type: 'check_connection', description: 'Check your internet connection' }],\n        errorCode: 'NETWORK_ERROR'\n      };\n    }\n    return {\n      userMessage: 'An unexpected error occurred. Please try again or contact support if the problem persists.',\n      technicalMessage: message,\n      retryable: true,\n      category: 'unknown',\n      severity: 'high',\n      recoveryActions: [],\n      errorCode: 'UNKNOWN_ERROR'\n    };\n  }),\n  isErrorRetryable: jest.fn().mockReturnValue(false)\n}));\n\n// Mock optimistic updates\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: jest.fn().mockReturnValue({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn().mockImplementation(() => ({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }))\n}));\n\n// Mock cache invalidation\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  getCacheInvalidationManager: jest.fn(),\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\n// Mock fetch globally\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch;\n\n// Mock abort controller for timeout tests\nclass MockAbortController {\n  signal = { aborted: false };\n  abort = jest.fn(() => {\n    this.signal.aborted = true;\n  });\n}\nglobal.AbortController = MockAbortController as any;\n\ndescribe('useTryonMutation', () => {\n  let queryClient: QueryClient;\n\n  beforeEach(() => {\n    queryClient = new QueryClient({\n      defaultOptions: {\n        queries: { retry: false, gcTime: 0 },\n        mutations: { retry: false },\n      },\n    });\n    mockFetch.mockClear();\n    jest.clearAllTimers();\n    jest.useFakeTimers();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n    queryClient.clear();\n  });\n\n  const renderWithProvider = (children: React.ReactNode) => {\n    return render(\n      <QueryClientProvider client={queryClient}>\n        {children}\n      </QueryClientProvider>\n    );\n  };\n\n  const mockVariables: TryonMutationVariables = {\n    modelImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD',\n    apparelImages: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD']\n  };\n\n  const mockSuccessResponse: TryonMutationResponse = {\n    img_generated: 'data:image/jpeg;base64,generatedImageBase64Data',\n    metadata: {\n      processingTime: 5000,\n      modelVersion: 'v1.0',\n      timestamp: '2023-01-01T00:00:00Z'\n    }\n  };\n\n  describe('Basic Hook Functionality', () => {\n    it('should initialize with correct default state', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"isLoading\">{mutation.isLoading.toString()}</div>\n            <div data-testid=\"isSuccess\">{mutation.isSuccess.toString()}</div>\n            <div data-testid=\"isError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"isIdle\">{mutation.isIdle.toString()}</div>\n            <div data-testid=\"hasData\">{Boolean(mutation.data).toString()}</div>\n            <div data-testid=\"hasError\">{Boolean(mutation.error).toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      expect(screen.getByTestId('isLoading')).toHaveTextContent('false');\n      expect(screen.getByTestId('isSuccess')).toHaveTextContent('false');\n      expect(screen.getByTestId('isError')).toHaveTextContent('false');\n      expect(screen.getByTestId('isIdle')).toHaveTextContent('true');\n      expect(screen.getByTestId('hasData')).toHaveTextContent('false');\n      expect(screen.getByTestId('hasError')).toHaveTextContent('false');\n    });\n\n    it('should provide mutate and mutateAsync functions', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"hasMutate\">{typeof mutation.mutate === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasMutateAsync\">{typeof mutation.mutateAsync === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasReset\">{typeof mutation.reset === 'function' ? 'function' : 'not-function'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('hasMutate')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasMutateAsync')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasReset')).toHaveTextContent('function');\n    });\n  });\n\n  describe('Successful API Calls', () => {\n    it('should handle successful API response', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"data\">{mutation.data ? JSON.stringify(mutation.data) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const dataContent = screen.getByTestId('data').textContent;\n      const parsedData = JSON.parse(dataContent!);\n      expect(parsedData.img_generated).toBe(mockSuccessResponse.img_generated);\n      expect(parsedData.metadata).toEqual(mockSuccessResponse.metadata);\n    });\n\n    it('should make correct API request with proper payload', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          modelImage: mockVariables.modelImage,\n          apparelImages: mockVariables.apparelImages,\n        }),\n      });\n    });\n\n    it('should include metadata in request when provided', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const variablesWithMetadata: TryonMutationVariables = {\n        ...mockVariables,\n        options: {\n          metadata: { custom: 'data', userId: '123' }\n        }\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithMetadata);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      const [, requestInit] = mockFetch.mock.calls[0];\n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.metadata).toEqual({ custom: 'data', userId: '123' });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle HTTP error responses', async () => {\n      const errorResponse = {\n        error: 'Validation failed',\n        details: [{ field: 'modelImage', message: 'Invalid format' }],\n        code: 'VALIDATION_ERROR'\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => errorResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"error\">{mutation.error ? JSON.stringify(mutation.error) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      const errorContent = screen.getByTestId('error').textContent;\n      const parsedError = JSON.parse(errorContent!);\n      expect(parsedError.error).toBe('Validation failed');\n      expect(parsedError.details).toEqual(errorResponse.details);\n      expect(parsedError.status).toBe(400);\n      expect(parsedError.retryable).toBe(false);\n    });\n\n    it('should handle network errors', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorType\">{mutation.error ? typeof mutation.error : 'null'}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Network error');\n    });\n\n    it('should handle invalid API response format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ invalid: 'response' }), // Missing img_generated\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Invalid API response: missing img_generated field');\n    });\n  });\n\n  describe('Retry Logic', () => {\n    it('should retry on retryable errors with exponential backoff', async () => {\n      // First call fails with 500 error (retryable)\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => mockSuccessResponse,\n        });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3,\n          initialRetryDelay: 100\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      // Fast-forward through retry delays\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3);\n    });\n\n    it('should not retry on non-retryable errors', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => ({ error: 'Validation error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should respect maxRetries configuration', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 2,\n          initialRetryDelay: 50\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3); // 1 initial + 2 retries\n    });\n  });\n\n  describe('Timeout Handling', () => {\n    it('should handle request timeout', async () => {\n      const timeoutPromise = new Promise((_, reject) => {\n        setTimeout(() => reject(new Error('Request timeout')), 1000);\n      });\n\n      mockFetch.mockImplementationOnce(() => timeoutPromise);\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            ...mockVariables,\n            options: { timeout: 500 }\n          });\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(600);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n    });\n  });\n\n  describe('Lifecycle Callbacks', () => {\n    it('should call onSuccess callback', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onSuccess = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSuccess });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables,\n          startTime: expect.any(Number),\n          retryCount: 0\n        })\n      );\n    });\n\n    it('should call onError callback', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const onError = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onError, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(onError).toHaveBeenCalledWith(\n        expect.objectContaining({\n          error: expect.stringContaining('Network connection'),\n          retryable: true,\n          category: 'network',\n          code: 'NETWORK_ERROR',\n          severity: 'medium',\n          recoveryActions: expect.arrayContaining([\n            expect.objectContaining({\n              type: 'check_connection'\n            })\n          ])\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n\n    it('should call onMutate callback and use returned context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onMutate = jest.fn().mockReturnValue({ customData: 'test' });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onMutate });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onMutate).toHaveBeenCalledWith(mockVariables);\n    });\n\n    it('should call onSettled callback on both success and error', async () => {\n      const onSettled = jest.fn();\n\n      // Test success case\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSettled });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      const { unmount } = renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        null,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n\n      unmount();\n      onSettled.mockClear();\n\n      // Test error case\n      mockFetch.mockRejectedValueOnce(new Error('Test error'));\n\n      const TestComponentError = () => {\n        const mutation = useTryonMutation({ onSettled, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponentError />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 5000 });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        undefined,\n        expect.objectContaining({\n          error: expect.stringContaining('unexpected error'),\n          category: 'unknown',\n          code: 'UNKNOWN_ERROR',\n          severity: 'high',\n          retryable: true\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n  });\n\n  describe('Reset Functionality', () => {\n    it('should reset mutation state', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        const handleReset = () => {\n          mutation.reset();\n        };\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <button onClick={handleReset} data-testid=\"reset-button\">Reset</button>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      act(() => {\n        screen.getByTestId('reset-button').click();\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      });\n    });\n  });\n\n  describe('Configuration Options', () => {\n    it('should disable retry when enableRetry is false', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Image Processing Integration', () => {\n    // Mock File constructor\n    const createMockFile = (name: string, type: string, content: string = 'test-image-data'): File => {\n      const blob = new Blob([content], { type });\n      const file = new File([blob], name, { type });\n      \n      // Ensure File prototype chain is maintained in jsdom\n      Object.setPrototypeOf(file, File.prototype);\n      Object.defineProperty(file, 'constructor', { value: File });\n      \n      return file;\n    };\n\n    // Mock Canvas and Image for image processing\n    const mockCanvas = {\n      width: 0,\n      height: 0,\n      getContext: jest.fn(() => ({\n        drawImage: jest.fn(),\n        imageSmoothingEnabled: true,\n        imageSmoothingQuality: 'high',\n        fillStyle: '',\n        fillRect: jest.fn(),\n        getImageData: jest.fn(() => ({\n          data: new Uint8ClampedArray(4 * 100 * 100), // 100x100 RGBA data\n          width: 100,\n          height: 100\n        })),\n        putImageData: jest.fn()\n      })),\n      toDataURL: jest.fn(() => 'data:image/jpeg;base64,processed-image-data'),\n      toBlob: jest.fn((callback) => {\n        const blob = new Blob(['processed'], { type: 'image/jpeg' });\n        callback(blob);\n      })\n    };\n\n    beforeEach(() => {\n      global.HTMLCanvasElement.prototype.getContext = mockCanvas.getContext as any;\n      global.HTMLCanvasElement.prototype.toDataURL = mockCanvas.toDataURL as any;\n      global.HTMLCanvasElement.prototype.toBlob = mockCanvas.toBlob as any;\n      \n      // Mock Image constructor\n      global.Image = class MockImage {\n        onload: (() => void) | null = null;\n        onerror: (() => void) | null = null;\n        width = 1024;\n        height = 1536;\n        crossOrigin = '';\n        \n        set src(value: string) {\n          setTimeout(() => {\n            if (this.onload) this.onload();\n          }, 0);\n        }\n      } as any;\n\n      // Mock FileReader for file processing\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            this.result = 'data:image/jpeg;base64,processed-image-data';\n            if (this.onload) {\n              this.onload({ target: { result: this.result } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      // Mock document.createElement for canvas creation\n      const originalCreateElement = document.createElement;\n      document.createElement = jest.fn((tagName: string) => {\n        if (tagName === 'canvas') {\n          return {\n            width: 0,\n            height: 0,\n            getContext: mockCanvas.getContext,\n            toDataURL: mockCanvas.toDataURL,\n            toBlob: mockCanvas.toBlob\n          } as any;\n        }\n        return originalCreateElement.call(document, tagName);\n      });\n    });\n\n    it('should process File objects through image processing pipeline', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n      const mockApparelFile = createMockFile('apparel.png', 'image/png');\n\n      // Reset the mock before each test\n      mockProcessImageForTryon.mockClear();\n\n      const variablesWithFiles: TryonMutationVariablesWithFiles = {\n        modelImage: mockFile,\n        apparelImages: [mockApparelFile]\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false,\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024\n          }\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithFiles as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"context\">{mutation.context ? 'has-context' : 'no-context'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(screen.getByTestId('context')).toHaveTextContent('has-context');\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', expect.objectContaining({\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: expect.stringContaining('processed-image-data')\n      }));\n    });\n\n    it('should handle mixed File and base64 inputs', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n\n      const mixedVariables: TryonMutationVariablesWithFiles = {\n        modelImage: 'data:image/jpeg;base64,existing-base64-data',\n        apparelImages: [mockFile, 'data:image/png;base64,another-base64-image']\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mixedVariables as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should handle image processing errors gracefully', async () => {\n      // Mock FileReader to simulate file processing error\n      const originalFileReader = global.FileReader;\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            if (this.onerror) {\n              this.onerror({ target: { error: new Error('File reading failed') } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      const mockFile = createMockFile('invalid.txt', 'text/plain');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n\n      // Restore FileReader\n      global.FileReader = originalFileReader;\n    });\n\n    it('should pass processed variables to API with correct format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: [mockFile]\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const [url, requestInit] = mockFetch.mock.calls[0];\n      expect(url).toBe('/api/tryon');\n      \n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.modelImage).toMatch(/^data:image\\/jpeg;base64,/);\n      expect(requestBody.apparelImages).toHaveLength(1);\n      expect(requestBody.apparelImages[0]).toMatch(/^data:image\\/jpeg;base64,/);\n    });\n\n    it('should include image processing results in mutation context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n      let capturedContext: any = null;\n\n      const onSuccess = jest.fn((data, variables, context) => {\n        capturedContext = context;\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ \n          enableRetry: false,\n          onSuccess\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalled();\n      expect(capturedContext).toBeTruthy();\n      expect(capturedContext.imageProcessingResults).toBeTruthy();\n      expect(capturedContext.imageProcessingResults.totalProcessingTime).toBeGreaterThan(0);\n    });\n  });\n});"],"names":["jest","mock","processImageForTryon","mockProcessImageForTryon","ImageProcessingError","Error","constructor","message","ImageDimensionError","FileTypeNotSupportedError","FileTooLargeError","CompressionFailedError","classifyTryonError","fn","mockImplementation","error","includes","userMessage","technicalMessage","retryable","category","severity","recoveryActions","type","description","errorCode","logAndClassifyError","isErrorRetryable","mockReturnValue","getOptimisticUpdatesManager","startOptimisticUpdate","optimisticId","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","getCacheInvalidationManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","file","options","Promise","resolve","processedImage","originalSize","processedSize","compressionRatio","processingTime","dimensions","width","height","mockFetch","global","fetch","MockAbortController","signal","aborted","abort","AbortController","describe","queryClient","beforeEach","QueryClient","defaultOptions","queries","retry","gcTime","mutations","mockClear","clearAllTimers","useFakeTimers","afterEach","useRealTimers","clear","renderWithProvider","children","render","QueryClientProvider","client","mockVariables","modelImage","apparelImages","mockSuccessResponse","img_generated","metadata","modelVersion","timestamp","it","TestComponent","mutation","useTryonMutation","div","data-testid","status","isLoading","toString","isSuccess","isError","isIdle","Boolean","data","expect","screen","getByTestId","toHaveTextContent","mutate","mutateAsync","reset","mockResolvedValueOnce","ok","json","React","useEffect","JSON","stringify","waitFor","dataContent","textContent","parsedData","parse","toBe","toEqual","toHaveBeenCalledTimes","toHaveBeenCalledWith","method","headers","body","variablesWithMetadata","custom","userId","requestInit","calls","requestBody","errorResponse","details","field","code","statusText","timeout","errorContent","parsedError","mockRejectedValueOnce","enableRetry","invalid","maxRetries","initialRetryDelay","act","advanceTimersByTimeAsync","timeoutPromise","_","reject","setTimeout","mockImplementationOnce","onSuccess","objectContaining","variables","startTime","any","Number","retryCount","onError","stringContaining","arrayContaining","onMutate","customData","onSettled","unmount","TestComponentError","handleReset","button","onClick","click","createMockFile","name","content","blob","Blob","File","Object","setPrototypeOf","prototype","defineProperty","value","mockCanvas","getContext","drawImage","imageSmoothingEnabled","imageSmoothingQuality","fillStyle","fillRect","getImageData","Uint8ClampedArray","putImageData","toDataURL","toBlob","callback","HTMLCanvasElement","Image","MockImage","src","onload","onerror","crossOrigin","FileReader","MockFileReader","readAsDataURL","result","target","originalCreateElement","document","createElement","tagName","call","mockFile","mockApparelFile","variablesWithFiles","imageProcessing","targetWidth","targetHeight","maxSizeKB","context","mixedVariables","originalFileReader","url","toMatch","toHaveLength","capturedContext","toHaveBeenCalled","toBeTruthy","imageProcessingResults","totalProcessingTime","toBeGreaterThan"],"mappings":"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"}