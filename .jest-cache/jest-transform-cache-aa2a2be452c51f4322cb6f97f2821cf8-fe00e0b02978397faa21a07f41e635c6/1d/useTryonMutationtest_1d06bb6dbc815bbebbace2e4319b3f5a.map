{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/mutations/useTryonMutation.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport React from 'react';\nimport { render, screen, waitFor, act } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport type { \n  TryonMutationVariables,\n  TryonMutationVariablesWithFiles, \n  TryonMutationResponse,\n  TryonMutationError,\n  UseTryonMutationConfig \n} from '../../../src/business-layer/types/tryon.types';\n\n// Mock image processing utilities\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn().mockResolvedValue({\n    processedImage: 'data:image/jpeg;base64,processed-image-data',\n    originalSize: 1024,\n    processedSize: 512,\n    compressionRatio: 0.5,\n    processingTime: 100,\n    dimensions: { width: 1024, height: 1536 }\n  }),\n  ImageProcessingError: class ImageProcessingError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  ImageDimensionError: class ImageDimensionError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock image utilities\njest.mock('../../../src/utils/image', () => ({\n  FileTypeNotSupportedError: class FileTypeNotSupportedError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  FileTooLargeError: class FileTooLargeError extends Error {\n    constructor(message: string) { super(message); }\n  },\n  CompressionFailedError: class CompressionFailedError extends Error {\n    constructor(message: string) { super(message); }\n  }\n}));\n\n// Mock error handling utilities\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn().mockReturnValue({\n    userMessage: 'Test error',\n    technicalMessage: 'Technical error details',\n    retryable: true,\n    category: 'unknown',\n    severity: 'medium',\n    recoveryActions: [],\n    errorCode: 'TEST_ERROR'\n  }),\n  logAndClassifyError: jest.fn().mockReturnValue({\n    userMessage: 'Test error',\n    technicalMessage: 'Technical error details',\n    retryable: true,\n    category: 'unknown',\n    severity: 'medium',\n    recoveryActions: [],\n    errorCode: 'TEST_ERROR'\n  }),\n  isErrorRetryable: jest.fn().mockReturnValue(false)\n}));\n\n// Mock optimistic updates\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: jest.fn().mockReturnValue({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn().mockImplementation(() => ({\n    startOptimisticUpdate: jest.fn().mockReturnValue({ optimisticId: 'test-id' }),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }))\n}));\n\n// Mock cache invalidation\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  getCacheInvalidationManager: jest.fn(),\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\n// Mock fetch globally\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch;\n\n// Mock abort controller for timeout tests\nclass MockAbortController {\n  signal = { aborted: false };\n  abort = jest.fn(() => {\n    this.signal.aborted = true;\n  });\n}\nglobal.AbortController = MockAbortController as any;\n\ndescribe('useTryonMutation', () => {\n  let queryClient: QueryClient;\n\n  beforeEach(() => {\n    queryClient = new QueryClient({\n      defaultOptions: {\n        queries: { retry: false, gcTime: 0 },\n        mutations: { retry: false },\n      },\n    });\n    mockFetch.mockClear();\n    jest.clearAllTimers();\n    jest.useFakeTimers();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n    queryClient.clear();\n  });\n\n  const renderWithProvider = (children: React.ReactNode) => {\n    return render(\n      <QueryClientProvider client={queryClient}>\n        {children}\n      </QueryClientProvider>\n    );\n  };\n\n  const mockVariables: TryonMutationVariables = {\n    modelImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD',\n    apparelImages: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD']\n  };\n\n  const mockSuccessResponse: TryonMutationResponse = {\n    img_generated: 'data:image/jpeg;base64,generatedImageBase64Data',\n    metadata: {\n      processingTime: 5000,\n      modelVersion: 'v1.0',\n      timestamp: '2023-01-01T00:00:00Z'\n    }\n  };\n\n  describe('Basic Hook Functionality', () => {\n    it('should initialize with correct default state', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"isLoading\">{mutation.isLoading.toString()}</div>\n            <div data-testid=\"isSuccess\">{mutation.isSuccess.toString()}</div>\n            <div data-testid=\"isError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"isIdle\">{mutation.isIdle.toString()}</div>\n            <div data-testid=\"hasData\">{Boolean(mutation.data).toString()}</div>\n            <div data-testid=\"hasError\">{Boolean(mutation.error).toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      expect(screen.getByTestId('isLoading')).toHaveTextContent('false');\n      expect(screen.getByTestId('isSuccess')).toHaveTextContent('false');\n      expect(screen.getByTestId('isError')).toHaveTextContent('false');\n      expect(screen.getByTestId('isIdle')).toHaveTextContent('true');\n      expect(screen.getByTestId('hasData')).toHaveTextContent('false');\n      expect(screen.getByTestId('hasError')).toHaveTextContent('false');\n    });\n\n    it('should provide mutate and mutateAsync functions', () => {\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        return (\n          <div>\n            <div data-testid=\"hasMutate\">{typeof mutation.mutate === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasMutateAsync\">{typeof mutation.mutateAsync === 'function' ? 'function' : 'not-function'}</div>\n            <div data-testid=\"hasReset\">{typeof mutation.reset === 'function' ? 'function' : 'not-function'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      expect(screen.getByTestId('hasMutate')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasMutateAsync')).toHaveTextContent('function');\n      expect(screen.getByTestId('hasReset')).toHaveTextContent('function');\n    });\n  });\n\n  describe('Successful API Calls', () => {\n    it('should handle successful API response', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"data\">{mutation.data ? JSON.stringify(mutation.data) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const dataContent = screen.getByTestId('data').textContent;\n      const parsedData = JSON.parse(dataContent!);\n      expect(parsedData.img_generated).toBe(mockSuccessResponse.img_generated);\n      expect(parsedData.metadata).toEqual(mockSuccessResponse.metadata);\n    });\n\n    it('should make correct API request with proper payload', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          modelImage: mockVariables.modelImage,\n          apparelImages: mockVariables.apparelImages,\n        }),\n      });\n    });\n\n    it('should include metadata in request when provided', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const variablesWithMetadata: TryonMutationVariables = {\n        ...mockVariables,\n        options: {\n          metadata: { custom: 'data', userId: '123' }\n        }\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithMetadata);\n        }, []);\n\n        return <div data-testid=\"test\">test</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledTimes(1);\n      });\n\n      const [, requestInit] = mockFetch.mock.calls[0];\n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.metadata).toEqual({ custom: 'data', userId: '123' });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle HTTP error responses', async () => {\n      const errorResponse = {\n        error: 'Validation failed',\n        details: [{ field: 'modelImage', message: 'Invalid format' }],\n        code: 'VALIDATION_ERROR'\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => errorResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"error\">{mutation.error ? JSON.stringify(mutation.error) : 'null'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      const errorContent = screen.getByTestId('error').textContent;\n      const parsedError = JSON.parse(errorContent!);\n      expect(parsedError.error).toBe('Validation failed');\n      expect(parsedError.details).toEqual(errorResponse.details);\n      expect(parsedError.status).toBe(400);\n      expect(parsedError.retryable).toBe(false);\n    });\n\n    it('should handle network errors', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorType\">{mutation.error ? typeof mutation.error : 'null'}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Network error');\n    });\n\n    it('should handle invalid API response format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ invalid: 'response' }), // Missing img_generated\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n            <div data-testid=\"errorMessage\">{mutation.error instanceof Error ? mutation.error.message : 'not-error'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n      expect(screen.getByTestId('errorMessage')).toHaveTextContent('Invalid API response: missing img_generated field');\n    });\n  });\n\n  describe('Retry Logic', () => {\n    it('should retry on retryable errors with exponential backoff', async () => {\n      // First call fails with 500 error (retryable)\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: false,\n          status: 500,\n          statusText: 'Internal Server Error',\n          json: async () => ({ error: 'Server error' }),\n        })\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => mockSuccessResponse,\n        });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3,\n          initialRetryDelay: 100\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      // Fast-forward through retry delays\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3);\n    });\n\n    it('should not retry on non-retryable errors', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        json: async () => ({ error: 'Validation error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 3\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should respect maxRetries configuration', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: true,\n          maxRetries: 2,\n          initialRetryDelay: 50\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(1000);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(3); // 1 initial + 2 retries\n    });\n  });\n\n  describe('Timeout Handling', () => {\n    it('should handle request timeout', async () => {\n      const timeoutPromise = new Promise((_, reject) => {\n        setTimeout(() => reject(new Error('Request timeout')), 1000);\n      });\n\n      mockFetch.mockImplementationOnce(() => timeoutPromise);\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            ...mockVariables,\n            options: { timeout: 500 }\n          });\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await act(async () => {\n        await jest.advanceTimersByTimeAsync(600);\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n    });\n  });\n\n  describe('Lifecycle Callbacks', () => {\n    it('should call onSuccess callback', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onSuccess = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSuccess });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables,\n          startTime: expect.any(Number),\n          retryCount: 0\n        })\n      );\n    });\n\n    it('should call onError callback', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const onError = jest.fn();\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onError, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(onError).toHaveBeenCalledWith(\n        expect.objectContaining({\n          error: expect.stringContaining('Network connection'),\n          retryable: true,\n          category: 'network',\n          code: 'NETWORK_ERROR',\n          severity: 'medium',\n          recoveryActions: expect.arrayContaining([\n            expect.objectContaining({\n              type: 'check_connection'\n            })\n          ])\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n\n    it('should call onMutate callback and use returned context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const onMutate = jest.fn().mockReturnValue({ customData: 'test' });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onMutate });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onMutate).toHaveBeenCalledWith(mockVariables);\n    });\n\n    it('should call onSettled callback on both success and error', async () => {\n      const onSettled = jest.fn();\n\n      // Test success case\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ onSettled });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      const { unmount } = renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        mockSuccessResponse,\n        null,\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n\n      unmount();\n      onSettled.mockClear();\n\n      // Test error case\n      mockFetch.mockRejectedValueOnce(new Error('Test error'));\n\n      const TestComponentError = () => {\n        const mutation = useTryonMutation({ onSettled, enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponentError />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 5000 });\n\n      expect(onSettled).toHaveBeenCalledWith(\n        undefined,\n        expect.objectContaining({\n          error: expect.stringContaining('unexpected error'),\n          category: 'unknown',\n          code: 'UNKNOWN_ERROR',\n          severity: 'high',\n          retryable: true\n        }),\n        mockVariables,\n        expect.objectContaining({\n          variables: mockVariables\n        })\n      );\n    });\n  });\n\n  describe('Reset Functionality', () => {\n    it('should reset mutation state', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation();\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        const handleReset = () => {\n          mutation.reset();\n        };\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <button onClick={handleReset} data-testid=\"reset-button\">Reset</button>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      act(() => {\n        screen.getByTestId('reset-button').click();\n      });\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('idle');\n      });\n    });\n  });\n\n  describe('Configuration Options', () => {\n    it('should disable retry when enableRetry is false', async () => {\n      mockFetch.mockResolvedValue({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        json: async () => ({ error: 'Server error' }),\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(mockVariables);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Image Processing Integration', () => {\n    // Mock File constructor\n    const createMockFile = (name: string, type: string, content: string = 'test-image-data'): File => {\n      const blob = new Blob([content], { type });\n      return new File([blob], name, { type });\n    };\n\n    // Mock Canvas and Image for image processing\n    const mockCanvas = {\n      width: 0,\n      height: 0,\n      getContext: jest.fn(() => ({\n        drawImage: jest.fn(),\n        imageSmoothingEnabled: true,\n        imageSmoothingQuality: 'high',\n        fillStyle: '',\n        fillRect: jest.fn(),\n        getImageData: jest.fn(() => ({\n          data: new Uint8ClampedArray(4 * 100 * 100), // 100x100 RGBA data\n          width: 100,\n          height: 100\n        })),\n        putImageData: jest.fn()\n      })),\n      toDataURL: jest.fn(() => 'data:image/jpeg;base64,processed-image-data'),\n      toBlob: jest.fn((callback) => {\n        const blob = new Blob(['processed'], { type: 'image/jpeg' });\n        callback(blob);\n      })\n    };\n\n    beforeEach(() => {\n      global.HTMLCanvasElement.prototype.getContext = mockCanvas.getContext as any;\n      global.HTMLCanvasElement.prototype.toDataURL = mockCanvas.toDataURL as any;\n      global.HTMLCanvasElement.prototype.toBlob = mockCanvas.toBlob as any;\n      \n      // Mock Image constructor\n      global.Image = class MockImage {\n        onload: (() => void) | null = null;\n        onerror: (() => void) | null = null;\n        width = 1024;\n        height = 1536;\n        crossOrigin = '';\n        \n        set src(value: string) {\n          setTimeout(() => {\n            if (this.onload) this.onload();\n          }, 0);\n        }\n      } as any;\n\n      // Mock FileReader for file processing\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            this.result = 'data:image/jpeg;base64,processed-image-data';\n            if (this.onload) {\n              this.onload({ target: { result: this.result } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      // Mock document.createElement for canvas creation\n      const originalCreateElement = document.createElement;\n      document.createElement = jest.fn((tagName: string) => {\n        if (tagName === 'canvas') {\n          return {\n            width: 0,\n            height: 0,\n            getContext: mockCanvas.getContext,\n            toDataURL: mockCanvas.toDataURL,\n            toBlob: mockCanvas.toBlob\n          } as any;\n        }\n        return originalCreateElement.call(document, tagName);\n      });\n    });\n\n    it('should process File objects through image processing pipeline', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n      const mockApparelFile = createMockFile('apparel.png', 'image/png');\n\n      const variablesWithFiles: TryonMutationVariablesWithFiles = {\n        modelImage: mockFile,\n        apparelImages: [mockApparelFile]\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({\n          enableRetry: false,\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024\n          }\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate(variablesWithFiles as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"context\">{mutation.context ? 'has-context' : 'no-context'}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(screen.getByTestId('context')).toHaveTextContent('has-context');\n      expect(mockFetch).toHaveBeenCalledWith('/api/tryon', expect.objectContaining({\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: expect.stringContaining('processed-image-data')\n      }));\n    });\n\n    it('should handle mixed File and base64 inputs', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test-image.jpg', 'image/jpeg');\n\n      const mixedVariables: TryonMutationVariablesWithFiles = {\n        modelImage: 'data:image/jpeg;base64,existing-base64-data',\n        apparelImages: [mockFile, 'data:image/png;base64,another-base64-image']\n      };\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate(mixedVariables as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      }, { timeout: 5000 });\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should handle image processing errors gracefully', async () => {\n      // Mock FileReader to simulate file processing error\n      const originalFileReader = global.FileReader;\n      global.FileReader = class MockFileReader {\n        onload: ((event: any) => void) | null = null;\n        onerror: ((event: any) => void) | null = null;\n        result: string | null = null;\n        \n        readAsDataURL(file: File) {\n          setTimeout(() => {\n            if (this.onerror) {\n              this.onerror({ target: { error: new Error('File reading failed') } } as any);\n            }\n          }, 0);\n        }\n      } as any;\n\n      const mockFile = createMockFile('invalid.txt', 'text/plain');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return (\n          <div>\n            <div data-testid=\"status\">{mutation.status}</div>\n            <div data-testid=\"hasError\">{mutation.isError.toString()}</div>\n          </div>\n        );\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('error');\n      }, { timeout: 3000 });\n\n      expect(screen.getByTestId('hasError')).toHaveTextContent('true');\n\n      // Restore FileReader\n      global.FileReader = originalFileReader;\n    });\n\n    it('should pass processed variables to API with correct format', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ enableRetry: false });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: [mockFile]\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      const [url, requestInit] = mockFetch.mock.calls[0];\n      expect(url).toBe('/api/tryon');\n      \n      const requestBody = JSON.parse(requestInit.body);\n      expect(requestBody.modelImage).toMatch(/^data:image\\/jpeg;base64,/);\n      expect(requestBody.apparelImages).toHaveLength(1);\n      expect(requestBody.apparelImages[0]).toMatch(/^data:image\\/jpeg;base64,/);\n    });\n\n    it('should include image processing results in mutation context', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockSuccessResponse,\n      });\n\n      const mockFile = createMockFile('test.jpg', 'image/jpeg');\n      let capturedContext: any = null;\n\n      const onSuccess = jest.fn((data, variables, context) => {\n        capturedContext = context;\n      });\n\n      const TestComponent = () => {\n        const mutation = useTryonMutation({ \n          enableRetry: false,\n          onSuccess\n        });\n        \n        React.useEffect(() => {\n          mutation.mutate({\n            modelImage: mockFile,\n            apparelImages: []\n          } as any);\n        }, []);\n\n        return <div data-testid=\"status\">{mutation.status}</div>;\n      };\n\n      renderWithProvider(<TestComponent />);\n\n      await waitFor(() => {\n        expect(screen.getByTestId('status')).toHaveTextContent('success');\n      });\n\n      expect(onSuccess).toHaveBeenCalled();\n      expect(capturedContext).toBeTruthy();\n      expect(capturedContext.imageProcessingResults).toBeTruthy();\n      expect(capturedContext.imageProcessingResults.totalProcessingTime).toBeGreaterThan(0);\n    });\n  });\n});"],"names":["jest","mock","processImageForTryon","fn","mockResolvedValue","processedImage","originalSize","processedSize","compressionRatio","processingTime","dimensions","width","height","ImageProcessingError","Error","constructor","message","ImageDimensionError","FileTypeNotSupportedError","FileTooLargeError","CompressionFailedError","classifyTryonError","mockReturnValue","userMessage","technicalMessage","retryable","category","severity","recoveryActions","errorCode","logAndClassifyError","isErrorRetryable","getOptimisticUpdatesManager","startOptimisticUpdate","optimisticId","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","mockImplementation","getCacheInvalidationManager","invalidateCacheAfterMutation","undefined","mockFetch","global","fetch","MockAbortController","signal","aborted","abort","AbortController","describe","queryClient","beforeEach","QueryClient","defaultOptions","queries","retry","gcTime","mutations","mockClear","clearAllTimers","useFakeTimers","afterEach","useRealTimers","clear","renderWithProvider","children","render","QueryClientProvider","client","mockVariables","modelImage","apparelImages","mockSuccessResponse","img_generated","metadata","modelVersion","timestamp","it","TestComponent","mutation","useTryonMutation","div","data-testid","status","isLoading","toString","isSuccess","isError","isIdle","Boolean","data","error","expect","screen","getByTestId","toHaveTextContent","mutate","mutateAsync","reset","mockResolvedValueOnce","ok","json","React","useEffect","JSON","stringify","waitFor","dataContent","textContent","parsedData","parse","toBe","toEqual","toHaveBeenCalledTimes","toHaveBeenCalledWith","method","headers","body","variablesWithMetadata","options","custom","userId","requestInit","calls","requestBody","errorResponse","details","field","code","statusText","timeout","errorContent","parsedError","mockRejectedValueOnce","enableRetry","invalid","maxRetries","initialRetryDelay","act","advanceTimersByTimeAsync","timeoutPromise","Promise","_","reject","setTimeout","mockImplementationOnce","onSuccess","objectContaining","variables","startTime","any","Number","retryCount","onError","stringContaining","arrayContaining","type","onMutate","customData","onSettled","unmount","TestComponentError","handleReset","button","onClick","click","createMockFile","name","content","blob","Blob","File","mockCanvas","getContext","drawImage","imageSmoothingEnabled","imageSmoothingQuality","fillStyle","fillRect","getImageData","Uint8ClampedArray","putImageData","toDataURL","toBlob","callback","HTMLCanvasElement","prototype","Image","MockImage","src","value","onload","onerror","crossOrigin","FileReader","MockFileReader","readAsDataURL","file","result","target","originalCreateElement","document","createElement","tagName","call","mockFile","mockApparelFile","variablesWithFiles","imageProcessing","targetWidth","targetHeight","maxSizeKB","context","mixedVariables","originalFileReader","url","toMatch","toHaveLength","capturedContext","toHaveBeenCalled","toBeTruthy","imageProcessingResults","totalProcessingTime","toBeGreaterThan"],"mappings":"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"}