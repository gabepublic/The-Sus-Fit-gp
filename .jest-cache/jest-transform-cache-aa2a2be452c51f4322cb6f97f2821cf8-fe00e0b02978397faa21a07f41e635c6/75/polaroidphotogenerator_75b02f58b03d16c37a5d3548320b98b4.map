{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/src/components/ui/polaroid-photo-generator.tsx"],"sourcesContent":["\"use client\"\n\nimport { cn } from \"@/lib/utils\"\nimport { useState, useEffect } from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport Image from \"next/image\"\n\ninterface PolaroidPhotoGeneratorProps {\n    className?: string\n    onGenerationStart?: () => void\n    onGenerationComplete?: (imageUrl: string) => void\n    onClose?: () => void\n    onRetry?: () => void\n    isGenerating?: boolean\n    mockImageUrl?: string\n    generatedImage?: string     // base-64 PNG returned from backend\n    isLoading?: boolean         // when backend call is in flight\n    hasError?: boolean          // when there's an error during generation\n}\n\nexport function PolaroidPhotoGenerator({\n    className,\n    onGenerationStart,\n    onGenerationComplete,\n    onClose,\n    onRetry,\n    isGenerating = false,\n    mockImageUrl,\n    generatedImage,\n    isLoading = false,\n    hasError = false\n}: PolaroidPhotoGeneratorProps) {\n    const [imgLoaded, setImgLoaded] = useState(false)\n    const [showButtons, setShowButtons] = useState(false)\n    const [progress, setProgress] = useState(0)\n\n    // Debug logging\n    console.log('PolaroidPhotoGenerator props:', {\n        generatedImage: generatedImage ? `base64 (${generatedImage.length} chars)` : 'null',\n        isGenerating,\n        isLoading\n    })\n\n    // Handle generatedImage changes - show immediately when available\n    useEffect(() => {\n        if (generatedImage != null) {\n            console.log('Generated image available, showing immediately')\n            setShowButtons(true)\n            setImgLoaded(false) // Will be set to true when image loads\n            \n            // Call onGenerationComplete immediately without delay\n            if (onGenerationComplete) {\n                const fullImageUrl = `data:image/png;base64,${generatedImage}`\n                onGenerationComplete(fullImageUrl)\n            }\n        } else {\n            setShowButtons(false)\n        }\n    }, [generatedImage, onGenerationComplete])\n\n    // Handle generation start and progress\n    useEffect(() => {\n        if (isGenerating && onGenerationStart) {\n            onGenerationStart()\n            setProgress(0)\n            \n            // Start progress animation\n            const interval = setInterval(() => {\n                setProgress(prev => {\n                    if (prev >= 100) {\n                        clearInterval(interval)\n                        return 100\n                    }\n                    return prev + 2\n                })\n            }, 60) // Update every 60ms for smooth animation\n            \n            return () => clearInterval(interval)\n        } else {\n            setProgress(0)\n        }\n    }, [isGenerating, onGenerationStart])\n\n    const handleRetry = () => {\n        setImgLoaded(false)\n        setShowButtons(false)\n        if (onRetry) {\n            onRetry()\n        }\n    }\n\n    const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\n        const img = e.currentTarget\n        console.log('Image loaded successfully')\n        console.log('Image dimensions:', {\n            naturalWidth: img.naturalWidth,\n            naturalHeight: img.naturalHeight,\n            clientWidth: img.clientWidth,\n            clientHeight: img.clientHeight\n        })\n        setImgLoaded(true)\n    }\n\n        return (\n        <div className={cn(\"relative flex flex-col items-center\", className)} data-testid=\"polaroid-generator\">\n            {/* Polaroid Container */}\n            <div className=\"relative bg-white p-6 w-[475px] h-[550px] flex flex-col shadow-lg rounded-sm\">\n                {/* Photo Area */}\n                <div className=\"relative w-full h-[400px] overflow-hidden rounded-sm bg-gray-100\">\n                    {/* Loading State with Image, Spinner, and Progress Bar (for isGenerating prop) */}\n                    {isGenerating && !generatedImage && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <Image\n                                src={mockImageUrl || '/images/demo/WillShalom.jpg'}\n                                alt=\"Generated try-on preview\"\n                                fill\n                                className=\"object-contain rounded-sm opacity-50\"\n                                aria-busy=\"true\"\n                                unoptimized\n                            />\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20\">\n                                <div className=\"text-center\">\n                                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-susfit-pink-500)] mx-auto mb-4\"></div>\n                                    <div className=\"text-gray-600 font-mono\">Generating...</div>\n                                    \n                                    {/* Progress Bar */}\n                                    <div className=\"mt-4 w-48 h-2 bg-gray-300 rounded-full overflow-hidden\">\n                                        <div \n                                            className=\"h-full bg-gradient-to-r from-[var(--color-susfit-pink-500)] to-[var(--color-susfit-teal-500)] transition-all duration-300 ease-out\"\n                                            style={{ width: `${progress}%` }}\n                                            data-testid=\"progress-bar\"\n                                        ></div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div className=\"absolute inset-0 animate-pulse bg-gray-200 rounded-sm\"></div>\n                        </div>\n                    )}\n\n                    {/* Loading State with Image and Shimmer (for isLoading prop) */}\n                    {isLoading && !generatedImage && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <Image\n                                src={mockImageUrl || '/images/demo/WillShalom.jpg'}\n                                alt=\"Generated try-on preview\"\n                                fill\n                                className=\"object-contain rounded-sm opacity-50\"\n                                aria-busy=\"true\"\n                                unoptimized\n                            />\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20\">\n                                <div className=\"text-center\">\n                                    <div className=\"animate-pulse rounded-full h-12 w-12 bg-[var(--color-susfit-pink-500)] mx-auto mb-4\"></div>\n                                    <div className=\"text-gray-600 font-mono\">Loading...</div>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Generated Image with Fade-in Effect */}\n                    {generatedImage && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <Image\n                                src={`data:image/png;base64,${generatedImage}`}\n                                alt=\"Generated try-on preview\"\n                                fill\n                                className={`object-contain rounded-sm transition-opacity duration-300 ${imgLoaded ? 'opacity-100' : 'opacity-0'}`}\n                                onLoad={handleImageLoad}\n                                onError={(e) => {\n                                    console.error('Image failed to load:', e)\n                                    console.error('Generated image length:', generatedImage?.length || 0)\n                                }}\n                                unoptimized\n                                data-test=\"generated-image\"\n                            />\n                        </div>\n                    )}\n\n                    {/* Default Image when no other state is active and no mockImageUrl provided */}\n                    {!generatedImage && !isGenerating && !isLoading && mockImageUrl === undefined && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <Image\n                                src=\"/images/demo/WillShalom.jpg\"\n                                alt=\"Generated try-on preview\"\n                                fill\n                                className=\"object-contain rounded-sm\"\n                                unoptimized\n                            />\n                        </div>\n                    )}\n\n                    {/* Text placeholder when mockImageUrl is explicitly provided */}\n                    {!generatedImage && !isGenerating && !isLoading && mockImageUrl !== undefined && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <div className=\"text-gray-400 font-mono text-center\">\n                                Ready to generate\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Error State */}\n                    {hasError && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <div className=\"text-red-500 font-mono text-center\">\n                                Failed to generate image\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Polaroid Bottom Border */}\n                <div className=\"h-[70px] bg-white flex items-center justify-center\">\n                    <div className=\"text-lg text-gray-600 font-mono\">\n                        {isGenerating && !generatedImage && !isLoading && \"Processing...\"}\n                        {isLoading && !isGenerating && !generatedImage && \"Loading...\"}\n                        {generatedImage && \"Complete!\"}\n                        {!isGenerating && !isLoading && !generatedImage && \"Ready to generate\"}\n                    </div>\n                </div>\n            </div>\n\n            {/* Buttons */}\n            {showButtons && (\n                <div className=\"mt-4 flex gap-2 justify-center\">\n                    <Button\n                        onClick={handleRetry}\n                        className=\"bg-[var(--color-susfit-pink-500)] hover:bg-[var(--color-susfit-pink-800)] text-black border-2 border-black font-bold text-sm px-3 py-1 transition-all duration-200\"\n                        aria-label=\"Retry generation\"\n                    >\n                        Retry\n                    </Button>\n                    <Button\n                        onClick={onClose}\n                        className=\"bg-[var(--color-susfit-teal-500)] hover:bg-[var(--color-susfit-teal-800)] text-white border-2 border-black font-bold text-sm px-3 py-1 transition-all duration-200\"\n                        aria-label=\"Close polaroid\"\n                    >\n                        Close\n                    </Button>\n                </div>\n            )}\n\n            {/* Additional retry button */}\n            {generatedImage && (\n                <div className=\"mt-4 text-center\" aria-live=\"polite\">\n                    <button \n                        onClick={onRetry} \n                        className=\"text-sm underline text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded px-2 py-1 transition-colors duration-200\"\n                        aria-label=\"Try another outfit\"\n                    >\n                        Try another outfit\n                    </button>\n                </div>\n            )}\n\n            {/* Debug Info */}\n            {process.env.NODE_ENV === 'development' && (\n                <div className=\"mt-2 text-xs text-gray-500 font-mono text-center\">\n                    Loading: {isLoading ? '✅' : '❌'} | Generating: {isGenerating ? '✅' : '❌'} | Generated: {generatedImage ? '✅' : '❌'}\n                </div>\n            )}\n        </div>\n    )\n}\n"],"names":["PolaroidPhotoGenerator","className","onGenerationStart","onGenerationComplete","onClose","onRetry","isGenerating","mockImageUrl","generatedImage","isLoading","hasError","imgLoaded","setImgLoaded","useState","showButtons","setShowButtons","progress","setProgress","console","log","length","useEffect","fullImageUrl","interval","setInterval","prev","clearInterval","handleRetry","handleImageLoad","e","img","currentTarget","naturalWidth","naturalHeight","clientWidth","clientHeight","div","cn","data-testid","Image","src","alt","fill","aria-busy","unoptimized","style","width","onLoad","onError","error","data-test","undefined","Button","onClick","aria-label","aria-live","button","process","env","NODE_ENV"],"mappings":"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"}