{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/utils/imageProcessing.test.ts"],"sourcesContent":["// Image Processing Integration Tests\n// Tests for image processing utilities and integration with try-on mutations\n\n// Mock the image processing module before any imports\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn(),\n  ImageProcessingError: jest.fn(),\n  ImageDimensionError: jest.fn()\n}));\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport {\n  createTestQueryClient,\n  createQueryClientWrapper,\n  mockTryonAPI,\n  mockTryonResponse,\n  mockConsole\n} from '../../../src/business-layer/tests/testUtils';\nimport * as imageProcessingModule from '../../../src/business-layer/utils/imageProcessing';\n\n// Mock other dependencies\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: () => ({\n    startOptimisticUpdate: jest.fn(() => ({ optimisticId: 'test-id', rollbackFunctions: [] })),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn()\n  }),\n  OptimisticUpdatesManager: jest.fn()\n}));\n\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  logAndClassifyError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  isErrorRetryable: jest.fn(() => false)\n}));\n\ndescribe('Image Processing Integration', () => {\n  let queryClient: ReturnType<typeof createTestQueryClient>;\n  let consoleRef: ReturnType<typeof mockConsole>;\n  const mockProcessImageForTryon = imageProcessingModule.processImageForTryon as jest.MockedFunction<typeof imageProcessingModule.processImageForTryon>;\n\n  beforeEach(() => {\n    queryClient = createTestQueryClient();\n    consoleRef = mockConsole();\n    jest.clearAllMocks();\n    mockTryonAPI(mockTryonResponse);\n  });\n\n  afterEach(() => {\n    queryClient.clear();\n    consoleRef.restore();\n  });\n\n  describe('File Processing', () => {\n    it('should process File objects successfully', async () => {\n      const mockProcessingResult = {\n        originalSize: 2048576,\n        processedSize: 1048576,\n        compressionRatio: 0.5,\n        processingTime: 123,\n        processedImage: 'data:image/jpeg;base64,processed-image',\n        metadata: {\n          originalDimensions: { width: 1920, height: 1080 },\n          processedDimensions: { width: 1024, height: 1536 },\n          format: 'jpeg',\n          quality: 0.9\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: {\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024,\n            compressionQuality: 0.9\n          }\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(2); // model + apparel image\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(\n        mockFile,\n        expect.objectContaining({\n          targetWidth: 1024,\n          targetHeight: 1536,\n          maxSizeKB: 1024,\n          quality: 0.9\n        })\n      );\n    });\n\n    it('should handle mixed File and base64 inputs', async () => {\n      const mockProcessingResult = {\n        originalSize: 1536000,\n        processedSize: 768000,\n        compressionRatio: 0.5,\n        processingTime: 89,\n        processedImage: 'data:image/jpeg;base64,processed-file',\n        metadata: {\n          originalDimensions: { width: 1200, height: 800 },\n          processedDimensions: { width: 1024, height: 1536 },\n          format: 'jpeg',\n          quality: 0.9\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const base64Image = 'data:image/jpeg;base64,existing-base64';\n      \n      const variables = {\n        modelImage: base64Image, // Already base64\n        apparelImages: [mockFile, base64Image], // Mixed types\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      // Should only process the File object, not the base64 string\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(1);\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(mockFile, undefined);\n    });\n\n    it('should skip processing when all inputs are base64', async () => {\n      const base64Model = 'data:image/jpeg;base64,model-image';\n      const base64Apparel = 'data:image/jpeg;base64,apparel-image';\n      \n      const variables = {\n        modelImage: base64Model,\n        apparelImages: [base64Apparel],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      // Should not call image processing for base64 inputs\n      expect(mockProcessImageForTryon).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Processing Configuration', () => {\n    it('should pass image processing options correctly', async () => {\n      mockProcessImageForTryon.mockResolvedValue({\n        originalSize: 2048576,\n        processedSize: 1048576,\n        compressionRatio: 0.5,\n        processingTime: 123,\n        processedImage: 'data:image/jpeg;base64,processed',\n        metadata: {}\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const imageProcessingConfig = {\n        targetWidth: 800,\n        targetHeight: 1200,\n        maxSizeKB: 512,\n        compressionQuality: 0.8,\n        preserveAspectRatio: true\n      };\n\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {\n          imageProcessing: imageProcessingConfig\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(\n        mockFile,\n        expect.objectContaining({\n          targetWidth: 800,\n          targetHeight: 1200,\n          maxSizeKB: 512,\n          quality: 0.8,\n          preserveAspectRatio: true\n        })\n      );\n    });\n\n    it('should use default processing options when not specified', async () => {\n      mockProcessImageForTryon.mockResolvedValue({\n        originalSize: 2048576,\n        processedSize: 1048576,\n        compressionRatio: 0.5,\n        processingTime: 123,\n        processedImage: 'data:image/jpeg;base64,processed',\n        metadata: {}\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledWith(mockFile, undefined);\n    });\n  });\n\n  describe('Processing Errors', () => {\n    it('should handle image processing errors gracefully', async () => {\n      const processingError = new Error('Image processing failed');\n      mockProcessImageForTryon.mockRejectedValue(processingError);\n\n      const mockFile = new File(['invalid content'], 'test.txt', { type: 'text/plain' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n      expect(mockProcessImageForTryon).toHaveBeenCalled();\n    });\n\n    it('should handle specific image processing error types', async () => {\n      const dimensionError = new Error('Image dimensions too large');\n      dimensionError.name = 'ImageDimensionError';\n      mockProcessImageForTryon.mockRejectedValue(dimensionError);\n\n      const mockFile = new File(['mock content'], 'huge-image.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      expect(result.current.error).toBeTruthy();\n    });\n\n    it('should fallback to original variables when processing fails', async () => {\n      const processingError = new Error('Processing failed');\n      mockProcessImageForTryon.mockRejectedValue(processingError);\n\n      const onMutate = jest.fn().mockResolvedValue({ fallback: true });\n      const config = { onMutate };\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isError).toBe(true);\n      });\n\n      // onMutate should still be called with processed variables attempt\n      expect(onMutate).toHaveBeenCalled();\n    });\n  });\n\n  describe('Performance Tests', () => {\n    it('should handle multiple large images efficiently', async () => {\n      const mockLargeProcessingResult = {\n        originalSize: 10485760, // 10MB\n        processedSize: 1048576, // 1MB\n        compressionRatio: 0.1,\n        processingTime: 500,\n        processedImage: 'data:image/jpeg;base64,large-processed',\n        metadata: {\n          originalDimensions: { width: 4000, height: 3000 },\n          processedDimensions: { width: 1024, height: 1536 },\n          format: 'jpeg',\n          quality: 0.9\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockLargeProcessingResult);\n\n      const largeFile = new File(\n        [new ArrayBuffer(10 * 1024 * 1024)], // 10MB\n        'large-image.jpg',\n        { type: 'image/jpeg' }\n      );\n\n      const variables = {\n        modelImage: largeFile,\n        apparelImages: [largeFile, largeFile, largeFile], // Multiple large files\n        options: {\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024,\n            compressionQuality: 0.8\n          }\n        }\n      };\n\n      const startTime = Date.now();\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const processingTime = Date.now() - startTime;\n\n      expect(mockProcessImageForTryon).toHaveBeenCalledTimes(4); // model + 3 apparel\n      expect(processingTime).toBeLessThan(5000); // Should complete within 5 seconds\n      expect(result.current.context?.imageProcessingResults).toBeDefined();\n      expect(result.current.context?.imageProcessingResults?.totalProcessingTime).toBeDefined();\n    });\n\n    it('should track processing times accurately', async () => {\n      const processingTimes = [100, 200, 150, 300];\n      let callIndex = 0;\n\n      mockProcessImageForTryon.mockImplementation(() => {\n        const processingTime = processingTimes[callIndex++];\n        return Promise.resolve({\n          originalSize: 2048576,\n          processedSize: 1048576,\n          compressionRatio: 0.5,\n          processingTime,\n          processedImage: `data:image/jpeg;base64,processed-${callIndex}`,\n          metadata: {}\n        });\n      });\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile, mockFile, mockFile],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const imageResults = result.current.context?.imageProcessingResults;\n      expect(imageResults).toBeDefined();\n      expect(imageResults?.modelImageResult?.processingTime).toBe(100);\n      expect(imageResults?.apparelImageResults).toHaveLength(3);\n      expect(imageResults?.apparelImageResults?.[0].processingTime).toBe(200);\n      expect(imageResults?.apparelImageResults?.[1].processingTime).toBe(150);\n      expect(imageResults?.apparelImageResults?.[2].processingTime).toBe(300);\n      expect(imageResults?.totalProcessingTime).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Context Preservation', () => {\n    it('should preserve image processing results in mutation context', async () => {\n      const mockProcessingResult = {\n        originalSize: 2048576,\n        processedSize: 1048576,\n        compressionRatio: 0.5,\n        processingTime: 123,\n        processedImage: 'data:image/jpeg;base64,processed-image',\n        metadata: {\n          originalDimensions: { width: 1920, height: 1080 },\n          processedDimensions: { width: 1024, height: 1536 },\n          format: 'jpeg',\n          quality: 0.9\n        }\n      };\n\n      mockProcessImageForTryon.mockResolvedValue(mockProcessingResult);\n\n      const mockFile = new File(['mock content'], 'test.jpg', { type: 'image/jpeg' });\n      const variables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: {}\n      };\n\n      const onSuccess = jest.fn();\n      const config = { onSuccess };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      await act(async () => {\n        result.current.mutate(variables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      expect(onSuccess).toHaveBeenCalledWith(\n        mockTryonResponse,\n        expect.objectContaining({\n          modelImage: 'data:image/jpeg;base64,processed-image',\n          apparelImages: ['data:image/jpeg;base64,processed-image']\n        }),\n        expect.objectContaining({\n          imageProcessingResults: expect.objectContaining({\n            modelImageResult: mockProcessingResult,\n            apparelImageResults: [mockProcessingResult],\n            totalProcessingTime: expect.any(Number)\n          })\n        })\n      );\n    });\n  });\n});"],"names":["jest","mock","processImageForTryon","fn","ImageProcessingError","ImageDimensionError","getOptimisticUpdatesManager","startOptimisticUpdate","optimisticId","rollbackFunctions","completeOptimisticUpdate","rollbackOptimisticUpdate","OptimisticUpdatesManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","classifyTryonError","userMessage","technicalMessage","errorCode","retryable","category","severity","recoveryActions","logAndClassifyError","isErrorRetryable","describe","queryClient","consoleRef","mockProcessImageForTryon","imageProcessingModule","beforeEach","createTestQueryClient","mockConsole","clearAllMocks","mockTryonAPI","mockTryonResponse","afterEach","clear","restore","it","mockProcessingResult","originalSize","processedSize","compressionRatio","processingTime","processedImage","metadata","originalDimensions","width","height","processedDimensions","format","quality","mockFile","File","type","variables","modelImage","apparelImages","options","imageProcessing","targetWidth","targetHeight","maxSizeKB","compressionQuality","result","renderHook","useTryonMutation","wrapper","createQueryClientWrapper","act","current","mutate","waitFor","expect","isSuccess","toBe","toHaveBeenCalledTimes","toHaveBeenCalledWith","objectContaining","base64Image","base64Model","base64Apparel","not","toHaveBeenCalled","imageProcessingConfig","preserveAspectRatio","processingError","Error","mockRejectedValue","isError","error","toBeTruthy","dimensionError","name","onMutate","fallback","config","mockLargeProcessingResult","largeFile","ArrayBuffer","startTime","Date","now","toBeLessThan","context","imageProcessingResults","toBeDefined","totalProcessingTime","processingTimes","callIndex","mockImplementation","Promise","resolve","imageResults","modelImageResult","apparelImageResults","toHaveLength","toBeGreaterThan","onSuccess","any","Number"],"mappings":"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"}