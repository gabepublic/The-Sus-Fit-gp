{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/src/app/api/tryon/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { ZodError } from 'zod';\nimport { TryonSchema } from './schema';\nimport { generateTryOn } from '../../../lib/openaiClient';\n\n// TODO: Implement try-on functionality\n// - ✅ Add request validation (subtask 3.2) - COMPLETED\n// - ✅ Add request parsing & payload validation (subtask 3.3) - COMPLETED\n// - ✅ Add image processing logic (subtask 3.4) - COMPLETED\n// - ✅ Add error handling (subtask 3.5) - COMPLETED\n\n// Helper function to create CORS headers\nfunction createCorsHeaders(origin: string) {\n  return {\n    'Access-Control-Allow-Origin': origin,\n    'Access-Control-Allow-Methods': 'POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type'\n  };\n}\n\n// Handle OPTIONS preflight requests\nexport async function OPTIONS(request: NextRequest): Promise<NextResponse> {\n  const origin = request.headers.get('origin') ?? process.env.NEXT_PUBLIC_BASE_URL ?? '';\n  return new NextResponse(null, {\n    status: 200,\n    headers: createCorsHeaders(origin)\n  });\n}\n\nexport async function POST(request: NextRequest): Promise<NextResponse> {\n  const origin = request.headers.get('origin') ?? process.env.NEXT_PUBLIC_BASE_URL ?? '';\n  const corsHeaders = createCorsHeaders(origin);\n\n  try {\n    // Parse request body\n    const body = await request.json();\n    \n    // Validate payload against schema\n    const { modelImage, apparelImages } = TryonSchema.parse(body);\n    \n    // Generate try-on image using OpenAI\n    const img_generated = await generateTryOn({ modelImage, apparelImages });\n    \n    // Return generated image with CORS headers\n    return NextResponse.json({ \n      img_generated \n    }, { \n      status: 200,\n      headers: corsHeaders\n    });\n    \n  } catch (error) {\n    // Handle Zod validation errors\n    if (error instanceof ZodError) {\n      return NextResponse.json({ \n        error: 'Validation failed',\n        details: error.errors.map(err => ({\n          field: err.path.join('.'),\n          message: err.message\n        }))\n      }, { \n        status: 400,\n        headers: corsHeaders\n      });\n    }\n    \n    // Handle generateTryOn errors and other internal errors\n    console.error('Try-on API error:', error);\n    const errorMessage = process.env.NODE_ENV === 'development' \n      ? (error instanceof Error ? error.message : 'Unknown error occurred')\n      : 'Internal Server Error';\n    \n    return NextResponse.json({ \n      error: errorMessage\n    }, { \n      status: 500,\n      headers: corsHeaders\n    });\n  }\n} "],"names":["OPTIONS","POST","createCorsHeaders","origin","request","headers","get","process","env","NEXT_PUBLIC_BASE_URL","NextResponse","status","corsHeaders","body","json","modelImage","apparelImages","TryonSchema","parse","img_generated","generateTryOn","error","ZodError","details","errors","map","err","field","path","join","message","console","errorMessage","NODE_ENV","Error"],"mappings":";;;;;;;;;;;IAqBsBA,OAAO;eAAPA;;IAQAC,IAAI;eAAJA;;;wBA7BoB;qBACjB;wBACG;8BACE;AAE9B,uCAAuC;AACvC,uDAAuD;AACvD,yEAAyE;AACzE,2DAA2D;AAC3D,mDAAmD;AAEnD,yCAAyC;AACzC,SAASC,kBAAkBC,MAAc;IACvC,OAAO;QACL,+BAA+BA;QAC/B,gCAAgC;QAChC,gCAAgC;IAClC;AACF;AAGO,eAAeH,QAAQI,OAAoB;IAChD,MAAMD,SAASC,QAAQC,OAAO,CAACC,GAAG,CAAC,aAAaC,QAAQC,GAAG,CAACC,oBAAoB,IAAI;IACpF,OAAO,IAAIC,oBAAY,CAAC,MAAM;QAC5BC,QAAQ;QACRN,SAASH,kBAAkBC;IAC7B;AACF;AAEO,eAAeF,KAAKG,OAAoB;IAC7C,MAAMD,SAASC,QAAQC,OAAO,CAACC,GAAG,CAAC,aAAaC,QAAQC,GAAG,CAACC,oBAAoB,IAAI;IACpF,MAAMG,cAAcV,kBAAkBC;IAEtC,IAAI;QACF,qBAAqB;QACrB,MAAMU,OAAO,MAAMT,QAAQU,IAAI;QAE/B,kCAAkC;QAClC,MAAM,EAAEC,UAAU,EAAEC,aAAa,EAAE,GAAGC,mBAAW,CAACC,KAAK,CAACL;QAExD,qCAAqC;QACrC,MAAMM,gBAAgB,MAAMC,IAAAA,2BAAa,EAAC;YAAEL;YAAYC;QAAc;QAEtE,2CAA2C;QAC3C,OAAON,oBAAY,CAACI,IAAI,CAAC;YACvBK;QACF,GAAG;YACDR,QAAQ;YACRN,SAASO;QACX;IAEF,EAAE,OAAOS,OAAO;QACd,+BAA+B;QAC/B,IAAIA,iBAAiBC,aAAQ,EAAE;YAC7B,OAAOZ,oBAAY,CAACI,IAAI,CAAC;gBACvBO,OAAO;gBACPE,SAASF,MAAMG,MAAM,CAACC,GAAG,CAACC,CAAAA,MAAQ,CAAA;wBAChCC,OAAOD,IAAIE,IAAI,CAACC,IAAI,CAAC;wBACrBC,SAASJ,IAAII,OAAO;oBACtB,CAAA;YACF,GAAG;gBACDnB,QAAQ;gBACRN,SAASO;YACX;QACF;QAEA,wDAAwD;QACxDmB,QAAQV,KAAK,CAAC,qBAAqBA;QACnC,MAAMW,eAAezB,QAAQC,GAAG,CAACyB,QAAQ,KAAK,gBACzCZ,iBAAiBa,QAAQb,MAAMS,OAAO,GAAG,2BAC1C;QAEJ,OAAOpB,oBAAY,CAACI,IAAI,CAAC;YACvBO,OAAOW;QACT,GAAG;YACDrB,QAAQ;YACRN,SAASO;QACX;IACF;AACF"}