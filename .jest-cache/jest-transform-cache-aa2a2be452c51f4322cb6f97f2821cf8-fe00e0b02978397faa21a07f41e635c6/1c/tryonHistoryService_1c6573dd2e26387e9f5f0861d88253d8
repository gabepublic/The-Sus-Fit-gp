deb93430e3cfc42fee0eab7917d7cad8
// Try-On History Storage Service
// Implements persistent storage for try-on history using localStorage with compression
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    LocalStorageTryonHistoryService: function() {
        return LocalStorageTryonHistoryService;
    },
    defaultHistoryService: function() {
        return defaultHistoryService;
    }
});
const _imageProcessing = require("../utils/imageProcessing");
/**
 * Default configuration for history storage
 */ const DEFAULT_CONFIG = {
    storageType: 'localStorage',
    maxEntries: 50,
    maxEntrySizeKB: 2048,
    compressImages: true,
    compressionQuality: 0.8,
    autoCleanup: true,
    encryptionKey: ''
};
/**
 * Storage keys for localStorage
 */ const STORAGE_KEYS = {
    ENTRIES: 'susfit_tryon_history_entries',
    CONFIG: 'susfit_tryon_history_config',
    METADATA: 'susfit_tryon_history_metadata'
};
/**
 * Generate a unique ID for history entries
 */ function generateHistoryId() {
    return `tryon_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
}
/**
 * Calculate the size of a history entry in KB
 */ function calculateEntrySize(entry) {
    const json = JSON.stringify(entry);
    return new Blob([
        json
    ]).size / 1024;
}
/**
 * Compress images in a history entry
 */ async function compressHistoryEntry(entry, config) {
    if (!config.compressImages) {
        return entry;
    }
    try {
        const maxSizeKB = config.maxEntrySizeKB / (2 + entry.apparelImages.length);
        const quality = config.compressionQuality;
        // Compress generated image
        const compressedGenerated = await (0, _imageProcessing.compressBase64)(entry.generatedImage, maxSizeKB);
        // Compress model image
        const compressedModel = await (0, _imageProcessing.compressBase64)(entry.modelImage, maxSizeKB);
        // Compress apparel images
        const compressedApparel = await Promise.all(entry.apparelImages.map((img)=>(0, _imageProcessing.compressBase64)(img, maxSizeKB)));
        return {
            ...entry,
            generatedImage: compressedGenerated,
            modelImage: compressedModel,
            apparelImages: compressedApparel,
            metadata: {
                ...entry.metadata,
                imageProcessingResults: {
                    ...entry.metadata?.imageProcessingResults,
                    totalProcessingTime: entry.metadata?.imageProcessingResults?.totalProcessingTime || 0,
                    finalImageSizes: {
                        modelImageSize: (0, _imageProcessing.getBase64Size)(compressedModel),
                        apparelImageSizes: compressedApparel.map((img)=>(0, _imageProcessing.getBase64Size)(img))
                    }
                }
            }
        };
    } catch (error) {
        if (error instanceof _imageProcessing.CompressionFailedError) {
            console.warn('Failed to compress history entry images, using original', error);
            return entry;
        }
        throw error;
    }
}
class LocalStorageTryonHistoryService {
    constructor(config = {}){
        this.isInitialized = false;
        this.config = {
            ...DEFAULT_CONFIG,
            ...config
        };
    // Don't initialize immediately - defer until first use
    }
    /**
   * Initialize localStorage storage (called lazily on first use)
   */ initializeStorage() {
        if (this.isInitialized) {
            return;
        }
        try {
            // Check if localStorage is available (client-side only)
            if (typeof window === 'undefined' || !window.localStorage) {
                throw new Error('localStorage is not available');
            }
            // Initialize config if not exists
            if (!localStorage.getItem(STORAGE_KEYS.CONFIG)) {
                localStorage.setItem(STORAGE_KEYS.CONFIG, JSON.stringify(this.config));
            }
            // Initialize entries array if not exists
            if (!localStorage.getItem(STORAGE_KEYS.ENTRIES)) {
                localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify([]));
            }
            // Initialize metadata if not exists
            if (!localStorage.getItem(STORAGE_KEYS.METADATA)) {
                const metadata = {
                    version: '1.0.0',
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(STORAGE_KEYS.METADATA, JSON.stringify(metadata));
            }
            this.isInitialized = true;
        } catch (error) {
            console.error('Failed to initialize history storage:', error);
            throw new Error('History storage initialization failed');
        }
    }
    /**
   * Ensure storage is initialized before use
   */ ensureInitialized() {
        if (!this.isInitialized) {
            this.initializeStorage();
        }
    }
    /**
   * Get all stored entries from localStorage
   */ getStoredEntries() {
        this.ensureInitialized();
        try {
            const entriesJson = localStorage.getItem(STORAGE_KEYS.ENTRIES);
            return entriesJson ? JSON.parse(entriesJson) : [];
        } catch (error) {
            console.error('Failed to parse stored entries:', error);
            return [];
        }
    }
    /**
   * Save entries to localStorage
   */ saveEntries(entries) {
        this.ensureInitialized();
        try {
            localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify(entries));
            // Update metadata
            const metadata = JSON.parse(localStorage.getItem(STORAGE_KEYS.METADATA) || '{}');
            metadata.lastUpdated = new Date().toISOString();
            localStorage.setItem(STORAGE_KEYS.METADATA, JSON.stringify(metadata));
        } catch (error) {
            console.error('Failed to save entries to localStorage:', error);
            throw new Error('Failed to save history entries');
        }
    }
    /**
   * Perform cleanup if needed
   */ performCleanupIfNeeded(entries) {
        if (!this.config.autoCleanup || entries.length <= this.config.maxEntries) {
            return entries;
        }
        // Sort by timestamp and keep only the most recent entries
        const sorted = [
            ...entries
        ].sort((a, b)=>new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());
        return sorted.slice(0, this.config.maxEntries);
    }
    /**
   * Filter and sort entries based on query options
   */ filterAndSortEntries(entries, options = {}) {
        let filtered = [
            ...entries
        ];
        // Apply favorites filter
        if (options.favoritesOnly) {
            filtered = filtered.filter((entry)=>entry.isFavorite);
        }
        // Apply date range filter
        if (options.dateRange) {
            const startDate = new Date(options.dateRange.startDate);
            const endDate = new Date(options.dateRange.endDate);
            filtered = filtered.filter((entry)=>{
                const entryDate = new Date(entry.timestamp);
                return entryDate >= startDate && entryDate <= endDate;
            });
        }
        // Apply search term filter
        if (options.searchTerm) {
            const searchTerm = options.searchTerm.toLowerCase();
            filtered = filtered.filter((entry)=>entry.tags?.some((tag)=>tag.toLowerCase().includes(searchTerm)) || entry.notes?.toLowerCase().includes(searchTerm));
        }
        // Apply sorting
        const sortBy = options.sortBy || 'timestamp';
        const sortDirection = options.sortDirection || 'desc';
        filtered.sort((a, b)=>{
            let aValue, bValue;
            switch(sortBy){
                case 'timestamp':
                    aValue = new Date(a.timestamp);
                    bValue = new Date(b.timestamp);
                    break;
                case 'processingTime':
                    aValue = a.processingTime || 0;
                    bValue = b.processingTime || 0;
                    break;
                case 'isFavorite':
                    aValue = a.isFavorite ? 1 : 0;
                    bValue = b.isFavorite ? 1 : 0;
                    break;
                default:
                    aValue = new Date(a.timestamp).getTime();
                    bValue = new Date(b.timestamp).getTime();
            }
            if (sortDirection === 'asc') {
                return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
            } else {
                return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
            }
        });
        return filtered;
    }
    /**
   * Add a new history entry
   */ async addEntry(options) {
        const entry = {
            id: generateHistoryId(),
            timestamp: new Date().toISOString(),
            generatedImage: options.generatedImage,
            modelImage: options.modelImage,
            apparelImages: options.apparelImages,
            processingTime: options.processingTime,
            metadata: options.metadata,
            tags: options.tags || [],
            isFavorite: options.isFavorite || false,
            notes: options.notes || ''
        };
        // Compress entry if enabled
        const compressedEntry = await compressHistoryEntry(entry, this.config);
        // Check entry size
        const entrySize = calculateEntrySize(compressedEntry);
        if (entrySize > this.config.maxEntrySizeKB) {
            throw new Error(`History entry too large: ${entrySize.toFixed(2)}KB exceeds limit of ${this.config.maxEntrySizeKB}KB`);
        }
        // Get current entries and add the new one
        let entries = this.getStoredEntries();
        entries.push(compressedEntry);
        // Perform cleanup if needed
        entries = this.performCleanupIfNeeded(entries);
        // Save updated entries
        this.saveEntries(entries);
        return compressedEntry;
    }
    /**
   * Get history entries with filtering and pagination
   */ async getEntries(options = {}) {
        const allEntries = this.getStoredEntries();
        const filteredEntries = this.filterAndSortEntries(allEntries, options);
        // Apply pagination
        const page = options.page || 0;
        const pageSize = options.pageSize || 20;
        const startIndex = page * pageSize;
        const endIndex = startIndex + pageSize;
        const paginatedEntries = filteredEntries.slice(startIndex, endIndex);
        return {
            entries: paginatedEntries,
            totalCount: filteredEntries.length,
            currentPage: page,
            pageSize,
            hasMore: endIndex < filteredEntries.length,
            lastUpdated: new Date().toISOString()
        };
    }
    /**
   * Get a specific history entry by ID
   */ async getEntry(id) {
        const entries = this.getStoredEntries();
        return entries.find((entry)=>entry.id === id) || null;
    }
    /**
   * Update an existing history entry
   */ async updateEntry(id, updates) {
        const entries = this.getStoredEntries();
        const entryIndex = entries.findIndex((entry)=>entry.id === id);
        if (entryIndex === -1) {
            throw new Error(`History entry with ID ${id} not found`);
        }
        // Apply updates
        const updatedEntry = {
            ...entries[entryIndex],
            ...updates,
            // Preserve ID and timestamp, update only if explicitly provided
            id: entries[entryIndex].id,
            timestamp: updates.timestamp || entries[entryIndex].timestamp
        };
        entries[entryIndex] = updatedEntry;
        this.saveEntries(entries);
        return updatedEntry;
    }
    /**
   * Delete a history entry
   */ async deleteEntry(id) {
        const entries = this.getStoredEntries();
        const filteredEntries = entries.filter((entry)=>entry.id !== id);
        if (filteredEntries.length === entries.length) {
            return false; // Entry not found
        }
        this.saveEntries(filteredEntries);
        return true;
    }
    /**
   * Clear all history entries
   */ async clearAll() {
        this.ensureInitialized();
        try {
            localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify([]));
            return true;
        } catch (error) {
            console.error('Failed to clear history:', error);
            return false;
        }
    }
    /**
   * Get storage statistics
   */ async getStorageStats() {
        const entries = this.getStoredEntries();
        let totalSizeKB = 0;
        entries.forEach((entry)=>{
            totalSizeKB += calculateEntrySize(entry);
        });
        const timestamps = entries.map((entry)=>entry.timestamp).sort();
        return {
            totalEntries: entries.length,
            totalSizeKB,
            oldestEntry: timestamps[0],
            newestEntry: timestamps[timestamps.length - 1]
        };
    }
    /**
   * Export history data
   */ async exportHistory() {
        return this.getStoredEntries();
    }
    /**
   * Import history data
   */ async importHistory(entries) {
        try {
            // Validate entries
            const validEntries = entries.filter((entry)=>entry.id && entry.generatedImage && entry.modelImage && entry.apparelImages);
            // Get existing entries and merge with imports
            const existingEntries = this.getStoredEntries();
            const existingIds = new Set(existingEntries.map((entry)=>entry.id));
            // Only import entries that don't already exist
            const newEntries = validEntries.filter((entry)=>!existingIds.has(entry.id));
            if (newEntries.length === 0) {
                return 0;
            }
            // Merge and save
            const mergedEntries = [
                ...existingEntries,
                ...newEntries
            ];
            const cleanedEntries = this.performCleanupIfNeeded(mergedEntries);
            this.saveEntries(cleanedEntries);
            return newEntries.length;
        } catch (error) {
            console.error('Failed to import history:', error);
            throw new Error('History import failed');
        }
    }
    /**
   * Update service configuration
   */ updateConfig(newConfig) {
        this.config = {
            ...this.config,
            ...newConfig
        };
        this.ensureInitialized();
        try {
            localStorage.setItem(STORAGE_KEYS.CONFIG, JSON.stringify(this.config));
        } catch (error) {
            console.error('Failed to save config:', error);
        }
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const defaultHistoryService = new LocalStorageTryonHistoryService();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy93aWxsc3RyZWV0ZXIvV2Vic3Rvcm1Qcm9qZWN0cy92aWJlLWNvZGluZy90aG9zZS1wZW9wbGUvVGhlLVN1cy1GaXQtZ3Avc3JjL2J1c2luZXNzLWxheWVyL3NlcnZpY2VzL3RyeW9uSGlzdG9yeVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVHJ5LU9uIEhpc3RvcnkgU3RvcmFnZSBTZXJ2aWNlXG4vLyBJbXBsZW1lbnRzIHBlcnNpc3RlbnQgc3RvcmFnZSBmb3IgdHJ5LW9uIGhpc3RvcnkgdXNpbmcgbG9jYWxTdG9yYWdlIHdpdGggY29tcHJlc3Npb25cblxuaW1wb3J0IHsgXG4gIGNvbXByZXNzQmFzZTY0LCBcbiAgZ2V0QmFzZTY0U2l6ZSwgXG4gIENvbXByZXNzaW9uRmFpbGVkRXJyb3IgXG59IGZyb20gJy4uL3V0aWxzL2ltYWdlUHJvY2Vzc2luZyc7XG5pbXBvcnQgdHlwZSB7XG4gIFRyeW9uSGlzdG9yeUVudHJ5LFxuICBUcnlvbkhpc3RvcnlDb2xsZWN0aW9uLFxuICBUcnlvbkhpc3RvcnlRdWVyeU9wdGlvbnMsXG4gIENyZWF0ZVRyeW9uSGlzdG9yeUVudHJ5T3B0aW9ucyxcbiAgVHJ5b25IaXN0b3J5U2VydmljZSxcbiAgVHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZ1xufSBmcm9tICcuLi90eXBlcy9oaXN0b3J5LnR5cGVzJztcblxuLyoqXG4gKiBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gZm9yIGhpc3Rvcnkgc3RvcmFnZVxuICovXG5jb25zdCBERUZBVUxUX0NPTkZJRzogUmVxdWlyZWQ8VHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZz4gPSB7XG4gIHN0b3JhZ2VUeXBlOiAnbG9jYWxTdG9yYWdlJyxcbiAgbWF4RW50cmllczogNTAsXG4gIG1heEVudHJ5U2l6ZUtCOiAyMDQ4LCAvLyAyTUIgcGVyIGVudHJ5XG4gIGNvbXByZXNzSW1hZ2VzOiB0cnVlLFxuICBjb21wcmVzc2lvblF1YWxpdHk6IDAuOCxcbiAgYXV0b0NsZWFudXA6IHRydWUsXG4gIGVuY3J5cHRpb25LZXk6ICcnXG59O1xuXG4vKipcbiAqIFN0b3JhZ2Uga2V5cyBmb3IgbG9jYWxTdG9yYWdlXG4gKi9cbmNvbnN0IFNUT1JBR0VfS0VZUyA9IHtcbiAgRU5UUklFUzogJ3N1c2ZpdF90cnlvbl9oaXN0b3J5X2VudHJpZXMnLFxuICBDT05GSUc6ICdzdXNmaXRfdHJ5b25faGlzdG9yeV9jb25maWcnLFxuICBNRVRBREFUQTogJ3N1c2ZpdF90cnlvbl9oaXN0b3J5X21ldGFkYXRhJ1xufSBhcyBjb25zdDtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHVuaXF1ZSBJRCBmb3IgaGlzdG9yeSBlbnRyaWVzXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSGlzdG9yeUlkKCk6IHN0cmluZyB7XG4gIHJldHVybiBgdHJ5b25fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSB0aGUgc2l6ZSBvZiBhIGhpc3RvcnkgZW50cnkgaW4gS0JcbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlRW50cnlTaXplKGVudHJ5OiBUcnlvbkhpc3RvcnlFbnRyeSk6IG51bWJlciB7XG4gIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShlbnRyeSk7XG4gIHJldHVybiBuZXcgQmxvYihbanNvbl0pLnNpemUgLyAxMDI0O1xufVxuXG4vKipcbiAqIENvbXByZXNzIGltYWdlcyBpbiBhIGhpc3RvcnkgZW50cnlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY29tcHJlc3NIaXN0b3J5RW50cnkoXG4gIGVudHJ5OiBUcnlvbkhpc3RvcnlFbnRyeSwgXG4gIGNvbmZpZzogVHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZ1xuKTogUHJvbWlzZTxUcnlvbkhpc3RvcnlFbnRyeT4ge1xuICBpZiAoIWNvbmZpZy5jb21wcmVzc0ltYWdlcykge1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgbWF4U2l6ZUtCID0gY29uZmlnLm1heEVudHJ5U2l6ZUtCISAvICgyICsgZW50cnkuYXBwYXJlbEltYWdlcy5sZW5ndGgpO1xuICAgIGNvbnN0IHF1YWxpdHkgPSBjb25maWcuY29tcHJlc3Npb25RdWFsaXR5ITtcblxuICAgIC8vIENvbXByZXNzIGdlbmVyYXRlZCBpbWFnZVxuICAgIGNvbnN0IGNvbXByZXNzZWRHZW5lcmF0ZWQgPSBhd2FpdCBjb21wcmVzc0Jhc2U2NChcbiAgICAgIGVudHJ5LmdlbmVyYXRlZEltYWdlLCBcbiAgICAgIG1heFNpemVLQlxuICAgICk7XG5cbiAgICAvLyBDb21wcmVzcyBtb2RlbCBpbWFnZVxuICAgIGNvbnN0IGNvbXByZXNzZWRNb2RlbCA9IGF3YWl0IGNvbXByZXNzQmFzZTY0KFxuICAgICAgZW50cnkubW9kZWxJbWFnZSwgXG4gICAgICBtYXhTaXplS0JcbiAgICApO1xuXG4gICAgLy8gQ29tcHJlc3MgYXBwYXJlbCBpbWFnZXNcbiAgICBjb25zdCBjb21wcmVzc2VkQXBwYXJlbCA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgZW50cnkuYXBwYXJlbEltYWdlcy5tYXAoaW1nID0+IGNvbXByZXNzQmFzZTY0KGltZywgbWF4U2l6ZUtCKSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmVudHJ5LFxuICAgICAgZ2VuZXJhdGVkSW1hZ2U6IGNvbXByZXNzZWRHZW5lcmF0ZWQsXG4gICAgICBtb2RlbEltYWdlOiBjb21wcmVzc2VkTW9kZWwsXG4gICAgICBhcHBhcmVsSW1hZ2VzOiBjb21wcmVzc2VkQXBwYXJlbCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLmVudHJ5Lm1ldGFkYXRhLFxuICAgICAgICBpbWFnZVByb2Nlc3NpbmdSZXN1bHRzOiB7XG4gICAgICAgICAgLi4uZW50cnkubWV0YWRhdGE/LmltYWdlUHJvY2Vzc2luZ1Jlc3VsdHMsXG4gICAgICAgICAgdG90YWxQcm9jZXNzaW5nVGltZTogZW50cnkubWV0YWRhdGE/LmltYWdlUHJvY2Vzc2luZ1Jlc3VsdHM/LnRvdGFsUHJvY2Vzc2luZ1RpbWUgfHwgMCxcbiAgICAgICAgICBmaW5hbEltYWdlU2l6ZXM6IHtcbiAgICAgICAgICAgIG1vZGVsSW1hZ2VTaXplOiBnZXRCYXNlNjRTaXplKGNvbXByZXNzZWRNb2RlbCksXG4gICAgICAgICAgICBhcHBhcmVsSW1hZ2VTaXplczogY29tcHJlc3NlZEFwcGFyZWwubWFwKGltZyA9PiBnZXRCYXNlNjRTaXplKGltZykpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDb21wcmVzc2lvbkZhaWxlZEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBjb21wcmVzcyBoaXN0b3J5IGVudHJ5IGltYWdlcywgdXNpbmcgb3JpZ2luYWwnLCBlcnJvcik7XG4gICAgICByZXR1cm4gZW50cnk7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogbG9jYWxTdG9yYWdlLWJhc2VkIFRyeS1PbiBIaXN0b3J5IFNlcnZpY2UgaW1wbGVtZW50YXRpb25cbiAqL1xuZXhwb3J0IGNsYXNzIExvY2FsU3RvcmFnZVRyeW9uSGlzdG9yeVNlcnZpY2UgaW1wbGVtZW50cyBUcnlvbkhpc3RvcnlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjb25maWc6IFJlcXVpcmVkPFRyeW9uSGlzdG9yeVN0b3JhZ2VDb25maWc+O1xuICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFBhcnRpYWw8VHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZz4gPSB7fSkge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi5ERUZBVUxUX0NPTkZJRywgLi4uY29uZmlnIH07XG4gICAgLy8gRG9uJ3QgaW5pdGlhbGl6ZSBpbW1lZGlhdGVseSAtIGRlZmVyIHVudGlsIGZpcnN0IHVzZVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgbG9jYWxTdG9yYWdlIHN0b3JhZ2UgKGNhbGxlZCBsYXppbHkgb24gZmlyc3QgdXNlKVxuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplU3RvcmFnZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIGxvY2FsU3RvcmFnZSBpcyBhdmFpbGFibGUgKGNsaWVudC1zaWRlIG9ubHkpXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdsb2NhbFN0b3JhZ2UgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsaXplIGNvbmZpZyBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5DT05GSUcpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5DT05GSUcsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZmlnKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluaXRpYWxpemUgZW50cmllcyBhcnJheSBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5FTlRSSUVTKSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuRU5UUklFUywgSlNPTi5zdHJpbmdpZnkoW10pKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGl6ZSBtZXRhZGF0YSBpZiBub3QgZXhpc3RzXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSkpIHtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH07XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5NRVRBREFUQSwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEpKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgaGlzdG9yeSBzdG9yYWdlOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeSBzdG9yYWdlIGluaXRpYWxpemF0aW9uIGZhaWxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgc3RvcmFnZSBpcyBpbml0aWFsaXplZCBiZWZvcmUgdXNlXG4gICAqL1xuICBwcml2YXRlIGVuc3VyZUluaXRpYWxpemVkKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICB0aGlzLmluaXRpYWxpemVTdG9yYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgc3RvcmVkIGVudHJpZXMgZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICovXG4gIHByaXZhdGUgZ2V0U3RvcmVkRW50cmllcygpOiBUcnlvbkhpc3RvcnlFbnRyeVtdIHtcbiAgICB0aGlzLmVuc3VyZUluaXRpYWxpemVkKCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVudHJpZXNKc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlTLkVOVFJJRVMpO1xuICAgICAgcmV0dXJuIGVudHJpZXNKc29uID8gSlNPTi5wYXJzZShlbnRyaWVzSnNvbikgOiBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBhcnNlIHN0b3JlZCBlbnRyaWVzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2F2ZSBlbnRyaWVzIHRvIGxvY2FsU3RvcmFnZVxuICAgKi9cbiAgcHJpdmF0ZSBzYXZlRW50cmllcyhlbnRyaWVzOiBUcnlvbkhpc3RvcnlFbnRyeVtdKTogdm9pZCB7XG4gICAgdGhpcy5lbnN1cmVJbml0aWFsaXplZCgpO1xuICAgIHRyeSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuRU5UUklFUywgSlNPTi5zdHJpbmdpZnkoZW50cmllcykpO1xuICAgICAgXG4gICAgICAvLyBVcGRhdGUgbWV0YWRhdGFcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWVMuTUVUQURBVEEpIHx8ICd7fScpO1xuICAgICAgbWV0YWRhdGEubGFzdFVwZGF0ZWQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuTUVUQURBVEEsIEpTT04uc3RyaW5naWZ5KG1ldGFkYXRhKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGVudHJpZXMgdG8gbG9jYWxTdG9yYWdlOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNhdmUgaGlzdG9yeSBlbnRyaWVzJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gY2xlYW51cCBpZiBuZWVkZWRcbiAgICovXG4gIHByaXZhdGUgcGVyZm9ybUNsZWFudXBJZk5lZWRlZChlbnRyaWVzOiBUcnlvbkhpc3RvcnlFbnRyeVtdKTogVHJ5b25IaXN0b3J5RW50cnlbXSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hdXRvQ2xlYW51cCB8fCBlbnRyaWVzLmxlbmd0aCA8PSB0aGlzLmNvbmZpZy5tYXhFbnRyaWVzKSB7XG4gICAgICByZXR1cm4gZW50cmllcztcbiAgICB9XG5cbiAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBhbmQga2VlcCBvbmx5IHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzXG4gICAgY29uc3Qgc29ydGVkID0gWy4uLmVudHJpZXNdLnNvcnQoKGEsIGIpID0+IFxuICAgICAgbmV3IERhdGUoYi50aW1lc3RhbXApLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEudGltZXN0YW1wKS5nZXRUaW1lKClcbiAgICApO1xuICAgIFxuICAgIHJldHVybiBzb3J0ZWQuc2xpY2UoMCwgdGhpcy5jb25maWcubWF4RW50cmllcyk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIGFuZCBzb3J0IGVudHJpZXMgYmFzZWQgb24gcXVlcnkgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBmaWx0ZXJBbmRTb3J0RW50cmllcyhcbiAgICBlbnRyaWVzOiBUcnlvbkhpc3RvcnlFbnRyeVtdLCBcbiAgICBvcHRpb25zOiBUcnlvbkhpc3RvcnlRdWVyeU9wdGlvbnMgPSB7fVxuICApOiBUcnlvbkhpc3RvcnlFbnRyeVtdIHtcbiAgICBsZXQgZmlsdGVyZWQgPSBbLi4uZW50cmllc107XG5cbiAgICAvLyBBcHBseSBmYXZvcml0ZXMgZmlsdGVyXG4gICAgaWYgKG9wdGlvbnMuZmF2b3JpdGVzT25seSkge1xuICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoZW50cnkgPT4gZW50cnkuaXNGYXZvcml0ZSk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgZGF0ZSByYW5nZSBmaWx0ZXJcbiAgICBpZiAob3B0aW9ucy5kYXRlUmFuZ2UpIHtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG9wdGlvbnMuZGF0ZVJhbmdlLnN0YXJ0RGF0ZSk7XG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUob3B0aW9ucy5kYXRlUmFuZ2UuZW5kRGF0ZSk7XG4gICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihlbnRyeSA9PiB7XG4gICAgICAgIGNvbnN0IGVudHJ5RGF0ZSA9IG5ldyBEYXRlKGVudHJ5LnRpbWVzdGFtcCk7XG4gICAgICAgIHJldHVybiBlbnRyeURhdGUgPj0gc3RhcnREYXRlICYmIGVudHJ5RGF0ZSA8PSBlbmREYXRlO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgc2VhcmNoIHRlcm0gZmlsdGVyXG4gICAgaWYgKG9wdGlvbnMuc2VhcmNoVGVybSkge1xuICAgICAgY29uc3Qgc2VhcmNoVGVybSA9IG9wdGlvbnMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpO1xuICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoZW50cnkgPT4gXG4gICAgICAgIGVudHJ5LnRhZ3M/LnNvbWUodGFnID0+IHRhZy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0pKSB8fFxuICAgICAgICBlbnRyeS5ub3Rlcz8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBzb3J0aW5nXG4gICAgY29uc3Qgc29ydEJ5ID0gb3B0aW9ucy5zb3J0QnkgfHwgJ3RpbWVzdGFtcCc7XG4gICAgY29uc3Qgc29ydERpcmVjdGlvbiA9IG9wdGlvbnMuc29ydERpcmVjdGlvbiB8fCAnZGVzYyc7XG4gICAgXG4gICAgZmlsdGVyZWQuc29ydCgoYSwgYikgPT4ge1xuICAgICAgbGV0IGFWYWx1ZTogRGF0ZSB8IG51bWJlciwgYlZhbHVlOiBEYXRlIHwgbnVtYmVyO1xuICAgICAgXG4gICAgICBzd2l0Y2ggKHNvcnRCeSkge1xuICAgICAgICBjYXNlICd0aW1lc3RhbXAnOlxuICAgICAgICAgIGFWYWx1ZSA9IG5ldyBEYXRlKGEudGltZXN0YW1wKTtcbiAgICAgICAgICBiVmFsdWUgPSBuZXcgRGF0ZShiLnRpbWVzdGFtcCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3Byb2Nlc3NpbmdUaW1lJzpcbiAgICAgICAgICBhVmFsdWUgPSBhLnByb2Nlc3NpbmdUaW1lIHx8IDA7XG4gICAgICAgICAgYlZhbHVlID0gYi5wcm9jZXNzaW5nVGltZSB8fCAwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdpc0Zhdm9yaXRlJzpcbiAgICAgICAgICBhVmFsdWUgPSBhLmlzRmF2b3JpdGUgPyAxIDogMDtcbiAgICAgICAgICBiVmFsdWUgPSBiLmlzRmF2b3JpdGUgPyAxIDogMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBhVmFsdWUgPSBuZXcgRGF0ZShhLnRpbWVzdGFtcCkuZ2V0VGltZSgpO1xuICAgICAgICAgIGJWYWx1ZSA9IG5ldyBEYXRlKGIudGltZXN0YW1wKS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChzb3J0RGlyZWN0aW9uID09PSAnYXNjJykge1xuICAgICAgICByZXR1cm4gYVZhbHVlIDwgYlZhbHVlID8gLTEgOiBhVmFsdWUgPiBiVmFsdWUgPyAxIDogMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBhVmFsdWUgPiBiVmFsdWUgPyAtMSA6IGFWYWx1ZSA8IGJWYWx1ZSA/IDEgOiAwO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZpbHRlcmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBhc3luYyBhZGRFbnRyeShvcHRpb25zOiBDcmVhdGVUcnlvbkhpc3RvcnlFbnRyeU9wdGlvbnMpOiBQcm9taXNlPFRyeW9uSGlzdG9yeUVudHJ5PiB7XG4gICAgY29uc3QgZW50cnk6IFRyeW9uSGlzdG9yeUVudHJ5ID0ge1xuICAgICAgaWQ6IGdlbmVyYXRlSGlzdG9yeUlkKCksXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGdlbmVyYXRlZEltYWdlOiBvcHRpb25zLmdlbmVyYXRlZEltYWdlLFxuICAgICAgbW9kZWxJbWFnZTogb3B0aW9ucy5tb2RlbEltYWdlLFxuICAgICAgYXBwYXJlbEltYWdlczogb3B0aW9ucy5hcHBhcmVsSW1hZ2VzLFxuICAgICAgcHJvY2Vzc2luZ1RpbWU6IG9wdGlvbnMucHJvY2Vzc2luZ1RpbWUsXG4gICAgICBtZXRhZGF0YTogb3B0aW9ucy5tZXRhZGF0YSxcbiAgICAgIHRhZ3M6IG9wdGlvbnMudGFncyB8fCBbXSxcbiAgICAgIGlzRmF2b3JpdGU6IG9wdGlvbnMuaXNGYXZvcml0ZSB8fCBmYWxzZSxcbiAgICAgIG5vdGVzOiBvcHRpb25zLm5vdGVzIHx8ICcnXG4gICAgfTtcblxuICAgIC8vIENvbXByZXNzIGVudHJ5IGlmIGVuYWJsZWRcbiAgICBjb25zdCBjb21wcmVzc2VkRW50cnkgPSBhd2FpdCBjb21wcmVzc0hpc3RvcnlFbnRyeShlbnRyeSwgdGhpcy5jb25maWcpO1xuXG4gICAgLy8gQ2hlY2sgZW50cnkgc2l6ZVxuICAgIGNvbnN0IGVudHJ5U2l6ZSA9IGNhbGN1bGF0ZUVudHJ5U2l6ZShjb21wcmVzc2VkRW50cnkpO1xuICAgIGlmIChlbnRyeVNpemUgPiB0aGlzLmNvbmZpZy5tYXhFbnRyeVNpemVLQikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSGlzdG9yeSBlbnRyeSB0b28gbGFyZ2U6ICR7ZW50cnlTaXplLnRvRml4ZWQoMil9S0IgZXhjZWVkcyBsaW1pdCBvZiAke3RoaXMuY29uZmlnLm1heEVudHJ5U2l6ZUtCfUtCYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBlbnRyaWVzIGFuZCBhZGQgdGhlIG5ldyBvbmVcbiAgICBsZXQgZW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgIGVudHJpZXMucHVzaChjb21wcmVzc2VkRW50cnkpO1xuXG4gICAgLy8gUGVyZm9ybSBjbGVhbnVwIGlmIG5lZWRlZFxuICAgIGVudHJpZXMgPSB0aGlzLnBlcmZvcm1DbGVhbnVwSWZOZWVkZWQoZW50cmllcyk7XG5cbiAgICAvLyBTYXZlIHVwZGF0ZWQgZW50cmllc1xuICAgIHRoaXMuc2F2ZUVudHJpZXMoZW50cmllcyk7XG5cbiAgICByZXR1cm4gY29tcHJlc3NlZEVudHJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBoaXN0b3J5IGVudHJpZXMgd2l0aCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb25cbiAgICovXG4gIGFzeW5jIGdldEVudHJpZXMob3B0aW9uczogVHJ5b25IaXN0b3J5UXVlcnlPcHRpb25zID0ge30pOiBQcm9taXNlPFRyeW9uSGlzdG9yeUNvbGxlY3Rpb24+IHtcbiAgICBjb25zdCBhbGxFbnRyaWVzID0gdGhpcy5nZXRTdG9yZWRFbnRyaWVzKCk7XG4gICAgY29uc3QgZmlsdGVyZWRFbnRyaWVzID0gdGhpcy5maWx0ZXJBbmRTb3J0RW50cmllcyhhbGxFbnRyaWVzLCBvcHRpb25zKTtcblxuICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICBjb25zdCBwYWdlID0gb3B0aW9ucy5wYWdlIHx8IDA7XG4gICAgY29uc3QgcGFnZVNpemUgPSBvcHRpb25zLnBhZ2VTaXplIHx8IDIwO1xuICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBwYWdlICogcGFnZVNpemU7XG4gICAgY29uc3QgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgcGFnZVNpemU7XG4gICAgY29uc3QgcGFnaW5hdGVkRW50cmllcyA9IGZpbHRlcmVkRW50cmllcy5zbGljZShzdGFydEluZGV4LCBlbmRJbmRleCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZW50cmllczogcGFnaW5hdGVkRW50cmllcyxcbiAgICAgIHRvdGFsQ291bnQ6IGZpbHRlcmVkRW50cmllcy5sZW5ndGgsXG4gICAgICBjdXJyZW50UGFnZTogcGFnZSxcbiAgICAgIHBhZ2VTaXplLFxuICAgICAgaGFzTW9yZTogZW5kSW5kZXggPCBmaWx0ZXJlZEVudHJpZXMubGVuZ3RoLFxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgc3BlY2lmaWMgaGlzdG9yeSBlbnRyeSBieSBJRFxuICAgKi9cbiAgYXN5bmMgZ2V0RW50cnkoaWQ6IHN0cmluZyk6IFByb21pc2U8VHJ5b25IaXN0b3J5RW50cnkgfCBudWxsPiB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgIHJldHVybiBlbnRyaWVzLmZpbmQoZW50cnkgPT4gZW50cnkuaWQgPT09IGlkKSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbiBleGlzdGluZyBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBhc3luYyB1cGRhdGVFbnRyeShpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPFRyeW9uSGlzdG9yeUVudHJ5Pik6IFByb21pc2U8VHJ5b25IaXN0b3J5RW50cnk+IHtcbiAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5nZXRTdG9yZWRFbnRyaWVzKCk7XG4gICAgY29uc3QgZW50cnlJbmRleCA9IGVudHJpZXMuZmluZEluZGV4KGVudHJ5ID0+IGVudHJ5LmlkID09PSBpZCk7XG4gICAgXG4gICAgaWYgKGVudHJ5SW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhpc3RvcnkgZW50cnkgd2l0aCBJRCAke2lkfSBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSB1cGRhdGVzXG4gICAgY29uc3QgdXBkYXRlZEVudHJ5ID0geyBcbiAgICAgIC4uLmVudHJpZXNbZW50cnlJbmRleF0sIFxuICAgICAgLi4udXBkYXRlcyxcbiAgICAgIC8vIFByZXNlcnZlIElEIGFuZCB0aW1lc3RhbXAsIHVwZGF0ZSBvbmx5IGlmIGV4cGxpY2l0bHkgcHJvdmlkZWRcbiAgICAgIGlkOiBlbnRyaWVzW2VudHJ5SW5kZXhdLmlkLFxuICAgICAgdGltZXN0YW1wOiB1cGRhdGVzLnRpbWVzdGFtcCB8fCBlbnRyaWVzW2VudHJ5SW5kZXhdLnRpbWVzdGFtcFxuICAgIH07XG5cbiAgICBlbnRyaWVzW2VudHJ5SW5kZXhdID0gdXBkYXRlZEVudHJ5O1xuICAgIHRoaXMuc2F2ZUVudHJpZXMoZW50cmllcyk7XG5cbiAgICByZXR1cm4gdXBkYXRlZEVudHJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIGhpc3RvcnkgZW50cnlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUVudHJ5KGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5nZXRTdG9yZWRFbnRyaWVzKCk7XG4gICAgY29uc3QgZmlsdGVyZWRFbnRyaWVzID0gZW50cmllcy5maWx0ZXIoZW50cnkgPT4gZW50cnkuaWQgIT09IGlkKTtcbiAgICBcbiAgICBpZiAoZmlsdGVyZWRFbnRyaWVzLmxlbmd0aCA9PT0gZW50cmllcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTsgLy8gRW50cnkgbm90IGZvdW5kXG4gICAgfVxuXG4gICAgdGhpcy5zYXZlRW50cmllcyhmaWx0ZXJlZEVudHJpZXMpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBoaXN0b3J5IGVudHJpZXNcbiAgICovXG4gIGFzeW5jIGNsZWFyQWxsKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRoaXMuZW5zdXJlSW5pdGlhbGl6ZWQoKTtcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlTLkVOVFJJRVMsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNsZWFyIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3RvcmFnZSBzdGF0aXN0aWNzXG4gICAqL1xuICBhc3luYyBnZXRTdG9yYWdlU3RhdHMoKTogUHJvbWlzZTx7XG4gICAgdG90YWxFbnRyaWVzOiBudW1iZXI7XG4gICAgdG90YWxTaXplS0I6IG51bWJlcjtcbiAgICBvbGRlc3RFbnRyeT86IHN0cmluZztcbiAgICBuZXdlc3RFbnRyeT86IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLmdldFN0b3JlZEVudHJpZXMoKTtcbiAgICBcbiAgICBsZXQgdG90YWxTaXplS0IgPSAwO1xuICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICB0b3RhbFNpemVLQiArPSBjYWxjdWxhdGVFbnRyeVNpemUoZW50cnkpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdGltZXN0YW1wcyA9IGVudHJpZXMubWFwKGVudHJ5ID0+IGVudHJ5LnRpbWVzdGFtcCkuc29ydCgpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbEVudHJpZXM6IGVudHJpZXMubGVuZ3RoLFxuICAgICAgdG90YWxTaXplS0IsXG4gICAgICBvbGRlc3RFbnRyeTogdGltZXN0YW1wc1swXSxcbiAgICAgIG5ld2VzdEVudHJ5OiB0aW1lc3RhbXBzW3RpbWVzdGFtcHMubGVuZ3RoIC0gMV1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBoaXN0b3J5IGRhdGFcbiAgICovXG4gIGFzeW5jIGV4cG9ydEhpc3RvcnkoKTogUHJvbWlzZTxUcnlvbkhpc3RvcnlFbnRyeVtdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEltcG9ydCBoaXN0b3J5IGRhdGFcbiAgICovXG4gIGFzeW5jIGltcG9ydEhpc3RvcnkoZW50cmllczogVHJ5b25IaXN0b3J5RW50cnlbXSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIGVudHJpZXNcbiAgICAgIGNvbnN0IHZhbGlkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGVudHJ5ID0+IFxuICAgICAgICBlbnRyeS5pZCAmJiBlbnRyeS5nZW5lcmF0ZWRJbWFnZSAmJiBlbnRyeS5tb2RlbEltYWdlICYmIGVudHJ5LmFwcGFyZWxJbWFnZXNcbiAgICAgICk7XG5cbiAgICAgIC8vIEdldCBleGlzdGluZyBlbnRyaWVzIGFuZCBtZXJnZSB3aXRoIGltcG9ydHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nRW50cmllcyA9IHRoaXMuZ2V0U3RvcmVkRW50cmllcygpO1xuICAgICAgY29uc3QgZXhpc3RpbmdJZHMgPSBuZXcgU2V0KGV4aXN0aW5nRW50cmllcy5tYXAoZW50cnkgPT4gZW50cnkuaWQpKTtcbiAgICAgIFxuICAgICAgLy8gT25seSBpbXBvcnQgZW50cmllcyB0aGF0IGRvbid0IGFscmVhZHkgZXhpc3RcbiAgICAgIGNvbnN0IG5ld0VudHJpZXMgPSB2YWxpZEVudHJpZXMuZmlsdGVyKGVudHJ5ID0+ICFleGlzdGluZ0lkcy5oYXMoZW50cnkuaWQpKTtcbiAgICAgIFxuICAgICAgaWYgKG5ld0VudHJpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICAvLyBNZXJnZSBhbmQgc2F2ZVxuICAgICAgY29uc3QgbWVyZ2VkRW50cmllcyA9IFsuLi5leGlzdGluZ0VudHJpZXMsIC4uLm5ld0VudHJpZXNdO1xuICAgICAgY29uc3QgY2xlYW5lZEVudHJpZXMgPSB0aGlzLnBlcmZvcm1DbGVhbnVwSWZOZWVkZWQobWVyZ2VkRW50cmllcyk7XG4gICAgICBcbiAgICAgIHRoaXMuc2F2ZUVudHJpZXMoY2xlYW5lZEVudHJpZXMpO1xuICAgICAgcmV0dXJuIG5ld0VudHJpZXMubGVuZ3RoO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW1wb3J0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5IGltcG9ydCBmYWlsZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNlcnZpY2UgY29uZmlndXJhdGlvblxuICAgKi9cbiAgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZzogUGFydGlhbDxUcnlvbkhpc3RvcnlTdG9yYWdlQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4ubmV3Q29uZmlnIH07XG4gICAgXG4gICAgdGhpcy5lbnN1cmVJbml0aWFsaXplZCgpO1xuICAgIHRyeSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuQ09ORklHLCBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbmZpZykpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBjb25maWc6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogVHJ5b25IaXN0b3J5U3RvcmFnZUNvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufVxuXG4vKipcbiAqIERlZmF1bHQgaGlzdG9yeSBzZXJ2aWNlIGluc3RhbmNlXG4gKi9cbmV4cG9ydCBjb25zdCBkZWZhdWx0SGlzdG9yeVNlcnZpY2UgPSBuZXcgTG9jYWxTdG9yYWdlVHJ5b25IaXN0b3J5U2VydmljZSgpOyJdLCJuYW1lcyI6WyJMb2NhbFN0b3JhZ2VUcnlvbkhpc3RvcnlTZXJ2aWNlIiwiZGVmYXVsdEhpc3RvcnlTZXJ2aWNlIiwiREVGQVVMVF9DT05GSUciLCJzdG9yYWdlVHlwZSIsIm1heEVudHJpZXMiLCJtYXhFbnRyeVNpemVLQiIsImNvbXByZXNzSW1hZ2VzIiwiY29tcHJlc3Npb25RdWFsaXR5IiwiYXV0b0NsZWFudXAiLCJlbmNyeXB0aW9uS2V5IiwiU1RPUkFHRV9LRVlTIiwiRU5UUklFUyIsIkNPTkZJRyIsIk1FVEFEQVRBIiwiZ2VuZXJhdGVIaXN0b3J5SWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwiY2FsY3VsYXRlRW50cnlTaXplIiwiZW50cnkiLCJqc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsIkJsb2IiLCJzaXplIiwiY29tcHJlc3NIaXN0b3J5RW50cnkiLCJjb25maWciLCJtYXhTaXplS0IiLCJhcHBhcmVsSW1hZ2VzIiwibGVuZ3RoIiwicXVhbGl0eSIsImNvbXByZXNzZWRHZW5lcmF0ZWQiLCJjb21wcmVzc0Jhc2U2NCIsImdlbmVyYXRlZEltYWdlIiwiY29tcHJlc3NlZE1vZGVsIiwibW9kZWxJbWFnZSIsImNvbXByZXNzZWRBcHBhcmVsIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImltZyIsIm1ldGFkYXRhIiwiaW1hZ2VQcm9jZXNzaW5nUmVzdWx0cyIsInRvdGFsUHJvY2Vzc2luZ1RpbWUiLCJmaW5hbEltYWdlU2l6ZXMiLCJtb2RlbEltYWdlU2l6ZSIsImdldEJhc2U2NFNpemUiLCJhcHBhcmVsSW1hZ2VTaXplcyIsImVycm9yIiwiQ29tcHJlc3Npb25GYWlsZWRFcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiY29uc3RydWN0b3IiLCJpc0luaXRpYWxpemVkIiwiaW5pdGlhbGl6ZVN0b3JhZ2UiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJFcnJvciIsImdldEl0ZW0iLCJzZXRJdGVtIiwidmVyc2lvbiIsImNyZWF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibGFzdFVwZGF0ZWQiLCJlbnN1cmVJbml0aWFsaXplZCIsImdldFN0b3JlZEVudHJpZXMiLCJlbnRyaWVzSnNvbiIsInBhcnNlIiwic2F2ZUVudHJpZXMiLCJlbnRyaWVzIiwicGVyZm9ybUNsZWFudXBJZk5lZWRlZCIsInNvcnRlZCIsInNvcnQiLCJhIiwiYiIsInRpbWVzdGFtcCIsImdldFRpbWUiLCJzbGljZSIsImZpbHRlckFuZFNvcnRFbnRyaWVzIiwib3B0aW9ucyIsImZpbHRlcmVkIiwiZmF2b3JpdGVzT25seSIsImZpbHRlciIsImlzRmF2b3JpdGUiLCJkYXRlUmFuZ2UiLCJzdGFydERhdGUiLCJlbmREYXRlIiwiZW50cnlEYXRlIiwic2VhcmNoVGVybSIsInRvTG93ZXJDYXNlIiwidGFncyIsInNvbWUiLCJ0YWciLCJpbmNsdWRlcyIsIm5vdGVzIiwic29ydEJ5Iiwic29ydERpcmVjdGlvbiIsImFWYWx1ZSIsImJWYWx1ZSIsInByb2Nlc3NpbmdUaW1lIiwiYWRkRW50cnkiLCJpZCIsImNvbXByZXNzZWRFbnRyeSIsImVudHJ5U2l6ZSIsInRvRml4ZWQiLCJwdXNoIiwiZ2V0RW50cmllcyIsImFsbEVudHJpZXMiLCJmaWx0ZXJlZEVudHJpZXMiLCJwYWdlIiwicGFnZVNpemUiLCJzdGFydEluZGV4IiwiZW5kSW5kZXgiLCJwYWdpbmF0ZWRFbnRyaWVzIiwidG90YWxDb3VudCIsImN1cnJlbnRQYWdlIiwiaGFzTW9yZSIsImdldEVudHJ5IiwiZmluZCIsInVwZGF0ZUVudHJ5IiwidXBkYXRlcyIsImVudHJ5SW5kZXgiLCJmaW5kSW5kZXgiLCJ1cGRhdGVkRW50cnkiLCJkZWxldGVFbnRyeSIsImNsZWFyQWxsIiwiZ2V0U3RvcmFnZVN0YXRzIiwidG90YWxTaXplS0IiLCJmb3JFYWNoIiwidGltZXN0YW1wcyIsInRvdGFsRW50cmllcyIsIm9sZGVzdEVudHJ5IiwibmV3ZXN0RW50cnkiLCJleHBvcnRIaXN0b3J5IiwiaW1wb3J0SGlzdG9yeSIsInZhbGlkRW50cmllcyIsImV4aXN0aW5nRW50cmllcyIsImV4aXN0aW5nSWRzIiwiU2V0IiwibmV3RW50cmllcyIsImhhcyIsIm1lcmdlZEVudHJpZXMiLCJjbGVhbmVkRW50cmllcyIsInVwZGF0ZUNvbmZpZyIsIm5ld0NvbmZpZyIsImdldENvbmZpZyJdLCJtYXBwaW5ncyI6IkFBQUEsaUNBQWlDO0FBQ2pD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