{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/api/tryon/schema.test.ts"],"sourcesContent":["import { TryonSchema } from '../../../src/app/api/tryon/schema';\nimport { \n  normalizeBase64, \n  Base64Str, \n  TryOnParamsSchema, \n  TryOnResultSchema \n} from '../../../src/lib/tryOnSchema';\n\ndescribe('TryonSchema', () => {\n  describe('valid payloads', () => {\n    it('should validate a correct payload', () => {\n      const validPayload = {\n        modelImage: 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: ['data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      const result = TryonSchema.parse(validPayload);\n      expect(result).toEqual(validPayload);\n    });\n\n    it('should validate payload with multiple apparel images', () => {\n      const validPayload = {\n        modelImage: 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: [\n          'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n          'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='\n        ]\n      };\n\n      const result = TryonSchema.parse(validPayload);\n      expect(result).toEqual(validPayload);\n    });\n\n    it('should validate payload with pure base64 strings', () => {\n      const validPayload = {\n        modelImage: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: ['iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      const result = TryonSchema.parse(validPayload);\n      expect(result).toEqual(validPayload);\n    });\n  });\n\n  describe('normalizeBase64 function', () => {\n    it('should strip data URL prefix from base64 strings', () => {\n      const dataUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      const expected = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(normalizeBase64(dataUrl)).toBe(expected);\n    });\n\n    it('should return pure base64 strings unchanged', () => {\n      const pureBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(normalizeBase64(pureBase64)).toBe(pureBase64);\n    });\n\n    it('should handle different image formats', () => {\n      const jpegDataUrl = 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      const expected = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(normalizeBase64(jpegDataUrl)).toBe(expected);\n    });\n\n    // New tests to improve branch coverage\n    it('should handle malformed data URL without comma', () => {\n      const malformedDataUrl = 'data:image/png;base64';\n      \n      expect(normalizeBase64(malformedDataUrl)).toBe(malformedDataUrl);\n    });\n\n    it('should handle data URL with empty base64 part', () => {\n      const dataUrlWithEmptyBase64 = 'data:image/png;base64,';\n      \n      expect(normalizeBase64(dataUrlWithEmptyBase64)).toBe('');\n    });\n\n    it('should handle string that starts with data:image/ but is not a valid data URL', () => {\n      const invalidDataUrl = 'data:image/png;base64,invalid-base64-data';\n      \n      expect(normalizeBase64(invalidDataUrl)).toBe('invalid-base64-data');\n    });\n  });\n\n  describe('Base64Str schema', () => {\n    it('should validate valid data URLs', () => {\n      const validDataUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(() => Base64Str.parse(validDataUrl)).not.toThrow();\n    });\n\n    it('should validate valid pure base64 strings', () => {\n      const validBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(() => Base64Str.parse(validBase64)).not.toThrow();\n    });\n\n    it('should validate base64 strings with different padding', () => {\n      // Test that the regex accepts valid base64 strings\n      const validBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';\n      \n      expect(() => Base64Str.parse(validBase64)).not.toThrow();\n    });\n\n    it('should reject invalid base64 strings', () => {\n      const invalidBase64 = 'not-base64-data';\n      \n      expect(() => Base64Str.parse(invalidBase64)).toThrow('Invalid base64 image data');\n    });\n\n    it('should reject malformed data URLs', () => {\n      const malformedDataUrl = 'data:image/png;base64,invalid-base64-data';\n      \n      expect(() => Base64Str.parse(malformedDataUrl)).toThrow('Invalid base64 image data');\n    });\n  });\n\n  describe('TryOnParamsSchema', () => {\n    it('should validate correct parameters', () => {\n      const validParams = {\n        modelImage: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: ['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n      \n      expect(() => TryOnParamsSchema.parse(validParams)).not.toThrow();\n    });\n\n    it('should reject missing modelImage', () => {\n      const invalidParams = {\n        apparelImages: ['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n      \n      expect(() => TryOnParamsSchema.parse(invalidParams)).toThrow('Required');\n    });\n\n    it('should reject empty apparelImages array', () => {\n      const invalidParams = {\n        modelImage: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: []\n      };\n      \n      expect(() => TryOnParamsSchema.parse(invalidParams)).toThrow('At least one apparel image is required');\n    });\n  });\n\n  describe('TryOnResultSchema', () => {\n    it('should validate correct result', () => {\n      const validResult = {\n        imgGenerated: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='\n      };\n      \n      expect(() => TryOnResultSchema.parse(validResult)).not.toThrow();\n    });\n\n    it('should validate result with pure base64', () => {\n      const validResult = {\n        imgGenerated: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='\n      };\n      \n      expect(() => TryOnResultSchema.parse(validResult)).not.toThrow();\n    });\n\n    it('should reject missing imgGenerated', () => {\n      const invalidResult = {};\n      \n      expect(() => TryOnResultSchema.parse(invalidResult)).toThrow('Required');\n    });\n\n    it('should reject invalid base64 in imgGenerated', () => {\n      const invalidResult = {\n        imgGenerated: 'not-base64-data'\n      };\n      \n      expect(() => TryOnResultSchema.parse(invalidResult)).toThrow('Invalid base64 image data');\n    });\n\n    it('should reject empty imgGenerated', () => {\n      const invalidResult = {\n        imgGenerated: 'invalid-base64-data'\n      };\n      \n      expect(() => TryOnResultSchema.parse(invalidResult)).toThrow('Invalid base64 image data');\n    });\n  });\n\n  describe('invalid payloads', () => {\n    it('should reject payload with missing modelImage', () => {\n      const invalidPayload = {\n        apparelImages: ['data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('Required');\n    });\n\n    it('should reject payload with empty modelImage', () => {\n      const invalidPayload = {\n        modelImage: '',\n        apparelImages: ['data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('Missing model image');\n    });\n\n    it('should reject payload with missing apparelImages', () => {\n      const invalidPayload = {\n        modelImage: 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('Required');\n    });\n\n    it('should reject payload with empty apparelImages array', () => {\n      const invalidPayload = {\n        modelImage: 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: []\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('At least one apparel image required');\n    });\n\n    it('should reject payload with empty string in apparelImages', () => {\n      const invalidPayload = {\n        modelImage: 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',\n        apparelImages: ['', 'data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('Invalid apparel image');\n    });\n\n    it('should reject payload with invalid base64 data', () => {\n      const invalidPayload = {\n        modelImage: 'not-base64-data',\n        apparelImages: ['data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==']\n      };\n\n      expect(() => TryonSchema.parse(invalidPayload)).toThrow('Invalid base64 image data');\n    });\n  });\n}); "],"names":["describe","it","validPayload","modelImage","apparelImages","result","TryonSchema","parse","expect","toEqual","dataUrl","expected","normalizeBase64","toBe","pureBase64","jpegDataUrl","malformedDataUrl","dataUrlWithEmptyBase64","invalidDataUrl","validDataUrl","Base64Str","not","toThrow","validBase64","invalidBase64","validParams","TryOnParamsSchema","invalidParams","validResult","imgGenerated","TryOnResultSchema","invalidResult","invalidPayload"],"mappings":"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"}