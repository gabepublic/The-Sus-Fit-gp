{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/src/business-layer/tests/testUtils.ts"],"sourcesContent":["// Test Utilities for Optimistic Updates and Cache Management\n// Common utilities and mocks for testing optimistic updates functionality\n\nimport React from 'react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { renderHook } from '@testing-library/react';\nimport type { \n  TryonMutationVariables,\n  TryonMutationResponse,\n  TryonMutationContext,\n  TryonMutationError\n} from '../types/tryon.types';\n\n/**\n * Create a test query client with appropriate settings\n */\nexport function createTestQueryClient(options?: {\n  defaultOptions?: {\n    queries?: any;\n    mutations?: any;\n  };\n}): QueryClient {\n  return new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n        gcTime: 0,\n        staleTime: 0,\n        ...options?.defaultOptions?.queries\n      },\n      mutations: {\n        retry: false,\n        ...options?.defaultOptions?.mutations\n      }\n    },\n    logger: {\n      log: () => {},\n      warn: () => {},\n      error: () => {}\n    }\n  });\n}\n\n/**\n * Create a wrapper component with QueryClient for hook testing\n */\nexport function createQueryClientWrapper(queryClient?: QueryClient) {\n  const client = queryClient || createTestQueryClient();\n  \n  return ({ children }: { children: React.ReactNode }) => (\n    React.createElement(QueryClientProvider, { client }, children)\n  );\n}\n\n/**\n * Render hook with query client wrapper\n */\nexport function renderHookWithQueryClient<T>(\n  hook: () => T,\n  queryClient?: QueryClient\n) {\n  const wrapper = createQueryClientWrapper(queryClient);\n  return renderHook(hook, { wrapper });\n}\n\n/**\n * Mock try-on mutation variables\n */\nexport const mockTryonVariables: TryonMutationVariables = {\n  modelImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/mock-model-image',\n  apparelImages: [\n    'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/mock-apparel-1',\n    'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/mock-apparel-2'\n  ],\n  options: {\n    quality: 'high',\n    timeout: 10000,\n    enableOptimisticUpdates: true,\n    metadata: {\n      testMode: true,\n      timestamp: '2024-01-15T10:30:00Z'\n    },\n    imageProcessing: {\n      targetWidth: 1024,\n      targetHeight: 1536,\n      maxSizeKB: 1024,\n      compressionQuality: 0.9,\n      preserveAspectRatio: false\n    }\n  }\n};\n\n/**\n * Mock try-on mutation response\n */\nexport const mockTryonResponse: TryonMutationResponse = {\n  img_generated: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/mock-generated-result',\n  metadata: {\n    processingTime: 5234,\n    modelVersion: 'v2.1.0',\n    appliedQuality: 'high',\n    timestamp: '2024-01-15T10:30:05Z',\n    processingInfo: {\n      stepsCompleted: ['image-processing', 'ai-generation', 'post-processing'],\n      totalSteps: 3,\n      gpuUsage: 0.85,\n      memoryUsage: 0.67\n    }\n  }\n};\n\n/**\n * Mock try-on mutation context\n */\nexport const mockTryonContext: TryonMutationContext = {\n  variables: mockTryonVariables,\n  startTime: Date.now() - 5234,\n  retryCount: 0,\n  optimisticId: 'test-optimistic-12345',\n  imageProcessingResults: {\n    modelImageResult: {\n      originalSize: 2048576, // 2MB\n      processedSize: 1048576, // 1MB\n      compressionRatio: 0.5,\n      processingTime: 123,\n      processedImage: mockTryonVariables.modelImage,\n      metadata: {\n        originalDimensions: { width: 1920, height: 1080 },\n        processedDimensions: { width: 1024, height: 1536 },\n        format: 'jpeg',\n        quality: 0.9\n      }\n    },\n    apparelImageResults: [\n      {\n        originalSize: 1536000,\n        processedSize: 768000,\n        compressionRatio: 0.5,\n        processingTime: 89,\n        processedImage: mockTryonVariables.apparelImages[0],\n        metadata: {\n          originalDimensions: { width: 1200, height: 800 },\n          processedDimensions: { width: 1024, height: 1536 },\n          format: 'jpeg',\n          quality: 0.9\n        }\n      }\n    ],\n    totalProcessingTime: 212\n  }\n};\n\n/**\n * Mock try-on mutation error\n */\nexport const mockTryonError: TryonMutationError = {\n  error: 'Processing failed: Invalid image format',\n  details: 'The provided model image is not in a supported format. Please use JPEG, PNG, or WebP.',\n  code: 'INVALID_IMAGE_FORMAT',\n  status: 400,\n  retryable: false,\n  category: 'VALIDATION_ERROR' as any,\n  severity: 'HIGH' as any,\n  recoveryActions: [\n    {\n      type: 'USER_ACTION' as any,\n      description: 'Convert image to a supported format',\n      actionData: {\n        supportedFormats: ['jpeg', 'png', 'webp']\n      }\n    }\n  ]\n};\n\n/**\n * Create mock fetch response for API testing\n */\nexport function createMockFetchResponse(\n  data: any,\n  status = 200,\n  ok = true\n): Response {\n  return {\n    ok,\n    status,\n    json: jest.fn().mockResolvedValue(data),\n    text: jest.fn().mockResolvedValue(JSON.stringify(data)),\n    headers: new Headers(),\n    redirected: false,\n    statusText: ok ? 'OK' : 'Error',\n    type: 'basic',\n    url: 'http://localhost:3000/api/tryon',\n    body: null,\n    bodyUsed: false,\n    clone: jest.fn(),\n    arrayBuffer: jest.fn(),\n    blob: jest.fn(),\n    formData: jest.fn()\n  } as unknown as Response;\n}\n\n/**\n * Mock the try-on API endpoint\n */\nexport function mockTryonAPI(\n  response?: TryonMutationResponse,\n  error?: TryonMutationError | Error,\n  delay = 0\n): jest.SpyInstance {\n  const mockResponse = response || mockTryonResponse;\n  const mockError = error;\n\n  return jest.spyOn(global, 'fetch').mockImplementation(\n    (url: string | URL | Request) => {\n      const urlString = typeof url === 'string' ? url : url.toString();\n      \n      if (urlString.includes('/api/tryon')) {\n        return new Promise((resolve, reject) => {\n          setTimeout(() => {\n            if (mockError) {\n              // Handle basic Error objects by converting them to TryonMutationError format\n              let errorResponse;\n              if (mockError instanceof Error && !('status' in mockError)) {\n                // Convert basic Error to TryonMutationError format\n                errorResponse = {\n                  error: 'An error occurred',\n                  details: mockError.message,\n                  code: 'UNKNOWN_ERROR',\n                  status: 500,\n                  retryable: false,\n                  category: 'NETWORK_ERROR' as any,\n                  severity: 'MEDIUM' as any,\n                  recoveryActions: []\n                };\n              } else {\n                // Use the error as-is if it's already in TryonMutationError format\n                errorResponse = mockError as TryonMutationError;\n              }\n              resolve(createMockFetchResponse(errorResponse, errorResponse.status || 500, false));\n            } else {\n              resolve(createMockFetchResponse(mockResponse));\n            }\n          }, delay);\n        });\n      }\n      \n      return Promise.reject(new Error(`Unmocked fetch call to ${urlString}`));\n    }\n  );\n}\n\n/**\n * Wait for all pending promises to resolve\n */\nexport function waitForPromises(): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, 0));\n}\n\n/**\n * Wait for a specific amount of time\n */\nexport function wait(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Create mock history entries for testing\n */\nexport function createMockHistoryEntries(count = 5) {\n  return Array.from({ length: count }, (_, index) => ({\n    id: `history-entry-${index}`,\n    timestamp: new Date(Date.now() - index * 60000).toISOString(),\n    generatedImage: `data:image/jpeg;base64,mock-generated-${index}`,\n    modelImage: `data:image/jpeg;base64,mock-model-${index}`,\n    apparelImages: [`data:image/jpeg;base64,mock-apparel-${index}`],\n    processingTime: 3000 + Math.random() * 2000,\n    metadata: {\n      modelVersion: 'v2.1.0',\n      appliedQuality: 'high',\n      processingConfig: {\n        imageProcessing: mockTryonVariables.options?.imageProcessing,\n        requestOptions: {\n          timeout: 10000,\n          quality: 'high'\n        }\n      }\n    },\n    tags: index % 2 === 0 ? ['casual'] : ['formal'],\n    notes: `Test entry ${index}`,\n    isFavorite: index % 3 === 0\n  }));\n}\n\n/**\n * Assert that optimistic update was created correctly\n */\nexport function assertOptimisticUpdateCreated(\n  queryClient: QueryClient,\n  optimisticId: string,\n  config: {\n    expectHistory?: boolean;\n    expectProgress?: boolean;\n    expectResult?: boolean;\n  } = {}\n) {\n  const { expectHistory = true, expectProgress = true, expectResult = true } = config;\n\n  if (expectHistory) {\n    const historyData = queryClient.getQueryData(['tryon-history', 'entries']);\n    expect(historyData).toBeDefined();\n    expect((historyData as any).entries).toContainEqual(\n      expect.objectContaining({\n        id: expect.stringContaining('optimistic_history'),\n        tags: expect.arrayContaining(['processing', 'optimistic'])\n      })\n    );\n  }\n\n  if (expectProgress) {\n    const progressData = queryClient.getQueryData(['tryon-progress', optimisticId]);\n    expect(progressData).toBeDefined();\n    expect(progressData).toMatchObject({\n      id: optimisticId,\n      status: 'processing',\n      progress: expect.any(Number),\n      stage: expect.any(String)\n    });\n  }\n\n  if (expectResult) {\n    const resultData = queryClient.getQueryData(['tryon-result', optimisticId]);\n    expect(resultData).toBeDefined();\n    expect(resultData).toMatchObject({\n      id: optimisticId,\n      status: 'pending',\n      variables: expect.any(Object)\n    });\n  }\n}\n\n/**\n * Assert that optimistic update was completed correctly\n */\nexport function assertOptimisticUpdateCompleted(\n  queryClient: QueryClient,\n  optimisticId: string,\n  expectedResult: TryonMutationResponse\n) {\n  // Check history was updated\n  const historyData = queryClient.getQueryData(['tryon-history', 'entries']);\n  expect(historyData).toBeDefined();\n  const entry = (historyData as any).entries.find((e: any) => \n    !e.id.includes('optimistic_history')\n  );\n  expect(entry).toBeDefined();\n  expect(entry.generatedImage).toBe(expectedResult.img_generated);\n  expect(entry.tags).not.toContain('processing');\n  expect(entry.tags).not.toContain('optimistic');\n\n  // Check progress was completed\n  const progressData = queryClient.getQueryData(['tryon-progress', optimisticId]);\n  expect(progressData).toMatchObject({\n    id: optimisticId,\n    status: 'completed',\n    progress: 100,\n    stage: 'completed'\n  });\n\n  // Check result was cached\n  const resultData = queryClient.getQueryData(['tryon-result', optimisticId]);\n  expect(resultData).toMatchObject({\n    id: optimisticId,\n    status: 'completed',\n    result: expectedResult\n  });\n}\n\n/**\n * Assert that optimistic update was rolled back correctly\n */\nexport function assertOptimisticUpdateRolledBack(\n  queryClient: QueryClient,\n  optimisticId: string,\n  expectedError?: string\n) {\n  // Check history entry was removed\n  const historyData = queryClient.getQueryData(['tryon-history', 'entries']);\n  expect(historyData).toBeDefined();\n  const optimisticEntry = (historyData as any).entries.find((e: any) => \n    e.id.includes('optimistic_history')\n  );\n  expect(optimisticEntry).toBeUndefined();\n\n  // Check progress shows error state\n  const progressData = queryClient.getQueryData(['tryon-progress', optimisticId]);\n  expect(progressData).toMatchObject({\n    id: optimisticId,\n    status: 'error',\n    progress: 0,\n    stage: 'error'\n  });\n\n  if (expectedError) {\n    expect((progressData as any).error).toBe(expectedError);\n  }\n}\n\n/**\n * Mock console methods to avoid test output pollution\n */\nexport function mockConsole() {\n  const originalConsole = { ...console };\n  \n  const consoleMocks = {\n    log: jest.spyOn(console, 'log').mockImplementation(),\n    warn: jest.spyOn(console, 'warn').mockImplementation(),\n    error: jest.spyOn(console, 'error').mockImplementation(),\n    info: jest.spyOn(console, 'info').mockImplementation()\n  };\n\n  return {\n    mocks: consoleMocks,\n    restore: () => {\n      Object.assign(console, originalConsole);\n    }\n  };\n}"],"names":["assertOptimisticUpdateCompleted","assertOptimisticUpdateCreated","assertOptimisticUpdateRolledBack","createMockFetchResponse","createMockHistoryEntries","createQueryClientWrapper","createTestQueryClient","mockConsole","mockTryonAPI","mockTryonContext","mockTryonError","mockTryonResponse","mockTryonVariables","renderHookWithQueryClient","wait","waitForPromises","options","QueryClient","defaultOptions","queries","retry","gcTime","staleTime","mutations","logger","log","warn","error","queryClient","client","children","React","createElement","QueryClientProvider","hook","wrapper","renderHook","modelImage","apparelImages","quality","timeout","enableOptimisticUpdates","metadata","testMode","timestamp","imageProcessing","targetWidth","targetHeight","maxSizeKB","compressionQuality","preserveAspectRatio","img_generated","processingTime","modelVersion","appliedQuality","processingInfo","stepsCompleted","totalSteps","gpuUsage","memoryUsage","variables","startTime","Date","now","retryCount","optimisticId","imageProcessingResults","modelImageResult","originalSize","processedSize","compressionRatio","processedImage","originalDimensions","width","height","processedDimensions","format","apparelImageResults","totalProcessingTime","details","code","status","retryable","category","severity","recoveryActions","type","description","actionData","supportedFormats","data","ok","json","jest","fn","mockResolvedValue","text","JSON","stringify","headers","Headers","redirected","statusText","url","body","bodyUsed","clone","arrayBuffer","blob","formData","response","delay","mockResponse","mockError","spyOn","global","mockImplementation","urlString","toString","includes","Promise","resolve","reject","setTimeout","errorResponse","Error","message","ms","count","Array","from","length","_","index","id","toISOString","generatedImage","Math","random","processingConfig","requestOptions","tags","notes","isFavorite","config","expectHistory","expectProgress","expectResult","historyData","getQueryData","expect","toBeDefined","entries","toContainEqual","objectContaining","stringContaining","arrayContaining","progressData","toMatchObject","progress","any","Number","stage","String","resultData","Object","expectedResult","entry","find","e","toBe","not","toContain","result","expectedError","optimisticEntry","toBeUndefined","originalConsole","console","consoleMocks","info","mocks","restore","assign"],"mappings":"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"}