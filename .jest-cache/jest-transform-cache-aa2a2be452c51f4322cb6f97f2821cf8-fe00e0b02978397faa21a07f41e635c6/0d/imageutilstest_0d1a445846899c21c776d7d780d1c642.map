{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/utils/image-utils.test.ts"],"sourcesContent":["// Mock canvas and Image for testing\nconst mockCanvas = {\n  width: 0,\n  height: 0,\n  getContext: jest.fn(() => ({\n    drawImage: jest.fn(),\n  })),\n  toDataURL: jest.fn(() => 'data:image/jpeg;base64,mock-data'),\n};\n\nconst mockImage = {\n  width: 800,\n  height: 600,\n  crossOrigin: '',\n  onload: null as (() => void) | null,\n  onerror: null as (() => void) | null,\n  src: '',\n};\n\n// Mock global objects\nglobal.Image = jest.fn(() => mockImage) as any;\nglobal.document.createElement = jest.fn((tagName: string) => {\n  if (tagName === 'canvas') {\n    return mockCanvas as any;\n  }\n  return {} as any;\n});\n\n// Import the functions to test (we'll need to extract them from the page component)\n// For now, let's test the logic directly\n\ndescribe('Image Utilities', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockImage.onload = null;\n    mockImage.onerror = null;\n    mockImage.src = '';\n  });\n\n  describe('resizeImageTo1024x1536', () => {\n    it('should resize image to 1024x1536 dimensions', async () => {\n      // Arrange\n      const imageUrl = 'test-image.jpg';\n      const expectedDataUrl = 'data:image/jpeg;base64,mock-data';\n      \n      // Act\n      const resizePromise = new Promise<string>((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.onload = () => {\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d');\n          \n          if (!ctx) {\n            reject(new Error('Could not get canvas context'));\n            return;\n          }\n          \n          // Set canvas dimensions to target size\n          canvas.width = 1024;\n          canvas.height = 1536;\n          \n          // Draw the image resized to fit the canvas\n          ctx.drawImage(img, 0, 0, 1024, 1536);\n          \n          // Convert to data URL\n          const resizedImageUrl = canvas.toDataURL('image/jpeg', 0.9);\n          resolve(resizedImageUrl);\n        };\n        \n        img.onerror = () => {\n          reject(new Error('Failed to load image for resizing'));\n        };\n        \n        img.src = imageUrl;\n      });\n\n      // Simulate image load\n      setTimeout(() => {\n        if (mockImage.onload) {\n          mockImage.onload();\n        }\n      }, 0);\n\n      // Assert\n      const result = await resizePromise;\n      expect(result).toBe(expectedDataUrl);\n      expect(mockCanvas.width).toBe(1024);\n      expect(mockCanvas.height).toBe(1536);\n      expect(mockCanvas.getContext).toHaveBeenCalledWith('2d');\n      expect(mockCanvas.toDataURL).toHaveBeenCalledWith('image/jpeg', 0.9);\n    });\n\n    it('should reject when canvas context cannot be obtained', async () => {\n      // Arrange\n      mockCanvas.getContext.mockReturnValue(null as any);\n      const imageUrl = 'test-image.jpg';\n      \n      // Act\n      const resizePromise = new Promise<string>((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.onload = () => {\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d');\n          \n          if (!ctx) {\n            reject(new Error('Could not get canvas context'));\n            return;\n          }\n          \n          // This should not be reached\n          resolve('success');\n        };\n        \n        img.onerror = () => {\n          reject(new Error('Failed to load image for resizing'));\n        };\n        \n        img.src = imageUrl;\n      });\n\n      // Simulate image load\n      setTimeout(() => {\n        if (mockImage.onload) {\n          mockImage.onload();\n        }\n      }, 0);\n\n      // Assert\n      await expect(resizePromise).rejects.toThrow('Could not get canvas context');\n    });\n\n    it('should reject when image fails to load', async () => {\n      // Arrange\n      const imageUrl = 'invalid-image.jpg';\n      \n      // Act\n      const resizePromise = new Promise<string>((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.onload = () => {\n          resolve('success');\n        };\n        \n        img.onerror = () => {\n          reject(new Error('Failed to load image for resizing'));\n        };\n        \n        img.src = imageUrl;\n      });\n\n      // Simulate image error\n      setTimeout(() => {\n        if (mockImage.onerror) {\n          mockImage.onerror();\n        }\n      }, 0);\n\n      // Assert\n      await expect(resizePromise).rejects.toThrow('Failed to load image for resizing');\n    });\n  });\n\n  describe('logImageDimensions', () => {\n    it('should log image dimensions when image loads', () => {\n      // Arrange\n      const imageUrl = 'test-image.jpg';\n      const cardName = 'Test Card';\n      const consoleSpy = jest.spyOn(console, 'log').mockImplementation();\n      \n      // Act\n      const img = new Image();\n      img.src = imageUrl;\n      img.onload = () => {\n        console.log(`${cardName} image dimensions:`, { width: img.width, height: img.height });\n      };\n\n      // Simulate image load\n      setTimeout(() => {\n        if (mockImage.onload) {\n          mockImage.onload();\n        }\n      }, 0);\n\n      // Assert\n      setTimeout(() => {\n        expect(consoleSpy).toHaveBeenCalledWith(\n          `${cardName} image dimensions:`,\n          { width: mockImage.width, height: mockImage.height }\n        );\n        consoleSpy.mockRestore();\n      }, 10);\n    });\n  });\n}); "],"names":["mockCanvas","width","height","getContext","jest","fn","drawImage","toDataURL","mockImage","crossOrigin","onload","onerror","src","global","Image","document","createElement","tagName","describe","beforeEach","clearAllMocks","it","imageUrl","expectedDataUrl","resizePromise","Promise","resolve","reject","img","canvas","ctx","Error","resizedImageUrl","setTimeout","result","expect","toBe","toHaveBeenCalledWith","mockReturnValue","rejects","toThrow","cardName","consoleSpy","spyOn","console","mockImplementation","log","mockRestore"],"mappings":"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"}