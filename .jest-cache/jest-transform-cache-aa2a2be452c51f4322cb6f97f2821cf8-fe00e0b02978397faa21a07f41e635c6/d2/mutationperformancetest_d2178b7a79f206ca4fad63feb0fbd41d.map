{"version":3,"sources":["/Users/willstreeter/WebstormProjects/vibe-coding/those-people/The-Sus-Fit-gp/__tests__/business-layer/performance/mutation.performance.test.ts"],"sourcesContent":["// Performance Tests for Try-On Mutations\n// Tests to ensure mutations perform well under various load conditions\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { QueryClient } from '@tanstack/react-query';\nimport { useTryonMutation } from '../../../src/business-layer/mutations/useTryonMutation';\nimport { useTryonWithProgress, useBatchTryonWithProgress } from '../../../src/business-layer/hooks/useTryonWithProgress';\nimport {\n  createTestQueryClient,\n  createQueryClientWrapper,\n  mockTryonAPI,\n  mockTryonResponse,\n  mockConsole,\n  wait\n} from '../../../src/business-layer/tests/testUtils';\nimport type { TryonMutationVariables } from '../../../src/business-layer/types/tryon.types';\n\n// Mock dependencies for performance testing\njest.mock('../../../src/business-layer/utils/optimisticUpdates', () => ({\n  getOptimisticUpdatesManager: () => ({\n    startOptimisticUpdate: jest.fn(() => ({\n      optimisticId: `perf-test-${Date.now()}-${Math.random()}`,\n      variables: {},\n      config: {},\n      startTime: Date.now(),\n      rollbackFunctions: []\n    })),\n    completeOptimisticUpdate: jest.fn(),\n    rollbackOptimisticUpdate: jest.fn(),\n    getActiveOptimisticUpdates: jest.fn(() => [])\n  }),\n  OptimisticUpdatesManager: jest.fn()\n}));\n\njest.mock('../../../src/business-layer/utils/cacheInvalidation', () => ({\n  invalidateCacheAfterMutation: jest.fn().mockResolvedValue(undefined)\n}));\n\njest.mock('../../../src/business-layer/utils/imageProcessing', () => ({\n  processImageForTryon: jest.fn().mockImplementation(() => {\n    // Simulate realistic processing time\n    return new Promise(resolve => {\n      setTimeout(() => {\n        resolve({\n          originalSize: 2048576,\n          processedSize: 1048576,\n          compressionRatio: 0.5,\n          processingTime: 50 + Math.random() * 100, // 50-150ms\n          processedImage: 'data:image/jpeg;base64,processed-image',\n          metadata: {\n            originalDimensions: { width: 1920, height: 1080 },\n            processedDimensions: { width: 1024, height: 1536 },\n            format: 'jpeg',\n            quality: 0.9\n          }\n        });\n      }, 50 + Math.random() * 100);\n    });\n  })\n}));\n\njest.mock('../../../src/business-layer/utils/errorHandling', () => ({\n  classifyTryonError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  logAndClassifyError: jest.fn(() => ({ userMessage: 'Error', technicalMessage: 'Error', errorCode: 'TEST', retryable: false, category: 'TEST', severity: 'MEDIUM', recoveryActions: [] })),\n  isErrorRetryable: jest.fn(() => false)\n}));\n\ndescribe('Mutation Performance Tests', () => {\n  let queryClient: QueryClient;\n  let consoleRef: ReturnType<typeof mockConsole>;\n\n  beforeEach(() => {\n    queryClient = createTestQueryClient();\n    consoleRef = mockConsole();\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    queryClient.clear();\n    consoleRef.restore();\n  });\n\n  describe('Single Mutation Performance', () => {\n    it('should complete basic mutation within performance threshold', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 200); // 200ms API delay\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(1000); // Should complete within 1 second\n      expect(result.current.data).toEqual(mockTryonResponse);\n    });\n\n    it('should handle large base64 images efficiently', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 300);\n\n      // Create a large base64 string to simulate real image data\n      const largeBase64 = 'data:image/jpeg;base64,' + 'A'.repeat(1000000); // ~1MB base64\n      \n      const testVariables: TryonMutationVariables = {\n        modelImage: largeBase64,\n        apparelImages: [largeBase64, largeBase64],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(1500); // Should handle large images within 1.5 seconds\n    });\n\n    it('should process File objects within reasonable time', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 250);\n\n      const mockFile = new File(\n        [new ArrayBuffer(5 * 1024 * 1024)], // 5MB file\n        'large-image.jpg',\n        { type: 'image/jpeg' }\n      );\n\n      const testVariables = {\n        modelImage: mockFile,\n        apparelImages: [mockFile],\n        options: {\n          imageProcessing: {\n            targetWidth: 1024,\n            targetHeight: 1536,\n            maxSizeKB: 1024,\n            compressionQuality: 0.9\n          }\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables as any);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      }, { timeout: 5000 });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(2000); // Should process files within 2 seconds\n    });\n  });\n\n  describe('Concurrent Mutations Performance', () => {\n    it('should handle multiple concurrent mutations efficiently', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 300);\n\n      const numConcurrentMutations = 5;\n      const mutations: any[] = [];\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      // Create multiple mutation hooks\n      for (let i = 0; i < numConcurrentMutations; i++) {\n        const { result } = renderHook(\n          () => useTryonMutation(),\n          { wrapper: createQueryClientWrapper(queryClient) }\n        );\n        mutations.push(result);\n      }\n\n      const startTime = performance.now();\n\n      // Start all mutations concurrently\n      await act(async () => {\n        mutations.forEach(mutation => {\n          mutation.current.mutate(testVariables);\n        });\n      });\n\n      // Wait for all to complete\n      await waitFor(() => {\n        expect(mutations.every(m => m.current.isSuccess)).toBe(true);\n      }, { timeout: 10000 });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(5000); // Should handle 5 concurrent within 5 seconds\n      mutations.forEach(mutation => {\n        expect(mutation.current.data).toEqual(mockTryonResponse);\n      });\n    });\n\n    it('should handle batch operations efficiently', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 200);\n\n      const batchSize = 3;\n      const testVariablesList: TryonMutationVariables[] = Array.from(\n        { length: batchSize },\n        (_, i) => ({\n          modelImage: `data:image/jpeg;base64,test-model-${i}`,\n          apparelImages: [`data:image/jpeg;base64,test-apparel-${i}`],\n          options: {}\n        })\n      );\n\n      const { result } = renderHook(\n        () => useBatchTryonWithProgress(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      let batchResults: any[] = [];\n      await act(async () => {\n        batchResults = await result.current.executeBatch(testVariablesList);\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(3000); // Should handle batch within 3 seconds\n      expect(batchResults).toHaveLength(batchSize);\n      expect(result.current.batchProgress.completed).toBe(batchSize);\n    });\n  });\n\n  describe('Memory Usage Performance', () => {\n    it('should not cause memory leaks with repeated mutations', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 100);\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const numIterations = 20;\n      \n      for (let i = 0; i < numIterations; i++) {\n        await act(async () => {\n          result.current.mutate(testVariables);\n        });\n\n        await waitFor(() => {\n          expect(result.current.isSuccess).toBe(true);\n        });\n\n        // Reset between iterations\n        act(() => {\n          result.current.reset();\n        });\n\n        // Small delay to allow cleanup\n        await wait(10);\n      }\n\n      // Verify final state is clean\n      expect(result.current.isIdle).toBe(true);\n      expect(result.current.data).toBeUndefined();\n      expect(result.current.error).toBeNull();\n    });\n\n    it('should cleanup optimistic updates efficiently', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 150);\n\n      const config = {\n        enableOptimisticUpdates: true,\n        optimisticConfig: {\n          showPreview: true,\n          updateHistory: true,\n          showProgress: true\n        }\n      };\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonWithProgress(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const numIterations = 10;\n\n      for (let i = 0; i < numIterations; i++) {\n        const startTime = performance.now();\n\n        await act(async () => {\n          await result.current.executeTryon(testVariables);\n        });\n\n        const iterationTime = performance.now() - startTime;\n        expect(iterationTime).toBeLessThan(1000); // Each iteration should be fast\n\n        // Verify cleanup\n        expect(result.current.currentOptimisticId).toBeNull();\n        expect(result.current.hasActiveOptimistic).toBe(false);\n      }\n    });\n  });\n\n  describe('Cache Performance', () => {\n    it('should handle cache invalidation efficiently', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 200);\n\n      // Pre-populate cache with many entries\n      const numCacheEntries = 100;\n      for (let i = 0; i < numCacheEntries; i++) {\n        queryClient.setQueryData([`test-cache-${i}`], { data: `entry-${i}` });\n      }\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const config = {\n        cacheInvalidationConfig: {\n          invalidateHistory: true,\n          invalidateUserData: true,\n          invalidateStats: true,\n          invalidateTags: true,\n          preloadRelated: true\n        }\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(1500); // Should handle cache operations efficiently\n    });\n\n    it('should perform well with large query cache', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 100);\n\n      // Create a large query cache\n      const numQueries = 500;\n      for (let i = 0; i < numQueries; i++) {\n        queryClient.setQueryData([`large-cache-${i}`], {\n          data: Array.from({ length: 100 }, (_, j) => ({ id: j, value: `item-${i}-${j}` }))\n        });\n      }\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(1000); // Should not be significantly slowed by large cache\n    });\n  });\n\n  describe('Error Handling Performance', () => {\n    it('should handle retries efficiently', async () => {\n      let attemptCount = 0;\n      (global.fetch as jest.Mock).mockImplementation(() => {\n        attemptCount++;\n        if (attemptCount <= 2) {\n          return Promise.resolve({\n            ok: false,\n            status: 500,\n            json: () => Promise.resolve({ error: 'Server Error' })\n          });\n        }\n        return Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve(mockTryonResponse)\n        });\n      });\n\n      const config = {\n        enableRetry: true,\n        maxRetries: 3,\n        initialRetryDelay: 50 // Fast retries for testing\n      };\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonMutation(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        result.current.mutate(testVariables);\n      });\n\n      await waitFor(() => {\n        expect(result.current.isSuccess).toBe(true);\n      }, { timeout: 5000 });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(1000); // Should handle retries quickly\n      expect(attemptCount).toBe(3); // Initial + 2 retries\n    });\n\n    it('should cleanup efficiently after errors', async () => {\n      const apiError = new Error('API Error');\n      mockTryonAPI(undefined, apiError);\n\n      const config = {\n        enableOptimisticUpdates: true,\n        optimisticConfig: {\n          showPreview: true,\n          updateHistory: true\n        }\n      };\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result } = renderHook(\n        () => useTryonWithProgress(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      const startTime = performance.now();\n\n      await act(async () => {\n        try {\n          await result.current.executeTryon(testVariables);\n        } catch (error) {\n          // Expected to fail\n        }\n      });\n\n      await waitFor(() => {\n        expect(result.current.error).toBeTruthy();\n      });\n\n      const totalTime = performance.now() - startTime;\n\n      expect(totalTime).toBeLessThan(500); // Error handling should be fast\n      expect(result.current.currentOptimisticId).toBeNull(); // Should cleanup optimistic state\n    });\n  });\n\n  describe('Resource Cleanup Performance', () => {\n    it('should cleanup resources quickly on component unmount', async () => {\n      mockTryonAPI(mockTryonResponse, undefined, 1000); // Long delay\n\n      const config = {\n        enableOptimisticUpdates: true\n      };\n\n      const testVariables: TryonMutationVariables = {\n        modelImage: 'data:image/jpeg;base64,test-model',\n        apparelImages: ['data:image/jpeg;base64,test-apparel'],\n        options: {}\n      };\n\n      const { result, unmount } = renderHook(\n        () => useTryonWithProgress(config),\n        { wrapper: createQueryClientWrapper(queryClient) }\n      );\n\n      // Start mutation\n      await act(async () => {\n        result.current.executeTryon(testVariables).catch(() => {}); // Ignore rejection\n      });\n\n      const unmountStart = performance.now();\n      \n      // Unmount component\n      unmount();\n\n      const unmountTime = performance.now() - unmountStart;\n\n      expect(unmountTime).toBeLessThan(100); // Unmount should be very fast\n    });\n  });\n});"],"names":["jest","mock","getOptimisticUpdatesManager","startOptimisticUpdate","fn","optimisticId","Date","now","Math","random","variables","config","startTime","rollbackFunctions","completeOptimisticUpdate","rollbackOptimisticUpdate","getActiveOptimisticUpdates","OptimisticUpdatesManager","invalidateCacheAfterMutation","mockResolvedValue","undefined","processImageForTryon","mockImplementation","Promise","resolve","setTimeout","originalSize","processedSize","compressionRatio","processingTime","processedImage","metadata","originalDimensions","width","height","processedDimensions","format","quality","classifyTryonError","userMessage","technicalMessage","errorCode","retryable","category","severity","recoveryActions","logAndClassifyError","isErrorRetryable","describe","queryClient","consoleRef","beforeEach","createTestQueryClient","mockConsole","clearAllMocks","afterEach","clear","restore","it","mockTryonAPI","mockTryonResponse","testVariables","modelImage","apparelImages","options","result","renderHook","useTryonMutation","wrapper","createQueryClientWrapper","performance","act","current","mutate","waitFor","expect","isSuccess","toBe","totalTime","toBeLessThan","data","toEqual","largeBase64","repeat","mockFile","File","ArrayBuffer","type","imageProcessing","targetWidth","targetHeight","maxSizeKB","compressionQuality","timeout","numConcurrentMutations","mutations","i","push","forEach","mutation","every","m","batchSize","testVariablesList","Array","from","length","_","useBatchTryonWithProgress","batchResults","executeBatch","toHaveLength","batchProgress","completed","numIterations","reset","wait","isIdle","toBeUndefined","error","toBeNull","enableOptimisticUpdates","optimisticConfig","showPreview","updateHistory","showProgress","useTryonWithProgress","executeTryon","iterationTime","currentOptimisticId","hasActiveOptimistic","numCacheEntries","setQueryData","cacheInvalidationConfig","invalidateHistory","invalidateUserData","invalidateStats","invalidateTags","preloadRelated","numQueries","j","id","value","attemptCount","global","fetch","ok","status","json","enableRetry","maxRetries","initialRetryDelay","apiError","Error","toBeTruthy","unmount","catch","unmountStart","unmountTime"],"mappings":"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"}